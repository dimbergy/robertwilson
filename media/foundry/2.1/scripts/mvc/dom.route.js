!function(){var moduleFactory=function($){var module=this;$.require().script("mvc/lang.observe","mvc/event.hashchange","mvc/lang.string.deparam").done(function(){var exports=function(){var matcher=/\:([\w\.]+)/g,paramsMatcher=/^(?:&[^=]+=[^&]*)+/,makeProps=function(props){var html=[],name,val;each(props,function(name,val){if(name==="className"){name="class"}val&&html.push(escapeHTML(name),'="',escapeHTML(val),'" ')});return html.join("")},escapeHTML=function(content){return content.replace(/"/g,"&#34;").replace(/'/g,"&#39;")},matchesData=function(route,data){var count=0;for(var i=0;i<route.names.length;i++){if(!data.hasOwnProperty(route.names[i])){return-1}count++}return count},onready=true,location=window.location,encode=encodeURIComponent,decode=decodeURIComponent,each=$.each,extend=$.extend;$.route=function(url,defaults){var names=[],test=url.replace(matcher,function(whole,name){names.push(name);return"([^\\/\\&]*)"});$.route.routes[url]={test:new RegExp("^"+test+"($|&)"),route:url,names:names,defaults:defaults||{},length:url.split("/").length};return $.route};extend($.route,{param:function(data){var route,matches=0,matchCount,routeName=data.route;delete data.route;if(routeName&&(route=$.route.routes[routeName])){}else{each($.route.routes,function(name,temp){matchCount=matchesData(temp,data);if(matchCount>matches){route=temp;matches=matchCount}})}if(route){var cpy=extend({},data),res=route.route.replace(matcher,function(whole,name){delete cpy[name];return data[name]===route.defaults[name]?"":encode(data[name])}),after;each(route.defaults,function(name,val){if(cpy[name]===val){delete cpy[name]}});after=$.param(cpy);return res+(after?"&"+after:"")}return $.isEmptyObject(data)?"":"&"+$.param(data)},deparam:function(url){var route={length:-1};each($.route.routes,function(name,temp){if(temp.test.test(url)&&temp.length>route.length){route=temp}});if(route.length>-1){var parts=url.match(route.test),start=parts.shift(),remainder=url.substr(start.length-(parts[parts.length-1]==="&"?1:0)),obj=remainder&&paramsMatcher.test(remainder)?$.String.deparam(remainder.slice(1)):{};obj=extend(true,{},route.defaults,obj);each(parts,function(i,part){if(part&&part!=="&"){obj[route.names[i]]=decode(part)}});obj.route=route.route;return obj}if(url.charAt(0)!=="&"){url="&"+url}return paramsMatcher.test(url)?$.String.deparam(url.slice(1)):{}},data:new $.Observe({}),routes:{},ready:function(val){if(val===false){onready=false}if(val===true||onready===true){setState()}return $.route},url:function(options,merge){if(merge){return"#!"+$.route.param(extend({},curParams,options))}else{return"#!"+$.route.param(options)}},link:function(name,options,props,merge){return"<a "+makeProps(extend({href:$.route.url(options,merge)},props))+">"+name+"</a>"},current:function(options){return location.hash=="#!"+$.route.param(options)}});$(function(){$.route.ready()});each(["bind","unbind","delegate","undelegate","attr","attrs","serialize","removeAttr"],function(i,name){$.route[name]=function(){return $.route.data[name].apply($.route.data,arguments)}});var throttle=function(func){var timer;return function(){var args=arguments,self=this;clearTimeout(timer);timer=setTimeout(function(){func.apply(self,args)},1)}},curParams,setState=function(){var hash=location.hash.substr(1,1)==="!"?location.hash.slice(2):location.hash.slice(1);curParams=$.route.deparam(hash);$.route.attrs(curParams,true)};$(window).bind("hashchange",setState);$.route.bind("change",throttle(function(){location.hash="#!"+$.route.param($.route.serialize())}))};exports();module.resolveWith(exports)})};dispatch("mvc/dom.route").containing(moduleFactory).to("Foundry/2.1 Modules")}();