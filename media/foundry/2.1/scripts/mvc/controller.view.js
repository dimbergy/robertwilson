!function(){var moduleFactory=function($){var module=this;$.require().script("mvc/controller","mvc/view").done(function(){var exports=function(){var URI=steal.URI||steal.File;$.Controller.getFolder=function(){return $.String.underscore(this.fullName.replace(/\./g,"/")).replace("/Controllers","")};$.Controller._calculatePosition=function(Class,view,action_name){var classParts=Class.fullName.split("."),classPartsWithoutPrefix=classParts.slice(0);classPartsWithoutPrefix.splice(0,2);var classPartsWithoutPrefixSlashes=classPartsWithoutPrefix.join("/"),hasControllers=classParts.length>2&&classParts[1]=="Controllers",path=hasControllers?$.String.underscore(classParts[0]):$.String.underscore(classParts.join("/")),controller_name=$.String.underscore(classPartsWithoutPrefix.join("/")).toLowerCase(),suffix=typeof view=="string"&&/\.[\w\d]+$/.test(view)?"":$.View.ext;if(typeof view=="string"){if(view.substr(0,2)=="//"){}else{view="//"+URI(path).join("views/"+(view.indexOf("/")!==-1?view:(hasControllers?controller_name+"/":"")+view))+suffix}}else if(!view){view="//"+URI(path).join("views/"+(hasControllers?controller_name+"/":"")+action_name.replace(/\.|#/g,"").replace(/ /g,"_"))+suffix}return view};var calculateHelpers=function(myhelpers){var helpers={};if(myhelpers){if($.isArray(myhelpers)){for(var h=0;h<myhelpers.length;h++){$.extend(helpers,myhelpers[h])}}else{$.extend(helpers,myhelpers)}}else{if(this._default_helpers){helpers=this._default_helpers}var current=window;var parts=this.constructor.fullName.split(/\./);for(var i=0;i<parts.length;i++){if(current){if(typeof current.Helpers=="object"){$.extend(helpers,current.Helpers)}current=current[parts[i]]}}if(current&&typeof current.Helpers=="object"){$.extend(helpers,current.Helpers)}this._default_helpers=helpers}return helpers};$.Controller.prototype.view=function(view,data,myhelpers){if(typeof view!="string"&&!myhelpers){myhelpers=data;data=view;view=null}view=$.Controller._calculatePosition(this.Class,view,this.called);data=data||this;var helpers=calculateHelpers.call(this,myhelpers);return $.View(view,data,helpers)}};exports();module.resolveWith(exports)})};dispatch("mvc/controller.view").containing(moduleFactory).to("Foundry/2.1 Modules")}();