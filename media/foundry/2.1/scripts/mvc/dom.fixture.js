!function(){var moduleFactory=function($){var module=this;$.require().script("mvc/lang.object","mvc/lang.string").done(function(){var exports=function(){$.ajaxPrefilter(function(settings,originalOptions,jqXHR){if(!$.fixture.on){return}var data=overwrite(settings);if(!settings.fixture){if(window.location.protocol==="file:"){}return}if(typeof settings.fixture==="string"&&$.fixture[settings.fixture]){settings.fixture=$.fixture[settings.fixture]}if(typeof settings.fixture=="string"){var url=settings.fixture;if(/^\/\//.test(url)){url=steal.root.mapJoin(settings.fixture.substr(2))+""}settings.url=url;settings.data=null;settings.type="GET";if(!settings.error){settings.error=function(xhr,error,message){throw"fixtures.js Error "+error+" "+message}}}else{settings.dataTypes.splice(0,0,"fixture");if(data){$.extend(originalOptions.data,data)}}});$.ajaxTransport("fixture",function(s,original){s.dataTypes.shift();var next=s.dataTypes[0],timeout;return{send:function(headers,callback){timeout=setTimeout(function(){var response=s.fixture(original,s,headers);if(!$.isArray(response)){var tmp=[{}];tmp[0][next]=response;response=tmp}if(typeof response[0]!="number"){response.unshift(200,"success")}if(!response[2]||!response[2][next]){var tmp={};tmp[next]=response[2];response[2]=tmp}callback.apply(null,response)},$.fixture.delay)},abort:function(){clearTimeout(timeout)}}});var typeTest=/^(script|json|test|jsonp)$/,overwrites=[],find=function(settings,exact){for(var i=0;i<overwrites.length;i++){if($fixture._similar(settings,overwrites[i],exact)){return i}}return-1},overwrite=function(settings){var index=find(settings);if(index>-1){settings.fixture=overwrites[index].fixture;return $fixture._getData(overwrites[index].url,settings.url)}},getId=function(settings){var id=settings.data.id;if(id===undefined&&typeof settings.data==="number"){id=settings.data}if(id===undefined){settings.url.replace(/\/(\d+)(\/|$|\.)/g,function(all,num){id=num})}if(id===undefined){id=settings.url.replace(/\/(\w+)(\/|$|\.)/g,function(all,num){if(num!="update"){id=num}})}if(id===undefined){id=Math.round(Math.random()*1e3)}return id};var $fixture=$.fixture=function(settings,fixture){if(fixture!==undefined){if(typeof settings=="string"){var matches=settings.match(/(GET|POST|PUT|DELETE) (.+)/i);if(!matches){settings={url:settings}}else{settings={url:matches[2],type:matches[1]}}}var index=find(settings,!!fixture);if(index>-1){overwrites.splice(index,1)}if(fixture==null){return}settings.fixture=fixture;overwrites.push(settings)}};var replacer=$.String._regs.replacer;$.extend($.fixture,{_similar:function(settings,overwrite,exact){if(exact){return $.Object.same(settings,overwrite,{fixture:null})}else{return $.Object.subset(settings,overwrite,$.fixture._compare)}},_compare:{url:function(a,b){return!!$fixture._getData(b,a)},fixture:null,type:"i"},_getData:function(fixtureUrl,url){var order=[],fixtureUrlAdjusted=fixtureUrl.replace(".","\\.").replace("?","\\?"),res=new RegExp(fixtureUrlAdjusted.replace(replacer,function(whole,part){order.push(part);return"([^/]+)"})+"$").exec(url),data={};if(!res){return null}res.shift();$.each(order,function(i,name){data[name]=res.shift()});return data},"-restUpdate":function(settings){return[200,"succes",{id:getId(settings)},{location:settings.url+"/"+getId(settings)}]},"-restDestroy":function(settings,cbType){return{}},"-restCreate":function(settings,cbType,nul,id){var id=id||parseInt(Math.random()*1e5,10);return[200,"succes",{id:id},{location:settings.url+"/"+id}]},make:function(types,count,make,filter){if(typeof types==="string"){types=[types+"s",types]}var items=$.fixture["~"+types[0]]=[],findOne=function(id){for(var i=0;i<items.length;i++){if(id==items[i].id){return items[i]}}};for(var i=0;i<count;i++){var item=make(i,items);if(!item.id){item.id=i}items.push(item)}$.fixture["-"+types[0]]=function(settings){var retArr=items.slice(0);settings.data=settings.data||{};$.each((settings.data.order||[]).slice(0).reverse(),function(i,name){var split=name.split(" ");retArr=retArr.sort(function(a,b){if(split[1].toUpperCase()!=="ASC"){if(a[split[0]]<b[split[0]]){return 1}else if(a[split[0]]==b[split[0]]){return 0}else{return-1}}else{if(a[split[0]]<b[split[0]]){return-1}else if(a[split[0]]==b[split[0]]){return 0}else{return 1}}})});$.each((settings.data.group||[]).slice(0).reverse(),function(i,name){var split=name.split(" ");retArr=retArr.sort(function(a,b){return a[split[0]]>b[split[0]]})});var offset=parseInt(settings.data.offset,10)||0,limit=parseInt(settings.data.limit,10)||items.length-offset,i=0;for(var param in settings.data){i=0;if(settings.data[param]!==undefined&&(param.indexOf("Id")!=-1||param.indexOf("_id")!=-1)){while(i<retArr.length){if(settings.data[param]!=retArr[i][param]){retArr.splice(i,1)}else{i++}}}}if(filter){i=0;while(i<retArr.length){if(!filter(retArr[i],settings)){retArr.splice(i,1)}else{i++}}}return[{count:retArr.length,limit:settings.data.limit,offset:settings.data.offset,data:retArr.slice(offset,offset+limit)}]};$.fixture["-"+types[1]]=function(settings){var item=findOne(getId(settings));return item?[item]:[]};$.fixture["-"+types[1]+"Update"]=function(settings,cbType){var id=getId(settings);$.extend(findOne(id),settings.data);return $.fixture["-restUpdate"](settings,cbType)};$.fixture["-"+types[1]+"Destroy"]=function(settings,cbType){var id=getId(settings);for(var i=0;i<items.length;i++){if(items[i].id==id){items.splice(i,1);break}}$.extend(findOne(id),settings.data);return $.fixture["-restDestroy"](settings,cbType)};$.fixture["-"+types[1]+"Create"]=function(settings,cbType){var item=make(items.length,items);$.extend(item,settings.data);if(!item.id){item.id=items.length}items.push(item);return $.fixture["-restCreate"](settings,cbType,undefined,item.id)};return{getId:getId,findOne:findOne,find:function(settings){return findOne(getId(settings))}}},rand:function(arr,min,max){if(typeof arr=="number"){if(typeof min=="number"){return arr+Math.floor(Math.random()*(min-arr))}else{return Math.floor(Math.random()*arr)}}var rand=arguments.callee;if(min===undefined){return rand(arr,rand(arr.length+1))}var res=[];arr=arr.slice(0);if(!max){max=min}max=min+Math.round(rand(max-min));for(var i=0;i<max;i++){res.push(arr.splice(rand(arr.length),1)[0])}return res},xhr:function(xhr){return $.extend({},{abort:$.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:$.noop,overrideMimeType:$.noop,readyState:4,responseText:"",responseXML:null,send:$.noop,setRequestHeader:$.noop,status:200,statusText:"OK"},xhr)},on:true});$.fixture.delay=200;$.fixture["-handleFunction"]=function(settings){if(typeof settings.fixture==="string"&&$.fixture[settings.fixture]){settings.fixture=$.fixture[settings.fixture]}if(typeof settings.fixture=="function"){setTimeout(function(){if(settings.success){settings.success.apply(null,settings.fixture(settings,"success"))}if(settings.complete){settings.complete.apply(null,settings.fixture(settings,"complete"))}},$.fixture.delay);return true}return false};$.fixture.overwrites=overwrites};exports();module.resolveWith(exports)})};dispatch("mvc/dom.fixture").containing(moduleFactory).to("Foundry/2.1 Modules")}();