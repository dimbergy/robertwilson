dispatch.to("Foundry/2.1 Core Plugins").at(function($,manifest){var Component=$.Component=function(name,options,callback){if(arguments.length<1){return Component.registry}if(arguments.length<2){return Component.registry[name]}return Component.register(name,options,callback)};Component.registry={};Component.proxy=function(component,property,value){if($.isFunction(value)){component[property]=$.proxy(value,component)}else{component[property]=value}};Component.register=function(name,options,callback){var queue=window[name]?window[name].queue||[]:[];var self=Component.registry[name]=window[name]=function(command){return $.isFunction(command)?command($):component};$.each(Component.prototype,function(property,value){Component.proxy(self,property,value)});self.$=$;self.options=options;self.className=name;self.identifier=name.toLowerCase();self.componentName="com_"+self.identifier;self.version=options.version;self.safeVersion=self.version.replace(/\./g,"");self.environment=options.environment||$.environment;self.debug=self.environment=="development";self.language=options.language||$.locale.lang||"en";self.baseUrl=options.baseUrl||$.indexUrl+"?option="+self.componentName;self.scriptPath=options.scriptPath||$.rootPath+"media/"+self.componentName+(self.debug?"/scripts_/":"/scripts/");self.templatePath=options.templatePath||options.scriptPath;self.languagePath=options.languagePath||self.baseUrl+"&tmpl=component&no_html=1&controller=lang&task=getLanguage";self.viewPath=options.viewPath||self.baseUrl+"&tmpl=component&no_html=1&controller=themes&task=getAjaxTemplate";self.prefix=self.identifier+"/";self.optimizeResources=options.optimizeResources||self.environment==="optimized"?true:false;self.resourcePath=options.resourcePath||self.baseUrl+"&tmpl=component&no_html=1&controller=foundry&task=getResource";self.resourceCollectionInterval=1200;self.scriptVersioning=options.scriptVersioning||false;self.initRecovery=options.initRecovery||false;self.isReady=false;self.dependencies=$.Deferred();self.console=function(method){if(!self.debug)return;var console=window.console;if(!console)return;var method=console[method];if(!method)return;var args=$.makeArray(arguments).slice(1);if(method.apply){method.apply(console,args)}else{method(args.join(" "))}};var resolveComponent=function(){self.dependencies.resolve();self.ready(function(){self.isReady=true;self.run(callback)})};if($.isFunction(options.dependencies)){var require=self.require({loadingComponentDependencies:true});options.dependencies.call(self,require);require.done(resolveComponent)}else{resolveComponent()}$.each(queue,function(i,func){if($.isPlainObject(func)){self[func.method].apply(self,func.args)}if($.isArray(func)){var chain=func,context=self;$.each(chain,function(i,func){context=context[func.method].apply(context,func.args)})}});if(self.initRecovery){$(document).ready(function(){if(self.module("init").state()!=="pending")return;var initializer=$("script[data-id='"+self.identifier+"-init']")[0];if(!initializer)return;try{eval(initializer.innerHTML)}catch(e){throw"Unable to recover component initializer for "+self.className+". "+e}})}};Component.extend=function(property,value){Component.prototype[property]=value;$.each(Component.registry,function(name,component){Component.proxy(component,property,value)})};$.extend(Component.prototype,{run:function(command){return $.isFunction(command)?command($):component},ready:function(callback){if(!$.isFunction(callback))return;var self=this;$.module("component/mvc").done(function(){self.dependencies.done(function(){$(document).ready(function(){self.run(callback)})})})},template:function(name){var self=this;if(name==undefined){return $.grep($.template(),function(template){return template.indexOf(self.prefix)==0})}arguments[0]=self.prefix+name;return $.template.apply(null,arguments)},require:function(options){var self=this,options=options||{},require=$.require($.extend({path:self.scriptPath},options)),_require={};$.each(["library","script","language","template","done"],function(i,method){_require[method]=require[method]});require.resource=function(resource){if(!$.isPlainObject(resource))return;if(!resource.type||!resource.name||!$.isDeferred(resource.loader))return;var batch=this;var resourceCollector=self.resourceCollector;if(!resourceCollector){resourceCollector=self.resourceCollector=$.Deferred();$.extend(resourceCollector,{name:$.uid("ResourceCollector"),manifest:[],loaderList:[],loaders:[],load:function(){delete self.resourceCollector;if(resourceCollector.manifest.length<0){resourceCollector.resolve();return}$.Ajax({type:"POST",url:self.resourcePath,dataType:"json",data:{resource:resourceCollector.manifest}}).done(function(manifest){if(!$.isArray(manifest)){resourceCollector.reject("Server did not return a valid resource manifest.");return}$.each(manifest,function(i,resource){var content=resource.content;resourceCollector.loaders[resource.id][content!==undefined?"resolve":"reject"](content)})});$.when.apply(null,resourceCollector.loaderList).done(resourceCollector.resolve).fail(resourceCollector.reject)}});setTimeout(resourceCollector.load,self.resourceCollectionInterval)}var id=resource.id=$.uid("Resource");resourceCollector.loaders[id]=resource.loader;resourceCollector.loaderList.push(resource.loader);delete resource.loader;resourceCollector.manifest.push(resource);return require};require.view=function(){var batch=this,request=batch.expand(arguments,{path:self.viewPath}),loaders={},options=request.options,names=$.map(request.names,function(name){var absoluteName=self.prefix+name,loader=$.template.loader(absoluteName);if(/resolved|failed/.test(loader.state())&&options.reload){loader=loader.reset()}batch.addTask(loader);if(loader.state()!=="pending")return;if(self.optimizeResources){require.resource({type:"view",name:name,loader:loader});return}else{loaders[name]=loader;return name}});if(names.length>0){$.Ajax({url:options.path,dataType:"json",data:{names:names}}).done(function(templates){if(!$.isArray(templates))return;$.each(templates,function(i,template){var content=template.content;loaders[template.name][content!==undefined?"resolve":"reject"](content)})})}return require};require.language=function(){var batch=this,request=batch.expand(arguments,{path:self.languagePath});if(self.optimizeResources){$.each(request.names,function(i,name){var loader=$.Deferred();loader.name=name;loader.done(function(val){$.language.add(name,val)});batch.addTask(loader);require.resource({type:"language",name:name,loader:loader})})}else{_require.language.apply(require,[request.options].concat(request.names))}return require};require.library=function(){var o=require.script;require.script=_require.script;_require.library.apply(require,arguments);require.script=o;return require};require.script=function(){var batch=this,request=batch.expand(arguments);names=$.map(request.names,function(name){if($.isArray(name)||$.isUrl(name)||/^(\/|\.)/.test(name))return name;var moduleName=self.prefix+name,moduleUrl=$.uri(batch.options.path).toPath("./"+name+"."+(request.options.extension||"js")+(self.scriptVersioning?"?"+"version="+self.safeVersion:"")).toString();return[[moduleName,moduleUrl,true]]});return _require.script.apply(require,names)};require.template=function(){var batch=this,request=batch.expand(arguments,{path:self.templatePath});return _require.template.apply(require,[request.options].concat($.map(request.names,function(name){return[[self.prefix+name,name]]})))};require.done=function(callback){return _require.done.call(require,function(){$.module("component/mvc").done(options.loadingComponentDependencies?function(){callback.call(self,$)}:function(){self.ready(callback)})})};return require},module:function(name,factory){var self=this;if($.isArray(name)){return}var fullname=self.prefix+name;return factory?$.module.apply(null,[fullname,function(){var module=this;if(name==="init"){factory.call(module,$);return}$.module("component/mvc").done(function(){factory.call(module,$)})}]):$.module(fullname)}});$.module("component/mvc",function(){var module=this;$.require().library("server","mvc/controller","mvc/model","mvc/model.list","mvc/view","mvc/view.ejs","mvc/lang.json").done(function(){$.Component.extend("ajax",function(namespace,params,callback){var self=this;var options={url:self.baseUrl,data:$.extend(params,{option:self.componentName,namespace:namespace})};options=$.extend(true,options,self.options.ajax);var token=$("span#"+self.identifier+"-token input").attr("name");if(token){options.data[token]=1}if(options.data.hasOwnProperty("args")){options.data.args=$.toJSON(options.data.args)}if($.isPlainObject(callback)){if(callback.type){switch(callback.type){case"jsonp":callback.dataType="jsonp";callback.crossDomain=true;options.data.transport="jsonp";break;case"iframe":callback.iframe=true;callback.processData=false;callback.files=options.data.files;delete options.data.files;options.data.transport="iframe";break}delete callback.type}$.extend(options,callback)}if($.isFunction(callback)){options.success=callback}return $.server(options)});$.Component.extend("Controller",function(){var self=this,args=$.makeArray(arguments),name=self.className+".Controller."+args[0],staticProps,protoFactory;if(args.length==1){return $.String.getObject(args[0])}if(args.length>2){staticProps=args[1],protoFactory=args[2]}else{staticProps={},protoFactory=args[1]}$.extend(staticProps,{component:self});return $.Controller.apply(this,[name,staticProps,protoFactory])});$.Component.extend("Model",function(){var self=this,args=$.makeArray(arguments),name=self.className+".Model."+args[0],staticProps,protoFactory;if(args.length==1){return $.String.getObject(args[0])}if(args.length==2){staticProps={},protoFactory=args[1]}if(args.length>2){staticProps=args[1],protoFactory=args[2]}$.extend(staticProps,{component:self});return $.Model.apply(this,[name,staticProps,protoFactory])});$.Component.extend("Model.List",function(){var self=this,args=$.makeArray(arguments),name=self.className+".Model.List."+args[0],staticProps,protoFactory;if(args.length==1){return $.String.getObject(args[0])}if(args.length==2){staticProps={},protoFactory=args[1]}if(args.length>2){staticProps=args[1],protoFactory=args[2]}$.extend(staticProps,{component:self});return $.Model.List.apply(this,[name,staticProps,protoFactory])});$.Component.extend("View",function(name){var self=this;if(arguments.length<1){return self.template()}arguments[0]=self.prefix+arguments[0];return $.View.apply(this,arguments)});module.resolve()})});dispatch("Foundry/2.1").toAll()});