!function(window,undefined){if(window.dispatch!==undefined)return;var uid=function(p,s){return(p?p:"")+Math.random().toString().replace(".","")+(s?s:"")};var dispatch=window.dispatch=function(manifest,exports){var setter=false;if(typeof manifest==="object"){if(typeof manifest.name===undefined){return}setter=true}if(typeof manifest==="string"){manifest={name:manifest}}var parcel=dispatch.parcels[manifest.name];if(parcel===undefined){parcel=dispatch.parcels[manifest.name]=new Parcel(manifest.name);parcel.add(manifest,exports)}else if(setter){parcel.add(manifest,exports)}return parcel.get()};dispatch.parcels={};dispatch.dropsite={};dispatch.delivering=false;dispatch.queue=[];dispatch.deliver=function(parcel,dropsite,forceDeliver){if(dispatch.delivering){if(!forceDeliver){dispatch.queue.push(arguments);return}}dispatch.delivering=true;dropsite.addParcel(parcel);if(parcel.exports===undefined){return}var i;for(i=0;i<dropsite.sites.length;i++){var site=dropsite.sites[i];if(parcel.sentTo[site.id])continue;if(site.target){site.target.apply(window,[parcel.exports,parcel.manifest]);parcel.sentTo[site.id]=true}}if(dispatch.queue.length>0){var args=dispatch.queue.shift();dispatch.deliver.apply(this,[args[0],args[1],true])}else{dispatch.delivering=false}};dispatch.to=function(name){if(name===undefined)return;return dispatch.dropsite[name]||(dispatch.dropsite[name]=new Dropsite(name))};var Dropsite=function(name){this.name=name;this.sites=[];this.parcels=[]};Dropsite.prototype.at=function(site){var dropsite=this;if(typeof site==="function"){var siteId=uid(this.name+"/");this.sites.push({id:siteId,target:site});var i;for(i=0;i<this.parcels.length;i++){var parcel=this.parcels[i];dispatch.deliver(parcel,dropsite)}}return this};Dropsite.prototype.addParcel=function(newParcel){var parcelExists=false;var i;for(i=0;i<this.parcels.length;i++){var parcel=this.parcels[i];if(parcel==newParcel){parcelExists=true;break}}if(!parcelExists){this.parcels.push(newParcel)}};var Parcel=function(manifest){this.name=manifest.name;this.dropsites=[];this.parcels=[]};Parcel.prototype.add=function(manifest,exports){return this.parcels.push({manifest:manifest,exports:exports,sentTo:{}})};Parcel.prototype.get=function(){this.indexLocked=false;this.index=this.parcels.length-1;return this};Parcel.prototype.intendedFor=function(name){var parcel;for(i in this.parcels){parcel=this.parcels[i];if(parcel.manifest.recipient==name){this.index=i;this.indexLocked=true;return this}}};Parcel.prototype.containing=function(exports){if(this.indexLocked){return this}var parcel=this.parcels[this.index];if(parcel.exports!==undefined){this.index=this.add({name:this.name},exports)-1}else{parcel.exports=exports}return this};Parcel.prototype.to=function(dropsite,forceDeliver){if(dropsite===undefined){return this}parcel=this.parcels[this.index];if(typeof dropsite==="string"){var name=dropsite;if(parcel.manifest.recipient!==undefined){parcel.manifest.recipient=name}dropsite=dispatch.to(name)}if(typeof dropsite==="function"){dropsite=dispatch.to("Custom dropsite for "+parcel.manifest.name).at(dropsite)}this.dropsites.push(dropsite);if(this.dropsiteLocked){if(forceDeliver){dispatch.deliver(parcel,dropsite)}}else{this.toAll()}return this};Parcel.prototype.onlyTo=function(dropsite){this.dropsiteLocked=true;this.to(dropsite,true);return this};Parcel.prototype.toAll=function(){this.dropsiteLocked=false;var parcel=this.parcels[this.index],dropsites=this.dropsites;var i;for(i=0;i<dropsites.length;i++){var dropsite=dropsites[i];dispatch.deliver(parcel,dropsite)}return this}}(window);