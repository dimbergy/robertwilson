FD31.installer("EasySocial","definitions",function(n){n.module("easysocial/admin easysocial/admin/sidebar/sidebar easysocial/admin/alerts/discover easysocial/progress/progress easysocial/admin/badges/discover easysocial/admin/grid/grid easysocial/admin/grid/sort easysocial/admin/grid/publishing easysocial/admin/grid/ordering easysocial/admin/indexer/indexer easysocial/admin/mailer/mailer easysocial/admin/migrators/migrator easysocial/admin/points/discover easysocial/admin/privacy/discover easysocial/admin/profiles/avatar easysocial/uploader/uploader easysocial/uploader/queue easysocial/admin/profiles/fields easysocial/field easysocial/admin/profiles/members easysocial/admin/profiles/profile easysocial/admin/profiles/profiles easysocial/admin/reports/reporters easysocial/admin/reports/reports easysocial/admin/users/form easysocial/admin/users/privacy easysocial/admin/users/users easysocial/admin/widgets/news easysocial/albums/album easysocial/albums/browser easysocial/albums/editor easysocial/albums/editor/sortable easysocial/albums/editor/uploader easysocial/albums/uploader easysocial/albums/uploader.item easysocial/albums/item easysocial/easysocial easysocial/site/likes/likes easysocial/site/reports/reports easysocial/site/repost/repost easysocial/site/share/share easysocial/site/layout/dialog easysocial/site/layout/responsive easysocial/site/layout/elements easysocial/site/photos/photos easysocial/photos easysocial/photos/viewer easysocial/site/users/login easysocial/site/profile/popbox easysocial/site/conversations/composer easysocial/site/friends/suggest easysocial/location easysocial/site/privacy/privacy easysocial/site/locations/popbox easysocial/site/sidebar/sidebar easysocial/locations easysocial/oauth/facebook easysocial/pagination easysocial/photos/avatar easysocial/photos/browser easysocial/photos/cover easysocial/photos/editor easysocial/photos/item easysocial/photos/tags easysocial/photos/tagger easysocial/photos/navigation easysocial/privacy easysocial/sharing easysocial/site/activities/activities easysocial/site/activities/sidebar easysocial/site/activities/sidebar.item easysocial/site/activities/apps easysocial/site/activities/item easysocial/site/activities/list easysocial/site/apps/apps easysocial/site/badges/badge easysocial/site/comments/control easysocial/site/comments/frame easysocial/site/comments/item easysocial/site/conversations/api easysocial/site/conversations/conversations easysocial/site/conversations/mailbox easysocial/site/conversations/item easysocial/site/conversations/filter easysocial/site/conversations/read easysocial/site/dashboard/apps easysocial/site/dashboard/dashboard easysocial/site/dashboard/feeds easysocial/site/dashboard/sidebar easysocial/site/followers/api easysocial/site/followers/followers easysocial/site/friends/api easysocial/site/friends/friends easysocial/site/friends/list easysocial/site/friends/item easysocial/site/notifications/list easysocial/site/points/history easysocial/site/popbox/popbox easysocial/site/profile/about easysocial/site/profile/avatar easysocial/site/profile/edit easysocial/validate easysocial/site/profile/friends easysocial/site/profile/header easysocial/site/profile/subscriptions easysocial/site/profile/miniheader easysocial/site/profile/notifications easysocial/site/profile/privacy easysocial/site/profile/profile easysocial/site/registrations/registrations easysocial/site/search/item easysocial/site/search/list easysocial/site/search/search easysocial/site/search/sidebar easysocial/site/search/toolbar easysocial/site/stream/filter easysocial/site/stream/item easysocial/site/stream/sidebar easysocial/site/stream/stream easysocial/site/stream/video easysocial/site/subscriptions/follow easysocial/site/toolbar/conversations easysocial/site/toolbar/friends easysocial/site/toolbar/login easysocial/site/toolbar/notifications easysocial/site/toolbar/story easysocial/site/toolbar/system easysocial/site/toolbar/profile easysocial/site/users/users easysocial/story easysocial/story/friends easysocial/story/links easysocial/story/locations easysocial/story/photos easysocial/albums/photo easysocial/stream easysocial/comment easysocial/tab easysocial/toggle easysocial/uploader/item easysocial/utilities/alias".split(" "));
n.require.template.loader("easysocial/site/loading/small easysocial/site/uploader/queue.item easysocial/admin/profiles/form.fields.editorItem easysocial/admin/profiles/form.fields.stepItem easysocial/admin/profiles/form.fields.editorPage easysocial/admin/profiles/form.fields.config easysocial/site/albums/browser.list.item easysocial/site/albums/upload.item easysocial/site/dialog/default easysocial/site/friends/suggest.item easysocial/site/location/delete.confirmation easysocial/apps/user/locations/suggestion easysocial/site/photos/tags.item easysocial/site/photos/tags.menu.item easysocial/admin/profiles/form.privacy.custom.item easysocial/site/friends/default.empty easysocial/site/friends/list.assign easysocial/site/registration/dialog.error easysocial/apps/user/links/story.attachment.item easysocial/site/likes/item easysocial/site/uploader/preview".split(" "));
n.require.language.loader("COM_EASYSOCIAL_SCAN_COMPLETED COM_EASYSOCIAL_INDEXER_REINDEX_PROCESSING COM_EASYSOCIAL_INDEXER_REINDEX_FINISHED COM_EASYSOCIAL_INDEXER_REINDEX_RESTART COM_EASYSOCIAL_PROFILES_FORM_FIELDS_REQUIRE_MANDATORY_FIELDS COM_EASYSOCIAL_PROFILES_FORM_FIELDS_ITEM_CONFIG_LOADING COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_TITLE COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRMATION COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRM COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CANCEL COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_DELETING COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_TITLE COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CONFIRMATION COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CONFIRM COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CANCEL COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_DELETING COM_EASYSOCIAL_PROFILES_FORM_FIELDS_PARAMS_CORE_UNIQUE_KEY_SAVE_FIRST COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVING COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVED COM_EASYSOCIAL_PROFILES_FORM_FIELDS_CONFIGURE_PAGE COM_EASYSOCIAL_PROFILES_FORM_FIELDS_CONFIGURE_FIELD COM_EASYSOCIAL_PROFILES_FORM_FIELDS_UNSAVED_CHANGES COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES COM_EASYSOCIAL_CANCEL_BUTTON COM_EASYSOCIAL_ASSIGN_BUTTON COM_EASYSOCIAL_PROFILES_ASSIGN_USER_DIALOG_TITLE COM_EASYSOCIAL_CLOSE_BUTTON COM_EASYSOCIAL_REPORTS_VIEW_REPORTS_DIALOG_TITLE COM_EASYSOCIAL_REPORTS_ACTIONS_DIALOG_TITLE COM_EASYSOCIAL_FRIENDS_REQUEST_SENT COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_RECIPIENTS COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_MESSAGE COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_PUBLIC COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_MEMBER COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_FRIENDS_OF_FRIEND COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_FRIEND COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_ONLY_ME COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_CUSTOM COM_EASYSOCIAL_AT_LOCATION COM_EASYSOCIAL_ACTIVITY_APPS_UNHIDE_SUCCESSFULLY COM_EASYSOCIAL_COMMENTS_STATUS_SAVE_ERROR COM_EASYSOCIAL_COMMENTS_STATUS_LOADING COM_EASYSOCIAL_COMMENTS_STATUS_LOAD_ERROR COM_EASYSOCIAL_COMMENTS_STATUS_DELETING COM_EASYSOCIAL_COMMENTS_STATUS_DELETE_ERROR COM_EASYSOCIAL_LIKES_LIKE COM_EASYSOCIAL_LIKES_UNLIKE COM_EASYSOCIAL_COMMENTS_LOADED_OF_TOTAL COM_EASYSOCIAL_COMMENTS_STATUS_SAVING COM_EASYSOCIAL_COMMENTS_STATUS_SAVED COM_EASYSOCIAL_NO_BUTTON COM_EASYSOCIAL_CONVERSATION_REPLY_POSTED_SUCCESSFULLY COM_EASYSOCIAL_CONVERSATION_REPLY_FORM_EMPTY COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_PENDING_APPROVAL COM_EASYSOCIAL_FRIENDS_REQUEST_DIALOG_TITLE COM_EASYSOCIAL_FRIENDS_CANCEL_REQUEST_DIALOG_CANCELLED COM_EASYSOCIAL_FRIENDS_DIALOG_CANCEL_REQUEST COM_EASYSOCIAL_YES_CANCEL_MY_REQUEST_BUTTON COM_EASYSOCIAL_REGISTRATION_ERROR_DIALOG_TITLE COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_NOTICE COM_EASYSOCIAL_SEARCH_LOAD_MORE_ITEMS COM_EASYSOCIAL_STREAM_LOAD_PREVIOUS_STREAM_ITEMS COM_EASYSOCIAL_SUBSCRIPTION_INFO COM_EASYSOCIAL_FRIENDS_REQUEST_REJECTED COM_EASYSOCIAL_WITH_FRIENDS COM_EASYSOCIAL_AND_ONE_OTHER COM_EASYSOCIAL_AND_MANY_OTHERS COM_EASYSOCIAL_LOCATION_PERMISSION_ERROR COM_EASYSOCIAL_STORY_SUBMIT_ERROR COM_EASYSOCIAL_STORY_CONTENT_EMPTY COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_UNSUBSCRIBE COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_SUBSCRIBE COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_OK COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_SUBMIT COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_CANCEL COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_UNSUBSCRIBE COM_EASYSOCIAL_SUBSCRIPTION_ARE_YOU_SURE_UNSUBSCRIBE COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_SUBSCRIBE COM_EASYSOCIAL_STREAM_DIALOG_FEED COM_EASYSOCIAL_STREAM_BUTTON_CLOSE".split(" "));
(function(){var e=n.stylesheet({content:""})?"resolve":"reject";n.each(["easysocial/imgareaselect/default"],function(d,b){n.require.stylesheet.loader(b)[e]()})})()});
FD31.installer("EasySocial","scripts",function(n){EasySocial.module("admin",function(e){var d=this;EasySocial.require().library("uniform","chosen","flot").script("admin/sidebar/sidebar").done(function(b){b(".uniform, .check :checkbox, .radio :radio, input:file[data-uniform], .usergroups :checkbox").uniform();b("[data-chosen]").chosen({disable_search:!0});b("[data-chosen-search]").chosen({disable_search:!1});b("[data-sidebar]").implement(EasySocial.Controller.Sidebar.Sidebar);b("[data-sidebar-menu-toggle]").on("click",
function(){var a=b(this).parent("li"),c=a.find("ul");b(this).parent("li").hasClass("active")?(a.removeClass("active"),c.removeClass("in")):(a.addClass("active"),c.addClass("in"))});d.resolve()})});EasySocial.module("admin/sidebar/sidebar",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Sidebar.Sidebar",{defaultOptions:{intervalPendingUsers:5E3,"{versionNotice}":"[data-easysocial-version]","{usersBadge}":".menu-user > a .badge","{pendingUsersBadge}":".menu-user .menu-ies-vcard > .badge"}},
function(a){return{init:function(){a.versionChecks();a.checkPendingUsers()},versionChecks:function(){EasySocial.ajax("admin/controllers/easysocial/versionChecks").done(function(c,f,g,e){f&&(b("[data-es-version-header]").removeClass("latest").addClass("outdated"),b("[data-es-version-header]").find("[data-es-outdated]").data("local-version",g).data("online-version",e));a.versionNotice().html(c).show()})},monitorPendingUsers:function(){EasySocial.debug&&console.info("Start monitoring pending users with interval of "+
a.options.intervalPendingUsers+" seconds.");a.options.state=setTimeout(a.checkPendingUsers,a.options.intervalPendingUsers)},checkPendingUsers:function(){a.stopMonitorPendingUsers();setTimeout(function(){EasySocial.ajax("admin/controllers/users/getTotalPending",{},{type:"jsonp"}).done(function(b){0<b?(a.usersBadge().html(b),a.pendingUsersBadge().html(b)):a.usersBadge().html("");a.monitorPendingUsers()})},a.options.intervalPendingUsers)},stopMonitorPendingUsers:function(){clearTimeout(a.options.state)}}});
d.resolve()})});EasySocial.module("admin/alerts/discover",function(e){var d=this;EasySocial.require().script("progress/progress").language("COM_EASYSOCIAL_SCAN_COMPLETED").done(function(b){EasySocial.Controller("Alerts.Discover",{defaultOptions:{files:[],progressController:null,"{startButton}":"[data-alerts-discovery-start]","{progressBar}":"[data-alerts-discovery-progress]","{results}":"[data-alerts-discovery-result]"}},function(a){return{init:function(){a.initProgressBar()},reset:function(){a.results().html("");
a.options.progressController.reset()},initProgressBar:function(){a.progressBar().implement(EasySocial.Controller.Progress);a.options.progressController=a.progressBar().controller()},addLog:function(c){b("<tr>").append(b("<td>").html(c)).appendTo(a.results())},startIterating:function(){var c=a.options.files.shift();EasySocial.ajax("admin/controllers/alerts/scan",{file:c}).always(function(c,g,e){0<a.options.files.length?(a.options.progressController.touch("..."),a.addLog(g),a.startIterating()):(a.options.progressController.touch("..."),
a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.startButton().removeAttr("disabled"))})},"{startButton} click":function(b){a.reset();a.startButton().attr("disabled","disabled");EasySocial.ajax("admin/controllers/alerts/discoverFiles",{}).done(function(b,c){a.reset();a.options.files=b;0<a.options.files.length&&(a.options.progressController.begin(a.options.files.length),a.addLog(c),a.startIterating())})}}});d.resolve()})});EasySocial.module("progress/progress",function(e){EasySocial.Controller("Progress",
{defaultOptions:{current:0,eachWidth:null,total:null,progressClass:"progress progress-info progress-striped","{progressBar}":".bar","{progressResult}":".progress-result",view:{}}},function(e){return{init:function(){},reset:function(){e.options.current=0;e.eachWidth=null;e.total=null;e.progressBar().css("width","0%").html("")},begin:function(b){e.options.total=b;e.options.eachWidth=100/b;0<b&&e.element.addClass(e.options.progressClass).show()},touch:function(b){e.options.current+=e.options.eachWidth;
100<e.options.current&&(e.options.current=100);e.progressBar().css("width",e.options.current+"%");e.progressResult().html(Math.round(e.options.current)+"%")},completed:function(b){e.options.current=100;e.progressBar().css("width",e.options.current+"%");e.progressResult().html(Math.round(e.options.current)+"%")}}});this.resolve()});EasySocial.module("admin/badges/discover",function(e){var d=this;EasySocial.require().script("progress/progress").language("COM_EASYSOCIAL_SCAN_COMPLETED").done(function(b){EasySocial.Controller("Badges.Discover",
{defaultOptions:{files:[],progressController:null,"{startButton}":"[data-badgesDiscover-start]","{progressBar}":"[data-badgesDiscover-progress]","{results}":"[data-badgesDiscover-result]","{viewLog}":"[data-badgesDiscover-viewLog]"}},function(a){return{init:function(){a.initProgressBar();a.initLogging()},reset:function(){a.results().html("");a.initLogging();a.options.progressController.reset()},initLogging:function(){a.viewLog().hide()},initProgressBar:function(){a.progressBar().implement(EasySocial.Controller.Progress);
a.options.progressController=a.progressBar().controller()},addLog:function(c){b("<tr>").append(b("<td>").html(c)).appendTo(a.results())},startIterating:function(){var c=a.options.files.shift();EasySocial.ajax("admin/controllers/badges/scan",{file:c}).always(function(c,g){0<a.options.files.length?(a.options.progressController.touch("..."),a.addLog(g),a.startIterating()):(a.options.progressController.touch("..."),a.addLog(g),a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.viewLog().show(),a.startButton().removeAttr("disabled"))})},
"{startButton} click":function(c){a.reset();a.startButton().attr("disabled","disabled");EasySocial.ajax("admin/controllers/badges/discoverFiles",{}).done(function(c,g){a.options.files=c;0<a.options.files.length?(a.options.progressController.begin(a.options.files.length),a.addLog(g),a.startIterating()):(a.options.progressController.begin(1),a.options.progressController.completed("Discover Completed"),a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.startButton().removeAttr("disabled"))})},"{viewLog} click":function(){a.results().toggle()}}});
d.resolve()})});EasySocial.module("admin/grid/grid",function(e){var d=this;EasySocial.require().script("admin/grid/sort","admin/grid/publishing").done(function(b){EasySocial.Controller("Grid",{defaultOptions:{"{sortColumns}":"[data-table-grid-sort]","{ordering}":"[data-table-grid-ordering]","{direction}":"[data-table-grid-direction]","{task}":"[data-table-grid-task]","{searchInput}":"[data-table-grid-search-input]","{search}":"[data-table-grid-search]","{resetSearch}":"[data-table-grid-search-reset]",
"{checkAll}":"[data-table-grid-checkall]","{checkboxes}":"[data-table-grid-id]","{publishItems}":"[data-table-grid-publishing]","{itemRow}":"tr","{boxChecked}":"[data-table-grid-box-checked]","{filters}":"[data-table-grid-filter]"}},function(a){return{init:function(){a.implementSortable();a.implementPublishing()},"{filters} change":function(){a.setTask("");a.submitForm()},"{search} click":function(){a.submitForm()},"{resetSearch} click":function(){a.searchInput().val("");a.submitForm()},submitForm:function(){a.element.submit()},
setTask:function(b){a.task().val(b)},setOrdering:function(b){a.ordering().val(b)},setDirection:function(b){a.direction().val(b)},setTotalChecked:function(b){a.boxChecked().val(b)},toggleSelectRow:function(a){a=a.find("input[name=cid\\[\\]]");!0==b(a).prop("checked")?b(a).prop("checked",!1):b(a).prop("checked",!0)},selectRow:function(a){a=a.find("input[name=cid\\[\\]]");b(a).prop("checked",!0)},implementSortable:function(){a.sortColumns().implement(EasySocial.Controller.Grid.Sort,{"{parent}":a})},
implementPublishing:function(){a.publishItems().implement(EasySocial.Controller.Grid.Publishing,{"{parent}":a})},"{checkAll} change":function(c,f){a.checkboxes().prop("checked",b(c).is(":checked"));var g=b(c).is(":checked")?a.checkboxes().length:0;a.setTotalChecked(g)}}});d.resolve()})});EasySocial.module("admin/grid/sort",function(e){EasySocial.Controller("Grid.Sort",{defaultOptions:{items:"[data-grid-sort-item]"}},function(e){return{init:function(){},"{self} click":function(){var b=e.element.data("direction"),
a=e.element.data("sort");e.parent.setOrdering(a);e.parent.setDirection(b);e.parent.setTask("");e.parent.submitForm()}}});this.resolve()});EasySocial.module("admin/grid/publishing",function(e){EasySocial.Controller("Grid.Publishing",{defaultOptions:{}},function(e){return{init:function(){},"{self} click":function(b){b=e.element.parents("tr");var a=e.element.data("task");e.parent.selectRow(b);e.parent.setTask(a);e.parent.submitForm()}}});this.resolve()});EasySocial.module("admin/grid/ordering",function(e){EasySocial.Controller("Grid.Ordering",
{defaultOptions:{"{moveUp}":"[data-grid-order-up]","{moveDown}":"[data-grid-order-down]",row:null}},function(d){return{init:function(){d.options.row=d.element.parents("tr")},selectRow:function(){var b=d.options.row.find("input[name=cid\\[\\]]");e(b).prop("checked",!0)},"{moveUp} click":function(){d.selectRow();e.Joomla("submitform",["moveUp"])},"{moveDown} click":function(){d.selectRow();e.Joomla("submitform",["moveDown"])}}});this.resolve()});EasySocial.module("admin/indexer/indexer",function(e){var d=
this;EasySocial.require().language("COM_EASYSOCIAL_INDEXER_REINDEX_PROCESSING","COM_EASYSOCIAL_INDEXER_REINDEX_FINISHED","COM_EASYSOCIAL_INDEXER_REINDEX_RESTART").view("site/loading/small").done(function(b){EasySocial.Controller("Indexer",{defaultOptions:{"{startButton}":"[data-start-button]","{indexerBar}":"[data-indexer-bar]","{indexerResult}":"[data-indexer-result]","{indexerMessage}":"[data-indexer-message]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){},"{startButton} click":function(){a.runIndex(0);
a.indexerMessage().html(b.language("COM_EASYSOCIAL_INDEXER_REINDEX_PROCESSING"));a.indexerMessage().show();a.startButton().hide()},runIndex:function(b){EasySocial.ajax("admin/controllers/indexer/indexing",{max:b},{beforeSend:function(){}}).done(function(b,c){0>b&&(c="100");a.updateProgress(c);0<=b&&a.runIndex(b)}).fail(function(b){a.setMessage(b)}).always(function(){})},updateProgress:function(c){a.indexerBar().css("width",c+"%");a.indexerResult().html(c+"%");100==c&&(a.indexerMessage().html(b.language("COM_EASYSOCIAL_INDEXER_REINDEX_FINISHED")),
a.startButton().html(b.language("COM_EASYSOCIAL_INDEXER_REINDEX_RESTART")),a.startButton().show())}}});d.resolve()})});EasySocial.module("admin/mailer/mailer",function(e){EasySocial.Controller("Mailer",{defaultOptions:{"{item}":"[data-mailer-item]"}},function(e){return{init:function(){e.item().implement(EasySocial.Controller.Mailer.Item)}}});EasySocial.Controller("Mailer.Item",{defaultOptions:{"{preview}":"[data-mailer-item-preview]"}},function(e){return{init:function(){e.options.id=e.element.data("id")},
"{preview} click":function(b,a){EasySocial.dialog({content:EasySocial.ajax("admin/views/mailer/preview",{id:e.options.id})});console.log(e.options.id)}}});this.resolve()});EasySocial.module("admin/migrators/migrator",function(e){var d=this;EasySocial.require().script("progress/progress").done(function(b){EasySocial.Controller("Migrators.Migrator",{defaultOptions:{component:null,processState:0,progressController:null,mapping:null,"{initiateButton}":"[data-initiate-migration]","{progressBar}":".discoverProgress",
"{results}":".scannedResult","{viewLog}":".viewLog","{customFieldsMap}":"[data-custom-fields-map]","{resultForm}":"[data-migration-result]","{startWidget}":"[data-start-widget]","{fieldItem}":"[data-field-item]","{startMigrationButton}":"[data-start-migration]","{rows}":"[data-row-item]","{selection}":"[data-field-item]","{jomsocialBackButton}":"[data-jomsocial-back-button]"}},function(a){return{init:function(){a.initProgressBar();a.initLogging()},showCustomFields:function(){a.startWidget().slideUp();
a.customFieldsMap().slideDown()},showResultForm:function(){a.customFieldsMap().slideUp();"com_community"!=a.options.component&&a.startWidget().slideUp();a.resultForm().slideDown()},startMigration:function(){a.showResultForm();1!=a.options.processState&&(a.options.processState=1,a.reset(),EasySocial.ajax("admin/controllers/migrators/check",{component:a.options.component}).done(function(b){b.isvalid?(a.options.progressController.begin(b.count),a.startIterating("")):(a.results().show(),a.addLog("Error: "+
b.message),a.options.processState=0)}))},reset:function(){a.results().html("");a.initLogging();a.options.progressController.reset()},initLogging:function(){a.viewLog().hide()},initProgressBar:function(){a.progressBar().implement(EasySocial.Controller.Progress);a.options.progressController=a.progressBar().controller()},addLog:function(c){b("<li>").html(c).appendTo(a.results())},startIterating:function(c){null==a.options.mapping&&0<a.selection().length&&(a.options.mapping=b("#adminForm").serializeArray());
EasySocial.ajax("admin/controllers/migrators/process",{component:a.options.component,item:c,mapping:a.options.mapping}).always(function(b){b["continue"]?(a.options.progressController.touch("Discovering..."),a.addLog(b.message),a.startIterating(b.item)):(a.options.progressController.touch("Discover Completed"),a.addLog(b.message),a.addLog("migration process completed."),a.viewLog().show(),a.jomsocialBackButton().show(),a.options.processState=0)})},"{fieldItem} change":function(a){""==b(a).val()?b(a).parents("[data-row-item]").removeClass("success").addClass("error"):
b(a).parents("[data-row-item]").removeClass("error").addClass("success")},"{startMigrationButton} click":function(){0<a.selection().length&&a.selection().each(function(a,f){""==b(f).val()?b(f).parents("[data-row-item]").removeClass("success").addClass("error"):b(f).parents("[data-row-item]").removeClass("error").addClass("success")});a.rows().hasClass("error")?EasySocial.dialog({content:EasySocial.ajax("admin/views/migrators/confirmMigration"),bindings:{"{submitButton} click":function(){a.startMigration();
EasySocial.dialog().close()}}}):a.startMigration()},"{initiateButton} click":function(b){a.showCustomFields()},"{viewLog} click":function(){a.results().toggle()}}});d.resolve()})});EasySocial.module("admin/points/discover",function(e){var d=this;EasySocial.require().script("progress/progress").language("COM_EASYSOCIAL_SCAN_COMPLETED").done(function(b){EasySocial.Controller("Points.Discover",{defaultOptions:{files:[],progressController:null,"{startButton}":"[data-points-discovery-start]","{progressBar}":".discoverProgress",
"{results}":"[data-points-discovery-result]"}},function(a){return{init:function(){a.initProgressBar()},reset:function(){a.results().html("");a.options.progressController.reset()},initProgressBar:function(){a.progressBar().implement(EasySocial.Controller.Progress);a.options.progressController=a.progressBar().controller()},addLog:function(c){b("<tr>").append(b("<td>").html(c)).appendTo(a.results())},startIterating:function(){var c=a.options.files.shift();EasySocial.ajax("admin/controllers/points/scan",
{file:c}).always(function(c,g,e){0<a.options.files.length?(a.options.progressController.touch("..."),a.addLog(g),a.startIterating()):(a.options.progressController.touch("..."),a.addLog(g),a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.startButton().removeAttr("disabled"))})},"{startButton} click":function(c){a.reset();a.startButton().attr("disabled","disabled");EasySocial.ajax("admin/controllers/points/discoverFiles",{}).done(function(c,g){a.reset();a.options.files=c;0<a.options.files.length?
(a.options.progressController.begin(a.options.files.length),a.addLog(g),a.startIterating()):(a.options.progressController.begin(1),a.options.progressController.completed("Discover Completed"),a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.startButton().removeAttr("disabled"))})}}});d.resolve()})});EasySocial.module("admin/privacy/discover",function(e){var d=this;EasySocial.require().script("progress/progress").done(function(b){EasySocial.Controller("Privacy.Discover",{defaultOptions:{files:[],
progressController:null,"{startButton}":".scanRules","{progressBar}":".discoverProgress","{results}":".scannedResult","{viewLog}":".viewLog",view:{}}},function(a){return{init:function(){a.initProgressBar();a.initLogging()},reset:function(){a.results().html("");a.initLogging();a.options.progressController.reset()},initLogging:function(){a.viewLog().hide()},initProgressBar:function(){a.progressBar().implement(EasySocial.Controller.Progress);a.options.progressController=a.progressBar().controller()},
addLog:function(c){b("<li>").html(c).appendTo(a.results())},startIterating:function(){var b=a.options.files.shift();EasySocial.ajax("admin/controllers/privacy/scan",{file:b}).always(function(b){0<a.options.files.length?(a.options.progressController.touch("Discovering..."),a.addLog("Scanned "+b.file+" : "+b.rules.length+" rules installed."),a.startIterating()):(a.options.progressController.touch("Discover Completed"),a.addLog("Scanned "+b.file+" : "+b.rules.length+" rules installed."),a.addLog("Scanning completed."),
a.viewLog().show(),a.startButton().removeAttr("disabled"))})},"{startButton} click":function(c){a.reset();a.startButton().attr("disabled","disabled");EasySocial.ajax("admin/controllers/privacy/discoverFiles",{}).done(function(c){a.options.files=c;0<a.options.files.length?(a.options.progressController.begin(a.options.files.length),a.results().hide(),a.addLog("Found a total of "+c.length+" rules file in the site."),a.startIterating()):(a.options.progressController.begin(1),a.options.progressController.completed("Discover Completed"),
a.addLog(b.language("COM_EASYSOCIAL_SCAN_COMPLETED")),a.startButton().removeAttr("disabled"))})},"{viewLog} click":function(){a.results().toggle()}}});d.resolve()})});EasySocial.module("admin/profiles/avatar",function(e){var d=this;EasySocial.require().script("uploader/uploader").done(function(){EasySocial.Controller("Profiles.Avatar",{defaultOptions:{token:null,"{fileUploader}":"[data-profile-avatars-uploader]","{startUploadButton}":"[data-profile-avatars-startupload]","{avatarList}":"[data-profile-avatars-list]",
"{avatarEmpty}":"[data-profile-avatars-empty]","{avatarItem}":"[data-profile-avatars-item]","{messagePlaceholder}":"[data-profile-avatars-message]","{removeFile}":".removeFile","{clearUploadedItems}":"[data-uploader-clear]"}},function(b){return{init:function(){b.options.id=b.element.data("id");b.initUploader();b.initAvatar()},initUploader:function(){b.fileUploader().implement(EasySocial.Controller.Uploader,{url:e.indexUrl+"?option=com_easysocial&namespace=admin/controllers/profiles/uploadDefaultAvatars&"+
b.options.token+"=1&tmpl=component&format=ajax&uid="+b.options.id})},initAvatar:function(){b.avatarItem().implement("EasySocial.Controller.Profiles.Avatar.Item",{"{parent}":b,items:b.avatarItem})},addMessage:function(a){b.clearMessage();b.setMessage(a)},"{removeFile} click":function(a,c){var f=e(a).parents("li").attr("id");b.fileUploader().controller().removeItem(f)},"{startUploadButton} click":function(){b.fileUploader().controller().startUpload()},"{fileUploader} UploadProgress":function(a,b,f){a=
f.percent;f=e("#"+f.id).find(".progressBar");f.show();f.find(".bar").css("width",a+"%")},"{fileUploader} FileUploaded":function(a,c,f,g){void 0!=g[0]&&(a=g[0].data[0],b.avatarEmpty().hide(),b.avatarList().prepend(a),b.clearUploadedItems().show(),b.initAvatar())},"{clearUploadedItems} click":function(){b.fileUploader().controller().reset();b.clearUploadedItems().hide()}}});EasySocial.Controller("Profiles.Avatar.Item",{defaultOptions:{id:null,"{deleteLink}":"[data-avatar-delete]","{setDefaultAvatar}":"[data-avatar-default]"}},
function(b){return{init:function(){b.options.id=b.element.data("id")},"{setDefaultAvatar} click":function(a,c){EasySocial.ajax("admin/controllers/avatars/setDefault",{id:b.options.id}).done(function(a){b.parent.avatarItem().removeClass("default");b.element.addClass("default");b.parent.addMessage(a)})},"{deleteLink} click":function(){EasySocial.dialog({content:EasySocial.ajax("admin/views/profiles/confirmDeleteAvatar"),bindings:{"{deleteButton} click":function(a,c){e(a).addClass("btn-loading");EasySocial.ajax("admin/controllers/avatars/delete",
{id:b.options.id}).done(function(a){b.element.remove();0==b.parent.avatarList().children().length&&b.parent.avatarEmpty().show();b.parent.addMessage(a);EasySocial.dialog().close()})}}})}}});d.resolve()})});EasySocial.module("uploader/uploader",function(e){var d=this;EasySocial.require().library("plupload").view("site/uploader/queue.item").script("uploader/queue").done(function(){EasySocial.Controller("Uploader",{defaults:{url:e.indexUrl+"?option=com_easysocial&controller=uploader&task=uploadTemporary&format=json&tmpl=component&"+
EasySocial.getToken()+"=1",uploaded:[],query:"",plupload:"",dropArea:"uploaderDragDrop",extensionsAllowed:"jpg,jpeg,png,gif",temporaryUpload:!1,files:[],"{uploaderForm}":"[data-uploader-form]","{uploadButton}":"[data-uploader-browse]","{uploadArea}":".uploadArea","{queue}":"[data-uploaderQueue]","{queueItem}":"[data-uploaderQueue-item]","{emptyFiles}":"[data-uploader-empty]","{removeFile}":"[data-uploaderQueue-remove]","{uploadCounter}":".uploadCounter",view:{queueItem:"site/uploader/queue.item"}}},
function(b){return{init:function(){b.queue().implement(EasySocial.Controller.Uploader.Queue);b.options.temporaryUpload&&(b.options.url=e.indexUrl+"?option=com_easysocial&controller=uploader&task=uploadTemporary&format=json&tmpl=component&"+EasySocial.getToken()+"=1");""!=b.options.query&&(b.options.url=b.options.url+"&"+b.options.query);b.uploaderForm().implement("plupload",{settings:{url:b.options.url,drop_element:b.options.dropArea,filters:[{title:"Allowed File Type",extensions:b.options.extensionsAllowed}]},
"{uploader}":"[data-uploader-form]","{uploadButton}":"[data-uploader-browse]"},function(){b.options.plupload=this.plupload})},"{uploaderForm} FilesAdded":function(a,c,f,g){b.addFiles(g);b.options.temporaryUpload&&b.startUpload()},"{uploaderForm} UploadProgress":function(a,c,f,g){b.queueItem("#"+g.id).trigger("UploadProgress",g)},"{uploaderForm} FileUploaded":function(a,c,f,g,e){b.queueItem("#"+g.id).trigger("FileUploaded",[g,e])},"{uploaderForm} UploadComplete":function(a,c,f,g){b.options.uploading=
!1},"{uploaderForm} Error":function(a,c,f,g){b.clearMessage();b.setMessage({message:g.message,type:"error"})},"{uploaderForm} FileError":function(a,c,f,g,e){b.setMessage({message:e.message,type:"error"});b.queueItem("#"+g.id).trigger("FileError",[g,e])},addFiles:function(a){e.each(a,function(a,f){f.size=b.formatSize(f.size);var g=b.view.queueItem({file:f,temporaryUpload:b.options.temporaryUpload});e(g).implement(EasySocial.Controller.Uploader.Queue.Item,{"{uploader}":b});b.options.files.push(f);b.emptyFiles().hide();
b.queue().append(g)})},formatSize:function(a){return parseInt(a/1024)},reset:function(){b.queueItem().remove()},removeItem:function(a){var c=e("#"+a),c=e(c).find("input[name=upload-id\\[\\]]").val();EasySocial.ajax("site/controllers/uploader/delete",{id:c}).done(function(){e("#"+a).remove();b.options.plupload.removeFile(b.options.plupload.getFile(a))})},startUpload:function(){b.upload()},upload:function(){0<b.options.plupload.files.length&&(b.options.uploading=!0,b.options.plupload.start())},hasFiles:function(){return 0<
b.options.files.length}}});d.resolve()})});EasySocial.module("uploader/queue",function(e){var d=this;EasySocial.require().view("site/uploader/queue.item").done(function(b){EasySocial.Controller("Uploader.Queue",{defaults:{"{item}":"[data-uploaderQueue-item]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Uploader.Queue.Item)}}});EasySocial.Controller("Uploader.Queue.Item",{defaultOptions:{"{delete}":"[data-uploaderQueue-remove]","{progress}":"[data-uploaderQueue-progress]",
"{progressBar}":"[data-uploaderQueue-progressBar]","{status}":"[data-uploaderQueue-status]","{id}":"[data-uploaderQueue-id]"}},function(a){return{init:function(){a.uploader.options.temporaryUpload&&(a.idTemplate=a.id().toHTML(),a.id().remove())},"{delete} click":function(){a.uploader.removeItem(a.element.attr("id"))},"{self} FileUploaded":function(c,f,g,e){a.uploader.options.temporaryUpload&&b.buildHTML(a.idTemplate).val(e.id).appendTo(a.element);5==g.status&&(a.element.addClass("is-done"),a.status().html("Done"))},
"{self} UploadProgress":function(b,f,g){a.status().html(g.percent+"%");a.progressBar().css("width",g.percent+"%")},"{self} FileError":function(){a.element.removeClass("is-done is-queue").addClass("is-error");a.progress().removeClass("progress-danger progress-success progress-info progress-warning").addClass("progress-danger");a.status().html("Error")}}});d.resolve()})});EasySocial.module("admin/profiles/fields",function(e){var d=this;EasySocial.require().library("ui/draggable","ui/sortable","ui/droppable").script("field").view("admin/profiles/form.fields.editorItem",
"admin/profiles/form.fields.stepItem","admin/profiles/form.fields.editorPage","admin/profiles/form.fields.config","admin/profiles/dialog.move.field").language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_REQUIRE_MANDATORY_FIELDS","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_ITEM_CONFIG_LOADING","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_TITLE","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRMATION","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRM","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CANCEL",
"COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_DELETING","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_TITLE","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CONFIRMATION","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CONFIRM","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CANCEL","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_DELETING","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_PARAMS_CORE_UNIQUE_KEY_SAVE_FIRST","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVING",
"COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVED","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_CONFIGURE_PAGE","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_CONFIGURE_FIELD","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_UNSAVED_CHANGES","COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES").done(function(){var b,a,c,f,g,k={},h={},l={},m={},q={},r={pages:[],fields:[]};EasySocial.Controller("Fields",{defaultOptions:{id:0,"{wrap}":"[data-fields-wrap]","{browser}":"[data-fields-browser]","{editor}":"[data-fields-editor]","{steps}":"[data-fields-steps]",
"{config}":"[data-fields-config]","{saveForm}":"[data-fields-save]",view:{config:"admin/profiles/form.fields.config"}}},function(d){return{init:function(){b=d;d.options.id=d.element.data("id");a=d.addPlugin("browser");c=d.addPlugin("editor");f=d.addPlugin("steps");e.when.apply(null,[a.state,c.state,f.state]).done(function(){b.trigger("controllersReady")})},changed:!1,change:function(){d.changed=!0},"{window} beforeunload":function(a,b){if(d.changed)return e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_UNSAVED_CHANGES")},
"{saveForm} click":function(){d.save()},save:function(a,k){var p=e.Deferred();"savecopy"===k&&(d.changed=!0);if(!d.changed)return p.resolve(),p;EasySocial.dialog({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVING"),width:400,height:150});b.trigger("saving");if(g&&g.state&&!g.checkConfig())return p.reject(e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES")),p;l=e.extend(!0,{},h);var s=[];e.each(f.step(),function(a,b){b=e(b);var f=c.getPage(b.data("id"));s.push(f._export())});
if(0<e._.keys(l).length)return b.trigger("saved",[!1]),p.reject(e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_REQUIRE_MANDATORY_FIELDS")),p;b.changed=!1;s=JSON.stringify(s);EasySocial.ajax("admin/controllers/profiles/saveFields",{id:a||d.options.id,data:s,deleted:r,task:k}).done(function(a){b.trigger("saved");EasySocial.dialog({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_SAVED"),width:400,height:150});setTimeout(EasySocial.dialog().close,2E3);p.resolve()});return p},updateResult:function(a){e.each(a,
function(a,b){var g=f.step().eq(a).data("id"),e=c.getPage(g);f.updateResult(a,b.id);e.updateResult(g,b)})},"{self} doneConfiguring":function(){d.element.removeClass("editting")},loadConfiguration:function(a,b){d.element.addClass("editting");var c=e(d.view.config());g=c.addController("EasySocial.Controller.Fields.Config",{controller:{item:a}});"page"===b?a.pageHeader().append(c):a.element.append(c);d.element.trigger("loadingConfig",[b])}}});EasySocial.Controller("Fields.Browser",{defaultOptions:{"{browser}":"[data-fields-browser]",
"{mandatory}":"[data-fields-browser-group-mandatory]","{standard}":"[data-fields-browser-group-standard]","{list}":"[data-fields-browser-list]","{item}":"[data-fields-browser-item]",affixClass:"es-browser-affix"}},function(a){return{state:e.Deferred(),init:function(){a.registerApps();a.ready();a.affixHandler();a.initAffix()},ready:function(){a.state.resolve()},"{parent} controllersReady":function(){var b=f.getCurrentStep().data("id");a.initDraggable(b)},"{parent} pageChanged":function(b,c,f,g){a.item().draggable("destroy");
a.initDraggable(g)},"{parent} pageAdded":function(b,c,f,g){a.item().draggable("destroy");a.initDraggable(g)},initDraggable:function(b){a.item().draggable({revert:"invalid",helper:"clone",connectToSortable:"[data-fields-editor-page-items-"+b+"]"})},affixHandler:function(){var b=e(window),c=a.parent.wrap().offset().top,b=b.scrollTop();b>c&&!a.browser().hasClass(a.options.affixClass)&&a.browser().addClass(a.options.affixClass);b<=c&&a.browser().hasClass(a.options.affixClass)&&a.browser().removeClass(a.options.affixClass)},
initAffix:function(){e(window).scroll(a.affixHandler)},registerApps:function(){e.each(a.item(),function(a,b){b=e(b);var c=b.data("id");k[c]={id:c,element:b.data("element"),title:b.data("title"),params:b.data("params"),core:b.data("core"),unique:b.data("unique"),item:b};b.data("core")&&(h[c]=k[c])})},checkout:function(a){void 0!==l[a]&&delete l[a]},"{item} click":function(a){var b=c.currentPage();a=a.data("id");b.addNewField(a)},"{parent} fieldAdded":function(b,c,f){(b=k[f])&&b.core&&(b.item.hide(),
c=a.mandatory().find(a.item.selector).filter(":visible"),a.mandatory().toggle(0<c.length));b&&b.unique&&b.item.hide()},"{parent} fieldDeleted":function(b,c,f,g){(b=k[f])&&b.core?(b.item.show(),a.mandatory().show()):b&&b.unique&&b.item.show()}}});EasySocial.Controller("Fields.Config",{defaultOptions:{"{config}":"[data-fields-config]","{header}":"[data-fields-config-header]","{close}":"[data-fields-config-close]","{form}":"[data-fields-config-form]","{param}":"[data-fields-config-param]","{tabnav}":"[data-fields-config-tab-nav]",
"{tabcontent}":"[data-fields-config-tab-content]","{done}":"[data-fields-config-done]"}},function(a){return{init:function(){},state:!1,load:function(c){a.state=!0;c.find("[data-fields-config-param-choices]").addController("EasySocial.Controller.Config.Choices",{controller:{item:a.item}});c.find("h4").hide();a.header().html(c.find("h4").html());a.form().html(c);a.item.options.newfield&&a.param("[data-fields-config-param-field-unique_key]").attr("disabled",!0).val(e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_PARAMS_CORE_UNIQUE_KEY_SAVE_FIRST"));
0<a.tabnav().length&&a.tabnav().find('a[data-tabname="core"]').tab("show");a.populateConfig();c=a.element.height();b.wrap().css("padding-bottom",c+"px");b.trigger("configLoaded")},"{close} click":function(b,c){a.closeConfig()},"{done} click":function(b,c){a.closeConfig()},closeConfig:function(){var c=a.populateConfig();a.checkConfig(c)?(a.item.updateHtml(a.form().html()),a.item.content().trigger("onConfigSave",[c]),a.element.remove(),g=null,b.trigger("doneConfiguring")):EasySocial.dialog({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES"),
width:400,height:100})},"{parent} loadingConfig":function(b,c,f){void 0!==f&&"field"!=f&&(b=e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_CONFIGURE_"+f.toUpperCase()),a.header().html(b));a.config().show();a.close().hide();a.form().html(e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_ITEM_CONFIG_LOADING"))},"{parent} configLoaded":function(b,c){a.close().show()},"{param} change":function(b){a.paramChanged(b)},"{param} keyup":function(b){a.paramChanged(b)},paramChanged:function(c){c=c.data("name");
var f=a.getConfigValue(c);"boolean"===a.item.appParams[c].type&&(f=!!f);a.item.content().trigger("onConfigChange",[c,f]);b.change()},getConfigValue:function(b){var c=a.item.appParams[b],f=a.param().filterBy("name",b);if(0!==f.length){var g="";switch(c.type){case "choices":g=[];e.each(f.find("li"),function(a,b){b=e(b);var c=b.find("[data-fields-config-param-choice-title]"),f=b.find("[data-fields-config-param-choice-value]"),d=b.find("[data-fields-config-param-choice-default]");g.push({id:b.data("id"),
title:c.val(),value:f.val(),"default":d.val()});c.attr("value",c.val());f.attr("value",f.val());d.attr("value",d.val())});break;case "boolean":b=f.val();g="true"===b||"1"===b||1===b?1:0;f.attr("value",g);break;case "checkbox":g=[];e.each(c.option,function(a,b){var c=f.filter("[data-fields-config-param-option-"+b.name+"]");0<c.length&&c.is(":checked")?(g.push(b.name),c.attr("checked","checked")):c.removeAttr("checked")});break;case "list":case "select":case "dropdown":g=0<f.length?f.val():c["default"]||
"";f.find("option").prop("selected",!1);f.find('option[value="'+g+'"]').prop("selected",!0);break;default:g=0<f.length?f.val():c["default"]||"",f.attr("value",g)}return g}},populateConfig:function(){var b={};e.each(a.item.appParams,function(c,f){var g=a.getConfigValue(c);if(void 0===g)return!1;b[c]=g});a.item.trigger("onPopulateConfig",[b]);return b},checkConfig:function(b){void 0===b&&(b=a.populateConfig());var c=!0;e.each(b,function(b,f){switch(a.item.appParams[b].type){case "choices":var g=[];
e.each(f,function(a,b){e.isEmpty(b.value)&&!e.isEmpty(b.title)&&(b.value=b.title.toLowerCase().replace(" ",""));if(!e.isEmpty(b.value)&&-1<e.inArray(b.value,g))return c=!1;g.push(b.value)})}if(!1===c)return!1});return c},"{parent} fieldDeleted":function(){a.state&&b.trigger("doneConfiguring")},"{parent} pageDeleted":function(){a.state&&b.trigger("doneConfiguring")},"{parent} pageAdded":function(){a.state&&b.trigger("doneConfiguring")},"{parent} pageChanged":function(){a.state&&b.trigger("doneConfiguring")}}});
EasySocial.Controller("Fields.Steps",{defaultOptions:{"{steps}":"[data-fields-step]","{step}":"[data-fields-step-item]","{stepLink}":"[data-fields-step-item-link]","{add}":"[data-fields-step-add]",view:{stepItem:"admin/profiles/form.fields.stepItem"}}},function(a){return{state:e.Deferred(),init:function(){a.ready()},ready:function(){a.state.resolve()},"{parent} controllersReady":function(){a.initSort()},initSort:function(){a.steps().sortable({items:a.step.selector,placeholder:"ui-state-highlight",
cursor:"move",helper:"clone",forceHelperSize:!0,stop:function(){e(".tooltip-es").remove()}})},"{parent} pageDeleted":function(b,c,g){a.deleteStep(g);0<f.step().length&&f.stepLink(":first").tab("show")},"{step} click":function(a,f){if(!a.hasClass("active")){var g=a.data("id");b.trigger("pageChanged",[c.getPage(g),g])}},"{add} click":function(){var b=e.uid("step");a.addStep(b);c.addPage(b);a.stepLink(":last").tab("show")},addStep:function(b){a.add().before(a.view.stepItem({uid:b}))},getStep:function(b){return a.step().filterBy("id",
b)},getStepLink:function(b){return a.stepLink().filterBy("id",b)},deleteStep:function(b){a.getStep(b).remove()},getCurrentStep:function(){return a.step(".active")},currentStepIndex:function(){return a.step().index(a.step(".active"))+1},updateResult:function(b,c){var f=a.step(":eq("+b+")");if(f.data("id")!=c){var g=f.data("id");f.removeAttr("data-fields-step-item-"+g);f.attr("data-fields-step-item-"+c,!0);f.data("id",c);f.attr("data-id",c);f=a.stepLink().eq(b);f.removeAttr("data-fields-step-item-link-"+
g);f.attr("data-fields-step-item-link-"+c,!0);f.attr("href","#formStep_"+c)}},toObject:function(){var b=[];e.each(a.stepLink(),function(a,c){c=e(c);b.push({uid:c.data("id"),title:c.text(),description:c.attr("data-original-title")})});return b}}});EasySocial.Controller("Fields.Editor",{defaultOptions:{"{editor}":"[data-fields-editor]","{page}":"[data-fields-editor-page]","{items}":"[data-fields-editor-page-items]","{item}":"[data-fields-editor-page-item]",view:{editorPage:"admin/profiles/form.fields.editorPage"}}},
function(a){return{state:e.Deferred(),init:function(){a.ready()},ready:function(){a.state.resolve()},"{parent} controllersReady":function(){a.page().addController("EasySocial.Controller.Fields.Editor.Page")},currentPage:function(){return a.page(".active").controller()},addPage:function(c){var f=a.view.editorPage({uid:c});f.addController("EasySocial.Controller.Fields.Editor.Page",{uid:c,newpage:!0});a.editor().append(f);a.page().trigger("pageAdded",[f,c]);b.change()},getPage:function(b){return a.page().filterBy("id",
b).controller()},"{parent} saving":function(b,c){a.element.addClass("saving")},"{parent} saved":function(b,c,f){a.element.removeClass("saving")}}});EasySocial.Controller("Fields.Editor.Page",{defaultOptions:{pageid:0,uid:0,newpage:!1,"{items}":"[data-fields-editor-page-items]","{item}":"[data-fields-editor-page-item]","{pageHeader}":"[data-fields-editor-page-header]","{content}":"[data-fields-editor-page-header]","{pageTitle}":"[data-fields-editor-page-title]","{pageDescription}":"[data-fields-editor-page-description]",
"{inputTitle}":"[data-fields-editor-page-title-input]","{inputDescription}":"[data-fields-editor-page-description-input]","{pageVisibleRegistration}":"[data-fields-editor-page-visible-registration]","{pageVisibleEdit}":"[data-fields-editor-page-visible-edit]","{pageVisibleView}":"[data-fields-editor-page-visible-view]","{pageDelete}":"[data-fields-editor-page-delete]","{pageEdit}":"[data-fields-editor-page-edit]","{pageInfo}":"[data-fields-editor-page-info]","{pageInfoDone}":"[data-fields-editor-page-done]",
view:{editorItem:"admin/profiles/form.fields.editorItem"}}},function(d){return{init:function(){d.options.newpage||(d.options.uid=d.options.pageid=d.element.data("id"));d.registerPage();d.item().addController("EasySocial.Controller.Fields.Editor.Item",{pageid:d.options.uid});d.checkPageDeleteButton();d.initSort()},fields:{},getStep:function(){return f.getStep(d.options.uid)},registerPage:function(){q[d.options.uid]=d},initSort:function(){d.items().sortable({items:d.item.selector,handle:"[data-fields-editor-page-item-handle]",
placeholder:"ui-state-highlight",cursor:"move",helper:"clone",forceHelperSize:!0,stop:function(b,c){if(c.item.is(a.item.selector)){var f=c.item.data("id"),g=d.createPlaceholder();c.item.replaceWith(g);d.createNewField(f,g)}}})},addNewField:function(a){var c=d.createPlaceholder();d.items().append(c);e.scrollTo(c,200);d.createNewField(a,c);b.change()},createPlaceholder:function(){var a=e.uid("newfield");return d.view.editorItem({uid:a})},createNewField:function(a,c){b.trigger("fieldAdded",[a]);d.getFieldHtml(a).done(function(b){b=
e.parseHTML(b,document,!0);b=e(b);c.replaceWith(b);b.filter('[data-appid="'+a+'"]').addController("EasySocial.Controller.Fields.Editor.Item",{controller:{page:d},appid:a,pageid:d.options.uid,newfield:!0})}).fail(function(a){c.html(a)})},getFieldHtml:function(a){var c=e.Deferred();void 0===k[a].html?EasySocial.ajax("admin/controllers/fields/renderSample",{appid:a,profileid:b.options.id}).done(function(b){k[a].html=b;c.resolve(b)}).fail(function(a){c.reject(a)}):c.resolve(k[a].html);return c},"{pageHeader} click":function(a,
b){if(e(b.target).not("[data-fields-editor-page-delete]")&&!a.hasClass("editting")){if(g&&g.state)if(g.checkConfig())g.closeConfig();else{EasySocial.dialog({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES"),width:400,height:100});return}d.loadConfiguration()}},loadConfiguration:function(){b.loadConfiguration(d,"page");d.pageHeader().addClass("editting");d.getPageConfig().done(function(){var a=e(d.html);g.load(a)}).fail(function(a){g.load(a)})},updateHtml:function(a){d.html=
a},getPageConfig:function(){var a=e.Deferred();e.isEmptyObject(d.params)?EasySocial.ajax("admin/controllers/profiles/getPageConfig",{pageid:d.options.pageid}).done(function(b,c,f){d.params=b;d.values=c;d.html=f;d.appParams=b;a.resolve()}).fail(function(b){a.reject(b)}):a.resolve();return a},getConfigValues:function(){return d.values},"{content} onConfigChange":function(a,c,g,e){d.values[g]=e;a=f.getStepLink(d.options.uid);"title"===g&&(a.text(e),d.pageTitle().html(e));"description"===g&&(a.attr("data-original-title",
e),d.pageDescription().html(e));b.change()},"{pageDelete} click":function(a){if(a.enabled()){a.disabled(!0);if(1==c.page().length)return a.enabled(!0),!1;EasySocial.dialog({width:400,height:150,title:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_TITLE"),content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRMATION"),showOverlay:!1,buttons:[{name:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CANCEL"),classNames:"btn btn-es",click:function(){a.enabled(!0);
EasySocial.dialog().close()}},{name:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRM"),classNames:"btn btn-es-danger",click:function(){EasySocial.dialog().update({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_DELETING")});d.deletePage();EasySocial.dialog().close()}}]})}},deletePage:function(){d.item().trigger("pageDeleted");b.trigger("pageDeleted",[d.options.uid]);delete q[d.options.uid];d.options.newpage||r.pages.push(d.options.uid);d.element.remove();
e.each(c.page(),function(a,b){e(b).controller().checkPageDeleteButton()});b.change()},_export:function(){var a=[];e.each(d.item(),function(b,c){c=e(c).controller();void 0!==c&&a.push(c._export())});var b={fields:a,newpage:d.options.newpage,id:d.options.uid};void 0!==d.values&&(b=e.extend(b,d.values));return b},updateResult:function(a,b){d.options.newpage&&(d.element.attr("id","formStep_"+b.id),d.element.removeAttr("data-fields-editor-page-"+a),d.element.attr("data-fields-editor-page-"+b.id,!0),d.options.pageid=
d.options.uid=b.id,q[b.id]=e.extend(!0,{},q[a]),delete q[a],d.options.newpage=!1);void 0!==b.fields&&e.each(b.fields,function(a,b){d.item().eq(a).controller().updateResult(b)})},"{self} pageAdded":function(a,c,f){d.checkPageDeleteButton();b.change()},checkPageDeleteButton:function(){1<c.page().length?d.pageDelete().show():d.pageDelete().hide()},"{parent} loadingConfig":function(){d.pageHeader().removeClass("editting");d.item().removeClass("editting")},"{parent} doneConfiguring":function(){d.pageHeader().removeClass("editting");
d.item().removeClass("editting")}}});EasySocial.Controller("Fields.Editor.Item",{defaultOptions:{appid:0,fieldid:0,pageid:0,newfield:!1,"{edit}":"[data-fields-editor-page-item-edit]","{deleteButton}":"[data-fields-editor-page-item-delete]","{moveButton}":"[data-fields-editor-page-item-move]","{content}":"[data-fields-editor-page-item-content]","{config}":"[data-fields-config]","{closeConfig}":"[data-fields-config-close]",view:{moveDialog:"admin/profiles/dialog.move.field"}}},function(d){return{app:{},
field:{id:0,appid:0,params:{}},state:e.Deferred(),appParams:{},init:function(){0==d.options.appid&&void 0!==d.element.data("appid")&&(d.options.appid=d.element.data("appid"));void 0!==k[d.options.appid]&&(d.app=k[d.options.appid]);0==d.options.fieldid&&void 0!==d.element.data("id")&&(d.options.fieldid=d.element.data("id"));d.registerFields();d.uniqueid=e.uid(d.app.id+"_");d.loadedInit()},registerFields:function(){0!=d.options.fieldid&&(m[d.options.fieldid]={id:d.options.fieldid,appid:d.options.appid,
params:d.field.params||{}},d.field=m[d.options.fieldid])},loadedInit:function(){d.element.addController("EasySocial.Controller.Field.Base",{mode:"sample",element:d.app.element,"{field}":d.content.selector});d.content().addController("EasySocial.Controller.Fields.Editor.Item.Config")},_export:function(){a.checkout(d.options.appid);var b={fieldid:d.options.fieldid,appid:d.options.appid,newfield:d.options.newfield};return b=e.extend(b,d.expandConfig(d.field.params))},"{self} click":function(a,b){var c=
e(b.target);if(!(c.is(d.deleteButton.selector)||c.is(d.moveButton.selector)||c.is(d.config.selector)||c.is(d.closeConfig.selector)||a.hasClass("editting"))){if(g&&g.state)if(g.checkConfig())g.closeConfig();else{EasySocial.dialog({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_INVALID_VALUES"),width:400,height:100});return}d.loadConfiguration()}},loadConfiguration:function(){b.loadConfiguration(d,"field");d.element.addClass("editting");d.getAppParams().done(function(){var a=e(d.field.html);
g.load(a)}).fail(function(){})},updateHtml:function(a){d.field.html=a},getAppParams:function(){var a=e.Deferred();d.field.html?a.resolve():EasySocial.ajax("admin/controllers/fields/renderConfiguration",{appid:d.options.appid,fieldid:d.options.fieldid}).done(function(b,c,f){d.app.params=b;d.field.params=c;d.field.html=f;d.populateAppParams();a.resolve()}).fail(function(b){a.reject(b)});return a},populateAppParams:function(){e.each(d.app.params,function(a,b){e.each(b.fields,function(a,b){b.subfields?
e.each(b.subfields,function(b,c){d.appParams[a+"_"+b]=c}):d.appParams[a]=b})})},getConfigValues:function(){return d.field.params},expandConfig:function(){var a={params:{},choices:{}};e.each(d.field.params,function(b,c){var f=d.appParams[b];if(!f)return!1;a["choices"==f.type?"choices":"params"][b]=c});d.options.newfield&&(a.params.unique_key="");return a},"{moveButton} click":function(a){var g=f.toObject(),k=a.parents(c.page.selector).data("id"),h=[];e.each(g,function(a,b){b.uid!=k&&h.push(b)});EasySocial.dialog({content:d.view.moveDialog(!0,
{pages:h}),selectors:{"{selection}":"[data-move-selection]","{confirmButton}":"[data-move-confirm]","{cancelButton}":"[data-move-cancel]"},bindings:{"{cancelButton} click":function(){EasySocial.dialog().close()},"{confirmButton} click":function(){var a=this.selection().val();c.getPage(a).items().append(d.element);b.change();EasySocial.dialog().close()}}})},"{deleteButton} click":function(a){a.enabled()&&(a.disabled(!0),EasySocial.dialog({width:400,height:150,title:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_TITLE"),
content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CONFIRMATION"),showOverlay:!1,buttons:[{name:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_CANCEL"),classNames:"btn btn-es",click:function(){a.enabled(!0);EasySocial.dialog().close()}},{name:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_PAGE_DIALOG_CONFIRM"),classNames:"btn btn-es-danger",click:function(){EasySocial.dialog().update({content:e.language("COM_EASYSOCIAL_PROFILES_FORM_FIELDS_DELETE_ITEM_DIALOG_DELETING")});
d.deleteField();EasySocial.dialog().close()}}]}))},deleteField:function(){b.trigger("fieldDeleted",[d.options.appid,d.options.fieldid]);d.options.newfield||(delete m[d.options.fieldid],r.fields.push(d.options.fieldid));d.element.remove();b.change()},"{self} pageDeleted":function(){d.deleteField()},"{content} onConfigChange":function(a,b,c,f){d.field.params[c]=f},"{self} onPopulateConfig":function(a,b,c){d.field.params=c},updateResult:function(a){d.field.params.unique_key=a.unique_key;d.itemParam("[data-fields-config-param-field-unique_key]").val(a.unique_key);
d.options.newfield&&(d.options.newfield=!1,d.options.fieldid=a.fieldid,d.element.data("id",a.fieldid),d.itemParam("[data-fields-editor-page-item-param-field-unique_key]").removeAttr("disabled"),d.registerFields());void 0!==a.choices&&e.each(a.choices,function(a,b){var c=d.itemParam("[data-fields-config-param-field-"+a+"]");e.each(b,function(a,b){var f=c.find("li").eq(a);f.data("id")||(f.attr("data-id",b.id),f.data("id",b.id))})})}}});EasySocial.Controller("Config.Choices",{defaultOptions:{"{choiceItems}":"[data-fields-config-param-choice]",
unique:1}},function(a){return{init:function(){a.options.unique=void 0!==a.element.data("unique")?a.element.data("unique"):1;a.choiceItems().implement(EasySocial.Controller.Config.Choices.Choice,{controller:{item:a.item,choices:a}});a.initSortable()},initSortable:function(){a.element.sortable({items:a.choiceItems.selector,placeholder:"ui-state-highlight",cursor:"move",forceHelperSize:!0,handle:"[data-fields-config-param-choice-drag]",stop:function(){e(".tooltip-es").remove()}})}}});EasySocial.Controller("Config.Choices.Choice",
{defaultOptions:{"{choiceValue}":"[data-fields-config-param-choice-value]","{choiceTitle}":"[data-fields-config-param-choice-title]","{choiceDefault}":"[data-fields-config-param-choice-default]","{addChoice}":"[data-fields-config-param-choice-add]","{removeChoice}":"[data-fields-config-param-choice-remove]","{setDefault}":"[data-fields-config-param-choice-setdefault]","{defaultIcon}":"[data-fields-config-param-choice-defaulticon]"}},function(a){return{init:function(){},"{choiceTitle} keyup":e._.debounce(function(c,
f){var g=a.element.index();a.item.content().trigger("onChoiceTitleChanged",[g,c.val()]);b.change()},500),"{choiceValue} keyup":e._.debounce(function(c,f){var g=a.element.index();a.item.content().trigger("onChoiceValueChanged",[g,c.val()]);b.change()},500),"{addChoice} click":function(){var c=a.element.clone(),f=c.find('input[type="text"]');f.attr("value","");f.val("");f=c.find('input[type="hidden"]');f.attr("value",0);f.val(0);c.find("[data-fields-config-param-choice-defaulticon]").removeClass("es-state-featured").addClass("es-state-default");
c.attr("data-id",0);c.data("id",0);c.implement(EasySocial.Controller.Config.Choices.Choice,{controller:{item:a.item,choices:a.choices}});a.element.after(c);c=c.index();a.item.content().trigger("onChoiceAdded",[c]);b.change()},"{removeChoice} click":function(){if(1<=a.choices.choiceItems().length-1){var c=a.element.index();a.item.content().trigger("onChoiceRemoved",[c]);a.element.remove();e(".tooltip-es").remove()}b.change()},"{setDefault} click":function(){var c=a.element.index();a.choiceTitle().val();
a.choiceValue().val();a.choices.choiceItems().trigger("toggleDefault",[c]);a.item.content().trigger("onChoiceToggleDefault",[c,parseInt(a.choiceDefault().val())]);b.change()},"{self} toggleDefault":function(b,c,f){b=a.element.index();c=parseInt(a.choiceDefault().val());b===f?c?(a.defaultIcon().removeClass("es-state-featured").addClass("es-state-default"),a.choiceDefault().val(0)):(a.defaultIcon().removeClass("es-state-default").addClass("es-state-featured"),a.choiceDefault().val(1)):a.choices.options.unique&&
(a.defaultIcon().removeClass("es-state-featured").addClass("es-state-default"),a.choiceDefault().val(0))}}});EasySocial.Controller("Fields.Editor.Item.Config",{defaultOptions:{"{required}":"[data-required]","{title}":"[data-title]","{description}":"[data-description]","{displayTitle}":"[data-display-title]","{displayDescription}":"[data-display-description]"}},function(a){return{init:function(){},"{self} onConfigChange":function(b,c,f,g){switch(f){case "display_title":a.displayTitle().toggle(!!g);
break;case "title":a.title().text(g);break;case "display_description":a.displayDescription().toggle(!!g);break;case "description":a.description().text(g);break;case "required":a.required().toggle(!!g)}}}});d.resolve()})});EasySocial.module("field",function(e){EasySocial.Controller("Field.Base",{defaultOptions:{regPrefix:"easysocial/",modPrefix:"field.",ctrlPrefix:"EasySocial.Controller.Field.",fieldname:"",element:null,id:null,userid:null,required:!1,mode:"edit","{field}":"[data-field]","{notice}":"[data-check-notice]"}},
function(d){return{init:function(){d.options.fieldname=d.element.data("fieldname");d.options.element=d.options.element||d.element.data("element");d.options.id=d.element.data("id");d.options.required=!!d.element.data("required");d.initHandler();d.initMode()},initHandler:function(){var b=d.options.modPrefix+d.options.element,a=d.options.regPrefix+b,c=d.options.ctrlPrefix+e.String.capitalize(d.options.element);void 0!==e.module.registry[a]&&EasySocial.module(b).done(function(a){a=a||{};if(e.isController(c))d.field().addController(c,
{required:d.options.required,fieldname:d.options.fieldname,id:d.options.id,userid:d.options.userid,mode:d.options.mode});else if(e.isFunction(a))a(d.field());else if(e.isPlainObject(a))d.field().on(a)})},initMode:function(){switch(d.options.mode){case "register":d.field().trigger("onRegister");break;case "edit":d.field().trigger("onEdit");break;case "adminedit":d.field().trigger("onAdminEdit");break;case "sample":d.field().trigger("onSample");break;case "display":d.field().trigger("onDisplay")}},
"{field} error":function(b,a,c,f){c=void 0!==c?c:!0;e.isString(c)&&(f=c,c=!0);e.isBoolean(c)&&d.field().toggleClass("error",c);void 0!==f&&d.notice().html(f)},"{field} clear":function(b,a){d.field().removeClass("error")},"{self} show":function(){d.field().trigger("onShow")}}});this.resolve()});EasySocial.module("admin/profiles/members",function(e){var d=this;EasySocial.require().language("COM_EASYSOCIAL_CANCEL_BUTTON","COM_EASYSOCIAL_ASSIGN_BUTTON","COM_EASYSOCIAL_PROFILES_ASSIGN_USER_DIALOG_TITLE").done(function(b){EasySocial.Controller("Profiles.Members",
{defaultOptions:{"{addUser}":"[data-profiles-addUser]","{row}":"[data-profiles-members-row]"}},function(a){return{init:function(){a.options.id=a.element.data("id")},"{memberList} userSelected":function(b,f,g,d){EasySocial.ajax("admin/controllers/profiles/insertMember",{id:g,profile_id:a.options.id}).done(function(b){a.row().append(b);EasySocial.dialog().close()})},"{addUser} click":function(){var c=b.callback(function(b){a.addPlugin("memberList",b)}),c=b.indexUrl+"?option=com_easysocial&view=users&tmpl=component&callback="+
c;EasySocial.dialog({title:b.language("COM_EASYSOCIAL_PROFILES_ASSIGN_USER_DIALOG_TITLE"),content:c,showOverlay:!1,width:700,height:600,buttons:[{name:b.language("COM_EASYSOCIAL_CANCEL_BUTTON"),classNames:"btn btn-es",click:function(){EasySocial.dialog().close()}}]})}}});d.resolve()})});EasySocial.module("admin/profiles/profile",function(e){var d=this;EasySocial.require().script("utilities/alias").view("admin/profiles/dialog.delete.profileavatar").language("COM_EASYSOCIAL_PROFILES_FORM_CLEAR_AVATAR").done(function(b){EasySocial.Controller("Profiles.Profile",
{defaultOptions:{id:null,hasAvatar:!1,defaultAvatar:null,"{profileAvatar}":"[data-profile-avatar]","{profileAvatarImage}":"[data-profile-avatar-image]","{profileAvatarRemoveWrap}":"[data-profile-avatar-remove-wrap]","{profileAvatarRemoveButton}":"[data-profile-avatar-remove-button]","{profileAvatarUpload}":"[data-profile-avatar-upload]",view:{deleteProfileAvatar:"admin/profiles/dialog.delete.profileavatar"}}},function(a){return{init:function(){a.element.addController("EasySocial.Controller.Utilities.Alias",
{"{source}":"#title","{target}":"#alias"});a.options.hasAvatar=a.profileAvatar().data("hasavatar");a.options.defaultAvatar=a.profileAvatar().data("defaultavatar")},"{profileAvatarUpload} change":function(c){c=c.val();b.isEmpty(c)?a.options.hasAvatar||a.profileAvatarRemoveWrap().hide():a.profileAvatarRemoveWrap().show()},"{profileAvatarRemoveButton} click":function(c){a.options.hasAvatar?EasySocial.dialog({content:a.view.deleteProfileAvatar(!0),bindings:{"{deleteButton} click":function(){var c=this.parent;
c.loading(!0);EasySocial.ajax("admin/controllers/profiles/deleteProfileAvatar",{id:a.options.id}).done(function(){c.loading(!1);c.close();a.profileAvatarImage().attr("src",a.options.defaultAvatar);a.profileAvatarRemoveWrap().hide();a.profileAvatarRemoveButton().text(b.language("COM_EASYSOCIAL_PROFILES_FORM_CLEAR_AVATAR"));a.options.hasAvatar=!1})}}}):a.profileAvatarUpload().val("").trigger("change")}}});d.resolve()})});EasySocial.module("admin/profiles/profiles",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Profiles",
{defaultOptions:{"{updateOrdering}":"[data-profiles-update-ordering]","{item}":"[data-profiles-item]",view:{deleteConfirmation:"admin/profiles/dialog.delete.confirm"}}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Profiles.Item)},"{updateOrdering} click":function(){b("[data-table-checkall]").prop("checked",!0).trigger("change");b.Joomla("submitform",["updateOrdering"])}}});EasySocial.Controller("Profiles.Item",{defaultOptions:{"{insertLink}":"[data-profile-insert]"}},
function(a){return{init:function(){a.options.title=a.element.data("title");a.options.id=a.element.data("id")},"{insertLink} click":function(){a.trigger("profileSelected",[a.options.id,a.options.title])}}});d.resolve()})});EasySocial.module("admin/reports/reporters",function(e){EasySocial.Controller("Reports.Reporters",{defaultOptions:{"{item}":"[data-reporters-item]"}},function(d){return{init:function(){d.item().implement(EasySocial.Controller.Reports.Reporters.Item,{"{parent}":d})}}});EasySocial.Controller("Reports.Reporters.Item",
{defaultOptions:{"{removeItem}":"[data-remove-item]"}},function(d){return{init:function(){d.options.id=d.element.data("id")},"{removeItem} click":function(){d.parent.clearMessage();EasySocial.ajax("admin/controllers/reports/removeItem",{id:d.options.id}).done(function(b){d.parent.setMessage(b.message,b.type);d.element.remove()})}}});this.resolve()});EasySocial.module("admin/reports/reports",function(e){var d=this;EasySocial.require().language("COM_EASYSOCIAL_CANCEL_BUTTON","COM_EASYSOCIAL_CLOSE_BUTTON",
"COM_EASYSOCIAL_REPORTS_VIEW_REPORTS_DIALOG_TITLE","COM_EASYSOCIAL_REPORTS_ACTIONS_DIALOG_TITLE").done(function(b){EasySocial.Controller("Reports",{defaultOptions:{"{item}":"[data-reports-item]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Reports.Item)}}});EasySocial.Controller("Reports.Item",{defaultOptions:{"{action}":"[data-reports-item-view-actions]","{viewReports}":"[data-reports-item-view-reports]"}},function(a){return{init:function(){a.options.id=a.element.data("id");
a.options.extension=a.element.data("extension");a.options.uid=a.element.data("uid");a.options.type=a.element.data("type")},"{viewReports} click":function(){EasySocial.dialog({title:b.language("COM_EASYSOCIAL_REPORTS_VIEW_REPORTS_DIALOG_TITLE"),content:EasySocial.ajax("admin/controllers/reports/getReporters",{id:a.options.id}),width:600,height:450})},"{action} click":function(){EasySocial.dialog({title:b.language("COM_EASYSOCIAL_REPORTS_ACTIONS_DIALOG_TITLE"),content:"<div>Perform some actions on the item</div>",
width:500,height:250,buttons:[{name:b.language("COM_EASYSOCIAL_CLOSE_BUTTON"),classNames:"btn btn-es",click:function(){EasySocial.dialog().close()}}]})}}});d.resolve()})});EasySocial.module("admin/users/form",function(e){var d=this;EasySocial.require().script("field").done(function(b){EasySocial.Controller("Users.Form",{defaultOptions:{userid:null,mode:"adminedit","{selectProfile}":"[data-user-select-profile]","{content}":"[data-user-new-content]","{profileTitle}":"[data-profile-title]","{fieldItem}":"[data-profile-adminedit-fields-item]",
"{tabnav}":"[data-tabnav]","{tabcontent}":"[data-tabcontent]","{stepnav}":"[data-stepnav]","{stepcontent}":"[data-stepcontent]",view:{loading:"site/loading/large"}}},function(a){return{init:function(){window.selectedProfile=a.selectedProfile;a.fieldItem().addController("EasySocial.Controller.Field.Base",{userid:a.options.userid,mode:a.options.mode})},selectedProfile:function(a){EasySocial.dialog().close();window.location.href="index.php?option=com_easysocial&view=users&layout=form&profileId="+a},
"{selectProfile} click":function(){EasySocial.dialog({content:EasySocial.ajax("admin/views/profiles/browse")})},errorFields:[],"{fieldItem} error":function(c,f){var g=c.data("id");0>b.inArray(g,a.errorFields)&&a.errorFields.push(g);g=c.parents(a.stepcontent.selector).data("for");a.stepnav().filterBy("for",g).trigger("error");g=c.parents(a.tabcontent.selector).data("for");a.tabnav().filterBy("for",g).trigger("error")},"{fieldItem} clear":function(c,f){var g=c.data("id");a.errorFields=b.without(a.errorFields,
g);g=c.parents(a.stepcontent.selector).data("for");a.stepnav().filterBy("for",g).trigger("clear");g=c.parents(a.tabcontent.selector).data("for");a.tabnav().filterBy("for",g).trigger("clear")},"{stepnav} error":function(a){a.addClass("error")},"{tabnav} error":function(a){a.addClass("error")},"{stepnav} clear":function(b){1>a.errorFields.length&&b.removeClass("error")},"{tabnav} clear":function(b){1>a.errorFields.length&&b.removeClass("error")}}});d.resolve()})});EasySocial.module("admin/users/privacy",
function(e){var d=this;EasySocial.require().library("textboxlist").view("site/loading/small").done(function(b){EasySocial.Controller("Profile.Privacy",{defaultOptions:{userId:"","{privacyItem}":"[data-privacy-item]","{privacyForm}":"[data-profile-privacy-form]",view:{loading:"site/loading/small"}}},function(a){return{init:function(){a.privacyItem().implement(EasySocial.Controller.Profile.Privacy.Item,{"{parent}":a})}}});EasySocial.Controller("Profile.Privacy.Item",{defaultOptions:{"{selection}":"[data-privacy-select]",
"{hiddenCustom}":"[data-hidden-custom]","{customForm}":"[data-privacy-custom-form]","{customTextInput}":"[data-textfield]","{customItems}":"input[]","{customHideBtn}":"[data-privacy-custom-hide-button]","{customInputItem}":"[data-textboxlist-item]","{customEditBtn}":"[data-privacy-custom-edit-button]"}},function(a){return{init:function(){a.customTextInput().textboxlist({unique:!0,plugin:{autocomplete:{exclusive:!0,minLength:2,cache:!1,query:function(b){var f=a.getTaggedUsers();return EasySocial.ajax("site/views/privacy/getfriends",
{q:b,userid:a.parent.options.userId,exclude:f})}}}});a.textboxlistLib=a.customTextInput().textboxlist("controller")},getTaggedUsers:function(){var c=[],f=a.customInputItem();0<f.length&&b.each(f,function(a,f){c.push(b(f).data("id"))});return c},"{customTextInput} addItem":function(b,f,g){b=a.hiddenCustom().val();f="";""==b?f=g.id:(b=b.split(","),b.push(g.id),f=b.join(","));a.hiddenCustom().val(f)},"{customTextInput} removeItem":function(b,f,g){b="";b=[];f=a.hiddenCustom().val().split(",");for(var d=
0;d<f.length;d++)f[d]!=g.id&&b.push(f[d]);b=0>=b.length?"":b.join(",");a.hiddenCustom().val(b)},"{customEditBtn} click":function(b){a.customForm().toggle()},"{selection} change":function(b){"custom"==b.val()?(a.customForm().show(),a.customEditBtn().show()):(a.customForm().hide(),a.customEditBtn().hide())},"{customHideBtn} click":function(){a.customForm().hide();a.customEditBtn().show();a.textboxlistLib.autocomplete.hide()}}});d.resolve()})});EasySocial.module("admin/users/users",function(e){var d=
this;EasySocial.require().library("expanding").done(function(b){EasySocial.Controller("Users",{defaultOptions:{"{item}":"[data-user-item]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Users.Item)}}});EasySocial.Controller("Users.Item",{defaultOptions:{"{insertLink}":"[data-user-item-insertLink]"}},function(a){return{init:function(){a.options.name=a.element.data("name");a.options.avatar=a.element.data("avatar");a.options.email=a.element.data("email");a.options.id=a.element.data("id")},
"{insertLink} click":function(){a.trigger("userSelected",[a.options.id,a.options.name,a.options.avatar,a.options.email])}}});EasySocial.Controller("Users.Pending",{defaultOptions:{"{item}":"[data-pending-item]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Users.Pending.Item)}}});EasySocial.Controller("Users.Pending.Item",{defaultOptions:{"{approve}":"[data-pending-approve]","{reject}":"[data-pending-reject]"}},function(a){return{init:function(){a.options.id=a.element.data("id")},
"{approve} click":function(){EasySocial.dialog({content:EasySocial.ajax("admin/views/users/confirmApprove",{id:a.options.id}),bindings:{"{approveButton} click":function(){b("[data-users-approve-form]").submit()}}})},"{reject} click":function(){EasySocial.dialog({content:EasySocial.ajax("admin/views/users/confirmReject",{id:a.options.id})})}}});d.resolve()})});EasySocial.module("admin/widgets/news",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("News",{defaultOptions:{loadOnInit:!0,
"{items}":"[widget-news-items]","{placeholder}":"[widget-news-placeholder]"}},function(a){return{init:function(){a.options.loadOnInit&&a.getNews()},getNews:function(){EasySocial.ajax("admin/controllers/news/getnews").done(function(b){a.items().append(b);a.placeholder().remove()})}}});d.resolve()})});EasySocial.module("albums/album",function(e){var d=this;EasySocial.require().library("tinyscrollbar").done(function(){EasySocial.Controller("Albums.Album",{defaultOptions:{"{title}":"[data-album-title]",
"{count}":"[data-album-count]","{privacy}":"[data-album-privacy]","{cover}":"[data-album-cover]","{coverImage}":"[data-album-cover-image]","{link}":"[data-album-link]","{menu}":"[data-album-menu]","{menuActions}":"[data-album-menu-actions]","{shareButton}":"[data-album-share-button]","{shareContent}":"[data-sharing]","{followButton}":"[data-album-follow-button]","{reportButton}":"[data-album-report-button]","{deleteButton}":"[data-album-delete-button]","{likeButton}":"[data-album-like-button]","{commentButton}":"[data-album-comment-button]",
"{countsButton}":"[data-album-counts-button]","{commentCount}":"[data-album-comment-count]","{likeCount}":"[data-album-like-count]","{actions}":"[data-item-actions]","{actionContent}":"[data-item-action-content]","{actionCloseButton}":"[data-item-action-close-button]","{actionsMenu}":"[data-item-actions-menu]","{likesHolder}":"[data-album-likes-holder]","{commentsHolder}":"[data-album-comments-holder]","{responseHolder}":"[data-album-response-holder]","{comments}":"[data-comments]"}},function(b){return{init:function(){b.id=
b.element.data("album-id");b.actionContent().tinyscrollbar();b.actions().hasClass("open")&&(b.loadResponse(),b.element.addClass("show-all"))},remove:function(){b.element.remove()},"{coverImage} click":function(){window.location=b.link().attr("href")},"{shareButton} click":function(){b.shareContent().show()},"{deleteButton} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/albums/confirmDelete",{id:b.id})})},like:function(){EasySocial.ajax("site/controllers/albums/like",{id:b.id}).done(function(a){b.likeCount().html(a.count);
a.state?b.likeButton().addClass("liked"):b.likeButton().removeClass("liked");b.likesHolder().html(a.html)})},loadResponse:function(){var a=b.loadResponse.loader;a&&"rejected"!=a.state()||(b.loadResponse.loader=EasySocial.ajax("site/views/albums/response",{id:b.id}).done(function(a){b.responseHolder().html(a);b.actionContent().removeClass("loading").tinyscrollbar_update()}))},getButton:function(a){a=e(a);var c=b.countsButton(),f=b.commentButton();return a.is(c)||0<a.parents().filter(c).length?c:a.is(f)||
0<a.parents().filter(f).length?f:e()},lastButton:e(),"{actions} dropdownOpen":function(a,c,f){b.loadResponse();b.element.addClass("show-all");a=b.actionContent();f=b.lastButton=b.getButton(f);f=f.position().left+f.width()/2-a.width()/2;a.css("margin-left",f).tinyscrollbar_update()},"{actions} dropdownClose":function(a,c,f){b.element.removeClass("show-all");var g=b.getButton(f);g.is(b.lastButton)||setTimeout(function(){g.trigger("click")},0)},"{actionCloseButton} click":function(a){b.hideActionContent()},
"{likeButton} click":function(){b.like()},"{comments} newCommentSaved":function(){var a=b.comments().controller("EasySocial.Controller.Comments.Stat");b.commentCount().html(a.total());b.actionContent().tinyscrollbar_update("bottom")},"{comments} commentDeleted":function(){var a=b.comments().controller("EasySocial.Controller.Comments.Stat");b.commentCount().html(a.total());b.actionContent().tinyscrollbar_update()},"{actionsMenu} dropdownOpen":function(){b.element.addClass("show-all")},"{actionsMenu} dropdownClose":function(){b.element.removeClass("show-all")}}});
d.resolve()})});EasySocial.module("albums/browser",function(e){var d=this;EasySocial.require().library("history").view("site/albums/browser.list.item").done(function(){EasySocial.Controller("Albums.Browser",{hostname:"browser",defaultOptions:{view:{listItem:"site/albums/browser.list.item"},itemRenderOptions:{},"{sidebar}":"[data-album-browser-sidebar]","{content}":"[data-album-browser-content]","{createAlbumButton}":"[data-album-create-button]","{createAlbumButtonLink}":"[data-album-create-button] > a",
"{listItemGroup}":"[data-album-list-item-group]","{listItemRegularGroup}":"[data-album-list-item-group=regular]","{listItemCoreGroup}":"[data-album-list-item-group=core]","{listItem}":"[data-album-list-item]","{listItemLink}":"[data-album-list-item] > a","{listItemTitle}":"[data-album-list-item-title]","{listItemCover}":"[data-album-list-item-cover]","{listItemCount}":"[data-album-list-item-count]","{albumItem}":"[data-album-item]","{photoBrowser}":"[data-photo-browser]"}},function(b){return{init:function(){b.albumItem().each(function(){b.addSubscriber(e(this).controller("EasySocial.Controller.Albums.Item"))})},
setLayout:function(a){b.element.hasClass("layout-dialog")||b.element.data("layout",a).switchClass("layout-"+a)},open:function(a){var c=e.makeArray(arguments);b.trigger("contentload",c);var f="view"+e.String.capitalize(a),f=b[f].apply(b,c.slice(1));f.done(b.displayContent(function(){b.trigger("contentdisplay",c);return arguments})).fail(function(){b.trigger("contentfail",c)}).always(function(){b.trigger("contentcomplete",c)});return f},"{self} contentdisplay":function(a,c,f){/album|albumform/gi.test(f)&&
b.setLayout("album");/photo/gi.test(f)&&b.setLayout("photo")},displayContent:e.Enqueue(function(a){var c=[];a=e(e.buildFragment([a],document,c));b.content().html(a);e(c).remove()}),viewAlbum:function(a){b.listItem().removeClass("active loading");var c=b.getListItem(a).addClass("active loading");"dialog"!==b.element.data("layout")&&c.find("> a").route();return EasySocial.ajax("site/views/albums/item",{id:a,renderOptions:b.options.itemRenderOptions}).fail(function(){}).always(function(){c.removeClass("loading")})},
viewAlbumForm:function(){b.listItem().removeClass("active loading");var a=b.view.listItem({}).addClass("active loading new").prependTo(b.listItemRegularGroup());return EasySocial.ajax("site/views/albums/form").fail(function(){}).always(function(){a.removeClass("loading")})},viewPhoto:function(a){return EasySocial.ajax("site/views/photos/item",{id:a,browser:1}).fail(function(){}).always(function(){})},"{listItem} click":function(a){a.hasClass("new")||(a=a.data("albumId"),b.open("Album",a))},"{listItemLink} click":function(a,
b){b.preventDefault();a.blur()},"{createAlbumButton} click":function(){b.open("AlbumForm");"dialog"!==b.element.data("layout")&&b.createAlbumButtonLink().route()},"{createAlbumButtonLink} click":function(a,b){b.preventDefault()},"{albumItem} init.albums.item":function(a,c,f){b.addSubscriber(f)},getListItem:function(a,c){var f=a?b.listItem().filterBy("albumId",a):b.listItem(".new");return c?f.find(b["listItem"+e.String.capitalize(c)].selector):f},updateListItemCount:function(a,c,f){a=b.getListItem(a,
"count");0>a.length||(c=f?(parseInt(a.text())||0)+(parseInt(c)||0):c,0>c&&(c=0),a.text(c))},"{albumItem} albumSave":function(a,c,f){f.done(function(a){b.getListItem().attr("data-album-id",a.id).removeClass("new");b.getListItem(a.id).find("> a").attr({href:a.permalink,title:a.title}).route();b.getListItem(a.id,"title").html(a.title)})},"{albumItem} titleChange":function(a,c,f,g){b.getListItem(g.id,"title").html(e.trim(f)||"&nbsp;")},"{albumItem} coverChange":function(a,c,f,g){b.getListItem(g.id,"cover").css("backgroundImage",
e.cssUrl(f.sizes.thumbnail.url))},"{albumItem} coverRemove":function(a,c,f){b.getListItem(f.id,"cover").css("backgroundImage","")},"{albumItem} photoAdd":function(a,c,f,g,d){b.updateListItemCount(d.id,1,!0)},"{albumItem} photoMove":function(a,c,f,g){f.done(function(){b.updateListItemCount(g.album.id,-1,!0)})},"{albumItem} photoDelete":function(a,c,f,g){f.done(function(){b.updateListItemCount(g.album.id,-1,!0)})},"{photoBrowser} init.photos.browser":function(a,c,f){b.addSubscriber(f)},"{self} contentload":function(){b.listItem(".new").remove()}}});
d.resolve()})});EasySocial.module("albums/editor",function(e){EasySocial.require().script("albums/editor/sortable","albums/editor/uploader").done();var d=EasySocial.Controller("Albums.Editor",{hostname:"editor",defaultOptions:{view:{uploadItem:"site/albums/upload.item"},canReorder:!1,canUpload:!0,"{titleField}":"[data-album-title-field]","{captionField}":"[data-album-caption-field]","{coverField}":"[data-album-cover-field]","{location}":"[data-album-location]","{locationCaption}":"[data-album-location-caption]",
"{addLocationButton}":"[data-album-addLocation-button]","{date}":"[data-album-date]","{dateCaption}":"[data-album-date-caption]","{addDateCaption}":"[data-album-addDate-button]","{privacy}":"[data-album-privacy]","{uploadButton}":"[data-album-upload-button]","{deleteButton}":"[data-album-delete-button]","{moreButton}":"[data-album-more-button]","{privacy}":"[data-privacy-hidden]","{privacycustom}":"[data-privacy-custom-hidden]","{uploadItem}":"[data-photo-upload-item]","{dateDay}":"[data-date-day]",
"{dateMonth}":"[data-date-month]","{dateYear}":"[data-date-year]","{editButton}":"[data-album-edit-button]","{editButtonLink}":"[data-album-edit-button] > a","{doneButton}":"[data-album-done-button]","{doneButtonLink}":"[data-album-done-button] > a","{locationWidget}":".es-album-location-form .es-location","{latitude}":"[data-location-lat]","{longitude}":"[data-location-lng]"}},function(b){return{init:function(){b.id=b.element.data("album-id");var a=b.options;a.canReorder&&EasySocial.module("albums/sortable").done(function(a){b.addPlugin("sortable",
a)});a.canUpload&&EasySocial.module("albums/editor/uploader").done(function(a){b.uploader=b.addPlugin("uploader",a)});b.id?(b.createAlbum.task=e.Deferred().resolve(),b.createStream=0):b.createStream=1},data:function(){var a=b.titleField().val(),c=b.captionField().val(),f=b.formatDate(),g=b.locationCaption().html(),d=b.latitude().val(),e=b.longitude().val(),l=b.privacy().val(),m=b.privacycustom().val();return{id:b.id,title:a,caption:c,date:f,address:g,latitude:d,longitude:e,privacy:l,privacycustom:m,
createStream:b.createStream}},createAlbum:function(){var a=b.createAlbum.task;a||(a=b.createAlbum.task=b.save({createStream:0}).done(function(a){b.deleteButton().disabled(!1);b.element.attr("data-album-id",b.id=a.id)}).fail(function(a,f){b.setMessage(a,f)}));return a},save:function(a){b.trigger("beforeAlbumSave",[b]);a=e.extend(b.data(),a);a.photos=e.map(b.album.photoItem(),function(a,b){var g=e(a).controller("EasySocial.Controller.Photos.Editor");return g?g.data():null});b.clearMessage();a=EasySocial.ajax("site/controllers/albums/store",
a);b.trigger("albumSave",[a,b]);return a},"{self} photoAdd":function(a,c,f,g){1>=b.album.photoItem().length&&b.changeCover(g)},setCover:function(a){return EasySocial.ajax("site/controllers/albums/setCover",{albumId:b.id,coverId:a}).done(function(a){b.changeCover(a)}).fail(function(){})},removeCover:function(){b.trigger("coverRemove",[b.album])},changeCover:function(a){b.trigger("coverChange",[a,b])},"{self} coverChange":function(a,c,f){b.coverField().removeClass("no-cover").css("backgroundImage",
e.cssUrl(f.sizes.thumbnail.url))},"{self} coverRemove":function(){b.coverField().addClass("no-cover").css("backgroundImage","")},"{editButton} click":function(){b.album.setLayout("form");b.editButtonLink().route()},"{editButtonLink} click":function(a,b){b.preventDefault()},"{doneButton} click":function(){b.save().done(function(a,c){e.buildHTML(c).replaceAll(b.element)}).progress(function(a,c){b.setMessage(a,c)})},"{doneButtonLink} click":function(a,b){b.preventDefault()},"{deleteButton} click":function(a){a.disabled()||
EasySocial.dialog({content:EasySocial.ajax("site/views/albums/confirmDelete",{id:b.id})})},formatDate:function(){var a=b.dateDay().val()||b.dateDay().data("date-default"),c=b.dateMonth().val()||b.dateMonth().data("date-default");return(b.dateYear().val()||b.dateYear().data("date-default"))+"-"+c+"-"+a},updateDate:function(){b.date().addClass("has-data");var a=b.dateDay().val()+" "+e.trim(b.dateMonth().find(":selected").html())+" "+b.dateYear().val();b.dateCaption().html(a)},"{dateDay} keyup":function(){b.updateDate()},
"{dateMonth} change":function(){b.updateDate()},"{dateYear} keyup":function(){b.updateDate()},"{titleField} keyup":function(a){b.trigger("titleChange",[a.val(),b])},"{locationWidget} locationChange":function(a,c,f){a=f.formatted_address;b.locationCaption().html(a);b.location().addClass("has-data")}}});this.resolve(d)});EasySocial.module("albums/editor/sortable",function(e){var d=this;EasySocial.require().library("ui/sortable").done(function(){var b=EasySocial.Controller("Albums.Editor.Sortable",{defaultOptions:{}},
function(a){return{init:function(){},getPhotoOrdering:function(){var b={};a.photoItem().each(function(a){var g=e(this).data("photoId");b[g]=a});return b},"{parent.photoItemGroup} sortstart":function(b,f,g){g.item.addClass("dragging");b.addClass("ordering");a.setLayout()},"{parent.photoItemGroup} sortchange":function(b,f,g){a.setLayout()},"{parent.photoItemGroup} sortstop":function(b,f,g){g.item.removeClass("dragging");b.removeClass("ordering");a.setLayout();EasySocial.ajax("site/controllers/photos/reorder",
{id:g.item.controller().id,order:g.item.index()})}}});d.resolve(b)})});EasySocial.module("albums/editor/uploader",function(e){var d=this;EasySocial.require().script("albums/uploader").view("site/albums/upload.item").done(function(){var b=EasySocial.Controller("Albums.Editor.Uploader",{defaultOptions:{}},function(a){return{init:function(){a.album=a.editor.album;a.uploader=a.addPlugin("uploader",EasySocial.Controller.Albums.Uploader,{settings:a.album.options.uploader,"{uploadButton}":a.editor.uploadButton.selector,
"{uploadItemGroup}":a.album.photoItemGroup.selector,"{uploadDropsite}":a.album.content.selector})},setLayout:function(){a.album.setLayout_()},"{self} beforeAlbumSave":function(){a.uploader.stop()},"{self} albumSave":function(b,f,g){g.done(function(b){b=e.uri(a.uploader.settings("url")).replaceQueryParam("albumId",b.id).toString();a.uploader.settings("url",b)})},"{self} layoutChange":function(b,f,g){a.uploader.stop();a.uploader.clear();b=e.uri(a.uploader.settings("url")).replaceQueryParam("createStream",
"form"==g?0:1).replaceQueryParam("layout",g).toString();a.uploader.settings("url",b)},"{self} QueueCreated":function(b,f,g){"form"==a.album.currentLayout()&&g.element.addClass("layout-form");a.setLayout()},startUpload:e.Enqueue(),"{uploader} FilesAdded":function(b,f,g,d){a.id?a.uploader.start():a.editor.createAlbum().done(a.startUpload(function(){a.uploader.start()}));a.setLayout()},"{uploader} FilesRemoved":function(){a.setLayout()},"{uploader} FileUploaded":function(b,f,g,d,h){b=a.uploader.getItem(d);
var l=e.buildHTML(h.html);h=h.data;l.addClass("new-item").insertAfter(b.element);setTimeout(function(){l.removeClass("new-item")},1);a.uploader.removeItem(d.id);a.trigger("photoAdd",[l,h,a.album]);a.setLayout()}}});d.resolve(b)})});EasySocial.module("albums/uploader",function(e){var d=this;EasySocial.require().library("plupload").script("albums/uploader.item").view("site/albums/upload.item").done(function(){EasySocial.Controller("Albums.Uploader",{defaultOptions:{view:{uploadItem:"site/albums/upload.item"},
"{uploadButton}":"[data-upload-button]","{uploadItemGroup}":"[data-upload-item-group]","{uploadItem}":"[data-upload-item]","{uploadDropsite}":"[data-upload-dropsite]"}},function(b){return{init:function(){var a=b.element;b.pluploadController=b.element.addController("plupload",e.extend({"{uploadButton}":b.uploadButton.selector,"{uploadDropsite}":b.uploadDropsite.selector},b.options.settings));b.plupload=b.pluploadController.plupload;e.IE||"html5"!=b.plupload.runtime||a.addClass("can-drop-file");a.addClass("can-upload")},
setLayout:function(){b.uploadItemGroup().toggleClass("no-upload-items",1>b.uploadItem().length)},items:{},getItem:function(a){var c;e.isString(a)&&(c=a);a&&a.id&&(c=a.id);return b.items[c]},createItem:function(a){var c=b.view.uploadItem({file:a}).addController("EasySocial.Controller.Albums.Uploader.Item",{"{uploader}":b,file:a});c.element.prependTo(b.uploadItemGroup());b.items[a.id]=c;b.setLayout();b.trigger("QueueCreated",[c]);return c},settings:function(a,c){var f=b.plupload.settings;void 0!==c&&
(f[a]=c);return a?f[a]:f},start:function(){return b.plupload.start()},stop:function(){return b.plupload.stop()},"{self} FilesAdded":function(a,c,f,g){try{g.reverse(),e.each(g,function(a,c){b.getItem(c)||b.createItem(c)})}catch(d){console.error(d)}},"{self} BeforeUpload":function(a,c,f,g){(a=b.getItem(g))&&a.setState("preparing")},"{self} UploadFile":function(a,c,f,g){(a=b.getItem(g))&&a.setState("uploading")},"{self} UploadProgress":function(a,c,f,g){if(a=b.getItem(g))a.setState("uploading"),a.setProgress()},
"{self} FileUploaded":function(a,c,f,g,d){(a=b.getItem(g))&&(e.isPlainObject(d)?a.setState("done"):a.setState("failed"))},"{self} FileError":function(a,c,f,g,d){(a=b.getItem(g))||(a=b.createItem(g));a.setState("failed");a.setMessage(d.message)},"{self} Error":function(a,c,f,g){g.file&&(a=g.file,(c=b.getItem(a))||(c=b.createItem(a)),c.setState("failed"),c.setMessage(g.message))},removeItem:function(a){var c=b.getItem(a);c&&(b.plupload.removeFile(c.file()),c.element.remove(),delete b.items[a],b.setLayout())},
clear:function(a){e.each(b.items,function(a,f){b.plupload.removeFile(f.file());f.element.remove();delete b.items[a]});b.items={}}}});d.resolve()})});EasySocial.module("albums/uploader.item",function(e){EasySocial.Controller("Albums.Uploader.Item",{defaultOptions:{"{status}":".upload-status","{filename}":".upload-filename","{progressBar}":".upload-progress-bar","{percentage}":".upload-percentage","{filesizeTotal}":".upload-filesize-total","{filesizeLeft}":".upload-filesize-left","{details}":".upload-details",
"{detailsButton}":".upload-details-button","{removeButton}":".upload-remove-button","{message}":".upload-message"}},function(d){return{init:function(){d.id=d.element.attr("id");var b=d.file();d.filename().html(b.name);d.setState("pending");d.setProgress();b="html4"==d.uploader.plupload.runtime;(10>e.IE||b)&&d.element.addClass("indefinite-progress");b&&d.element.addClass("no-filesize")},file:function(){var b=d.uploader.plupload.getFile(d.id)||d.options.file;if(b){var a=void 0===b.size||"N/A"==b.size;
b.percentage=b.percent+"%";b.filesize=a?"":e.plupload.formatSize(b.size);b.remaining=a?"":e.plupload.formatSize(b.size-(b.loaded||0))}return b},setProgress:function(){var b=d.file();d.progressBar().width(b.percentage);d.percentage().html(b.percentage);d.filesizeTotal().html(b.filesize);d.filesizeLeft().html(b.remaining)},setState:function(b){d.element.removeClass("pending preparing uploading failed done").addClass(b);d.state=b},setMessage:function(b){d.detailsButton().attr("data-popbox",b)},"{removeButton} click":function(b,
a){d.uploader.removeItem(d.id)}}});this.resolve()});EasySocial.module("albums/item",function(e){var d=this;EasySocial.require().script("albums/editor").done();EasySocial.require().library("masonry").done(function(){EasySocial.Controller("Albums.Item",{hostname:"album",defaultOptions:{tilesPerRow:4,editable:!1,multipleSelection:!1,"{header}":"[data-album-header]","{content}":"[data-album-content]","{footer}":"[data-album-footer]","{info}":"[data-album-info]","{title}":"[data-album-title]","{caption}":"[data-album-caption]",
"{location}":"[data-album-location]","{date}":"[data-album-date]","{cover}":"[data-album-cover]","{photoItemGroup}":"[data-photo-item-group]","{photoItem}":"[data-photo-item]","{photoImage}":"[data-photo-image]","{featuredItem}":"[data-photo-item].featured","{featuredImage}":"[data-photo-item].featured [data-photo-image]","{uploadItem}":"[data-photo-upload-item]","{moreButton}":"[data-album-more-button]","{viewButton}":"[data-album-view-button]","{share}":"[data-repost-action]","{likes}":"[data-likes-action]",
"{likeContent}":"[data-likes-content]","{repostContent}":"[data-repost-content]","{counterBar}":"[data-stream-counter]"}},function(b){return{init:function(){b.id=b.element.data("album-id");b.nextStart=b.element.data("album-nextstart")||-1;b.options.editable&&EasySocial.module("albums/editor").done(function(a){b.editor=b.addPlugin("editor",a)});b.setLayout();setTimeout(function(){b.content().addClass("ready")},1);b.addSubscriber(b.photoItem().controllers("EasySocial.Controller.Photos.Item"))},"{window} resize":e.debounce(function(){b.setLayout()},
250),currentLayout:function(){return b.element.data("albumLayout")},setLayout_:e.debounce(function(){b.setLayout()},100),setLayout:function(a){var c=b.photoItemGroup(),f=b.currentLayout();a=a||f;var g=b.setLayout.seed,d=g==c.width()&&f==a;hasPhotoItem=0<b.photoItem().length;hasUploadItem=0<b.uploadItem().length;hasItem=hasPhotoItem||hasUploadItem;masonry=c.data("masonry");layout={currentLayout:f,seed:g,intact:d,hasPhotoItem:hasPhotoItem,hasUploadItem:hasUploadItem,hasItem:hasItem,masonry:masonry};
d||(b.element.data("albumLayout",a).switchClass("layout-"+a),b.photoItem().switchClass("layout-"+a),b.setLayout.seed=layout.seed=null,b.trigger("layoutChange",[a,layout]));b.element.toggleClass("has-photos",hasItem);hasItem||c.css("opacity",1);a="set"+e.String.capitalize(a)+"Layout";b[a](layout);b.setLayout.seed=c.width()},setItemLayout:function(a){if(a.intact)a.masonry&&a.masonry.reload();else{var c=4;e("#es-wrap").hasClass("w600")&&(c=2);e("#es-wrap").hasClass("w320")&&(c=1);var f=b.photoItemGroup(),
g=b.photoItem();a=f.width();a=Math.floor(a/c)*c/c;var d=g.outerWidth(!0)-g.width(),h=g.outerHeight(!0)-g.height(),g=a-d,l=a-h;4<=c?(c=2*a-d,d=2*a-h):(c=g,d=l);var h=c,m=d;b.photoItem.css({width:g,height:l});b.photoImage.css({width:g,height:l});b.featuredItem.css({width:c,height:d});b.featuredImage.css({width:h,height:m});b.uploadItem.css({width:g,height:l});f.masonry({columnWidth:a});setTimeout(function(){f.addTransitionClass("no-transition").masonry("reload")},1)}},setFormLayout:function(a){a.masonry&&
a.masonry.destroy();b.clearLayout()},setDialogLayout:function(){layout.masonry&&layout.masonry.destroy();b.clearLayout()},setThumbnailLayout:function(){},setRowLayout:function(){b.clearLayout()},clearLayout:function(){b.photoItemGroup().addClass("no-transition");b.photoItem.css().remove();b.photoImage.css().remove();b.featuredItem.css().remove();b.featuredImage.css().remove();b.uploadItem.css().remove();b.setLayout.seed=null},getSelectedItems:function(){var a=[];b.photoItem(".selected").each(function(b,
f){a.push(e(f).controller("EasySocial.Controller.Photos.Item").data())});return a},"{photoItem} init.photos.item":function(a,c,f){b.addSubscriber(f)},"{photoItem} destroyed":function(){b.setLayout()},"{photoItem} activate":function(a,c,f){if(f)switch(b.currentLayout()){case "item":case "row":a.addClass("loading");b.browser?(b.browser.open("photo",f.id).always(function(){a.removeClass("loading")}),f.imageLink().route()):window.location=f.imageLink().attr("href");break;case "dialog":c=b.photoItem(".selected"),
b.options.multipleSelection?a.toggleClass("selected"):(f=a.hasClass("selected"),c.removeClass("selected"),a.toggleClass("selected",!f))}},"{photoItem} photoFeature":function(a,c,f,g,d){b.setLayout();f.fail(function(){b.setLayout()})},"{photoItem} photoMove":function(a,c,f,g,d){b.clearMessage();f.done(function(){g.element.remove();b.setLayout();1>b.photoItem().length&&b.trigger("coverRemove",[b])}).fail(function(a,c){b.setMessage(a,c)})},"{photoItem} photoDelete":function(a,c,f,g){b.clearMessage();
f.done(function(){g.element.remove();b.setLayout();1>b.photoItem().length&&b.trigger("coverRemove",[b])}).fail(function(a,c){b.setMessage(a,c)})},"{self} albumSave":function(a,c,f){f.done(function(a){b.id=a.id})},"{self} coverChange":function(a,c,f,g){b.cover().css("backgroundImage",e.cssUrl(f.sizes.thumbnail.url))},"{self} coverRemove":function(){b.cover().css("backgroundImage","")},"{viewButton} click":function(a,c){b.browser&&(c.preventDefault(),b.element.addClass("loading"),b.browser.open("Album",
b.id))},"{moreButton} click":function(a){-1==b.nextStart||a.disabled()||(a.disabled(!0),EasySocial.ajax("site/controllers/albums/loadMore",{albumId:b.id,start:b.nextStart,layout:b.currentLayout()}).done(function(c,f){b.nextStart=f;var g=b.photoItemGroup();e.each(c,function(a,b){e.buildHTML(b).appendTo(g)});0>f&&a.hide();b.setLayout()}).always(function(){a.disabled(!1)}))},"{share} create":function(a,c,f){b.counterBar().removeClass("hide")},"{likes} onLiked":function(a,c,f){b.counterBar().removeClass("hide")},
"{likes} onUnliked":function(a,c,f){a=b.likeContent().hasClass("hide");c=b.repostContent().hasClass("hide");a&&c&&b.counterBar().addClass("hide")}}});d.resolve()})});EasySocial.require().script("site/likes/likes","site/reports/reports","site/repost/repost","site/share/share","site/layout/dialog","site/layout/responsive","site/layout/elements","site/photos/photos","site/users/login","site/profile/popbox","site/privacy/privacy","site/locations/popbox","site/sidebar/sidebar","site/friends/api","site/conversations/api",
"site/followers/api","site/popbox/popbox","site/stream/video","oauth/facebook").done();EasySocial.module("site/likes/likes",function(e){e(document).on("click.es.likes.action","[data-likes-action]",function(){var d=e(this),b={id:d.data("id"),type:d.data("type"),group:d.data("group")},a=b.type+"-"+b.group+"-"+b.id;EasySocial.ajax("site/controllers/likes/toggle",b).done(function(c,f,g,k,h){d.text(f);e("[data-likes-"+a+"]").html(c).toggleClass("hide",g).toggle(!g);b.uid=b.id;b.count=h;d.trigger("like"==
k?"onLiked":"onUnliked",[b])}).fail(function(a){console.log(a)})}).on("click.es.likes.others","[data-likes-others]",function(){var d=e(this),b=d.parents("[data-likes-content]"),d={uid:b.data("id"),type:b.data("type"),exclude:d.data("authors")};EasySocial.dialog({content:EasySocial.ajax("site/controllers/likes/showOthers",d)})});this.resolve()});EasySocial.module("site/reports/reports",function(e){e(document).on("click.es.reports.link","[data-reports-link]",function(){var d=e(this),b={};e.each("url extension uid type object title description".split(" "),
function(a,c){b[c]=d.data(c)});EasySocial.dialog({content:EasySocial.ajax("site/views/reports/confirmReport",{title:b.title,description:b.description}),selectors:{"{message}":"[data-reports-message]","{reportButton}":"[data-report-button]","{cancelButton}":"[data-cancel-button]"},bindings:{"{reportButton} click":function(){var a=this.message().val();EasySocial.dialog({content:EasySocial.ajax("site/controllers/reports/store",{url:b.url,extension:b.extension,uid:b.uid,type:b.type,title:b.object,message:a})})},
"{cancelButton} click":function(){EasySocial.dialog().close()}}})});this.resolve()});EasySocial.module("site/repost/repost",function(e){e(document).on("click.es.repost.action","[data-repost-action]",function(){var d=e(this),b={id:d.data("id"),element:d.data("element"),group:d.data("group")},a=b.element+"-"+b.group+"-"+b.id;EasySocial.dialog({content:EasySocial.ajax("site/views/repost/form",b),bindings:{"{sendButton} click":function(c){var f=this.parent;c=e.trim(this.repostContent().val());b.content=
c;f.loading(!0);EasySocial.ajax("site/controllers/repost/share",b).done(function(b,c,f,l){b=e.buildHTML(b);actionContent=e("[data-repost-"+a+"]").toggleClass("hide",c).toggle(!c);actionContent.find("span.repost-counter").html(b);d.trigger("create",[l])}).fail(function(a){f.clearMessage();f.setMessage(a)}).always(function(){f.loading(!1);f.close()})}}})});EasySocial.module("repost/authors",function(){this.resolve(function(d){d=d.button.parents("[data-repost-content]");data={id:d.data("id"),element:d.data("element")};
return{content:EasySocial.ajax("site/controllers/repost/getSharers",data),id:"es-wrap",type:"repost",position:"bottom-right"}})});this.resolve()});EasySocial.module("site/share/share",function(e){e(document).on("click.es.share.button","[data-es-share-button]",function(){var d=e(this);EasySocial.dialog({title:d.text(),content:EasySocial.ajax("site/views/sharing/shareDialog",{url:d.data("url"),title:d.data("title")})})});this.resolve()});EasySocial.module("site/layout/dialog",function(e){var d=this;
EasySocial.require().library("dialog").view("site/dialog/default").done(function(b){EasySocial.dialog=function(a,c){if(window.parentDialog)return window.parentDialog.update(a);if("string"===typeof a||b.isDeferred(a))a={content:a,afterShow:b.isFunction(c)?c:b.noop};var f=b("#es-wrap.es-dialog.global");1>f.length&&(f=b(EasySocial.View("site/dialog/default")).addClass("global").appendTo("body"));a=b.extend({showOverlay:!1},a);var g=f.controller("Dialog");g?g.update(a):g=f.addController("Dialog",a);return g};
d.resolve()})});EasySocial.module("site/layout/responsive",function(e){e(function(){e(".es-responsive").responsive([{at:1200,switchTo:"wide"},{at:960,switchTo:"wide w960"},{at:818,switchTo:"wide w960 w768"},{at:600,switchTo:"wide w960 w768 w600"},{at:560,switchTo:"wide w960 w768 w600 w480"},{at:480,switchTo:"wide w960 w768 w600 w480 w320"}])});this.resolve()});EasySocial.module("site/layout/elements",function(e){e(document).on("click.button.data-fd-api","[data-fd-toggle-value]",function(){var d=e(this).parents('[data-foundry-toggle="buttons-radio"]');
if(!d.hasClass("disabled")&&0<d.length){var b=e(this).data("fd-toggle-value");d.find("input[type=hidden]").val(b).trigger("change")}});e(document).on("mouseover.tooltip.data-es-api","[data-es-provide=tooltip]",function(){e(this).tooltip({delay:{show:200,hide:100},animation:!1,template:'<div class="tooltip tooltip-es"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',container:"body"}).tooltip("show")});e(document).on("mouseover.popover.data-es-api","[data-es-provide=popover]",
function(){e(this).popover({delay:{show:200,hide:100},animation:!1,trigger:"hover",container:"body"}).popover("show")});e(document).on("keyup","[data-date-form] [data-date-day]",function(){if(e.trim(e(this).val())){var d=parseInt(e(this).siblings("[data-date-year]").val()||e(this).siblings("[data-date-year]").data("dateDefault")),b=parseInt(e(this).siblings("[data-date-month]").val()||e(this).siblings("[data-date-month]").data("dateDefault")),a=parseInt(e(this).val()||e(this).data("dateDefault")),
c=/1|3|5|7|8|10|12/.test(b)?31:30;2==b&&(c=(d%400?d%100&&!(d%4):1)?29:28);1>a&&(a=1);a>c&&(a=c);e.isNumeric(a)?e(this).val(a):e(this).val("")}});e(document).on("keyup","[data-date-form] [data-date-year]",function(){if(e.trim(e(this).val())){var d=parseInt(e(this).val());1>d&&(d=1);e.isNumeric(d)?e(this).val(d):e(this).val("")}});this.resolve()});EasySocial.module("site/photos/photos",function(e){var d=this;EasySocial.require().script("photos").done(function(){EasySocial.photos=e("body").addController("EasySocial.Controller.Photos");
d.resolve()})});EasySocial.module("photos",function(e){var d=this;EasySocial.require().done(function(){EasySocial.Controller("Photos",{defaultOptions:{view:{popup:"site/photos/popup",viewer:"site/photos/popup.viewer"},"{photo}":"[data-es-photo]","{popup}":"[data-photo-popup]","{viewer}":"[data-photo-viewer]","{closeButton}":"[data-popup-close-button]"},photo:{data:{},image:{},content:null,tags:[]}},function(b){return{init:function(){},createAvatar:function(a,b){if(void 0!==a){b||(b={});var f={id:a};
b.redirect&&(f.redirect=b.redirect,delete b.redirect);b.uid&&(f.uid=b.uid,delete b.uid);EasySocial.dialog(e.extend({content:EasySocial.ajax("site/views/photos/avatar",f)},b))}},selectPhoto:function(a){var b=e.Deferred(),f=EasySocial.ajax("site/views/albums/dialog"),g=EasySocial.require().script("albums/browser").done();EasySocial.dialog(e.extend({content:b},a));e.when(g,f).done(function(){f.done(function(a){b.resolve(a)})})},display:function(a,c,f){a+="";var g=b.popup();b.viewer().remove();b.show();
b.currentViewer=b.view.viewer().appendTo(g).addController("EasySocial.Controller.Photos.Viewer",e.extend({mode:"popup",initialPhoto:a,playlist:c},f))},albums:{},albumLoaders:{},getAlbum:function(a,c){a+="";var f=b.albumLoaders,g=f[a];if(c||!g||"failed"==g.state())g=f[a]=EasySocial.ajax("site/controllers/albums/getAlbum",{id:a}).done(function(c){b.albums[a]=c});return g.promise()},photos:{},photoLoaders:{},getPhoto:function(a,c){a+="";var f=b.photoLoaders,g=f[a];if(c||!g||"failed"==g.state())g=f[a]=
EasySocial.ajax("site/controllers/photos/getPhoto",{id:a,attr:["content","tags"]}).done(function(c){b.photos[a]=c;var f=c.content;c.content={};e.each(f,function(a,f){c.content[a]=e(e.trim(f)).appendTo(b.element).detach()})});return g.promise()},images:{},imageLoaders:{},getImage:function(a,c,f){a+="";var g=b.imageLoaders,g=g[a]||(g[a]={}),d=g[c];if(f||!d||"failed"==d.state())d=g[c]=e.Deferred(),b.getPhoto(a).done(function(f){e.Image.get(f.sizes[c].url).done(function(f){var g=b.images;(g[a]||(g[a]=
{}))[c]=f;d.resolve(f)}).fail(d.reject)}).fail(d.reject);return d.promise()},show:function(){b.popupElement.appendTo("body").addClass("active").trigger("show")},hide:function(){b.popupElement.removeClass("active").trigger("hide").detach()},"{self} click":function(a,c){c.target===b.popup()[0]&&b.hide()},"{photo} click":function(a,c){var f=a.data("es-photo"),g=a.parents("[data-es-album]");if(0<g.length)return g=g.data("es-album"),b.display(f,g),c.preventDefault();g=a.parents("[data-es-photos]");if(0<
g.length){var d=g.data("es-photos");if(""!==d&&void 0!==d)return d=d.split(","),b.display(f,d),c.preventDefault();d=[];g.find("[data-es-photo]").each(function(a,b){d.push(e(this).data("es-photo"))});b.display(f,d);return c.preventDefault()}},"{closeButton} click":function(){b.hide()},like:function(a){return EasySocial.ajax("site/controllers/photos/like",{id:a})}}});d.resolve()})});EasySocial.module("site/users/login",function(e){var d=this;EasySocial.require().library("dialog").done(function(){EasySocial.login=
function(){EasySocial.dialog({content:EasySocial.ajax("site/views/login/form",{})})};d.resolve()})});EasySocial.module("site/profile/popbox",function(e){EasySocial.require().library("popbox").done(function(){EasySocial.module("profile/popbox",function(d){this.resolve(function(b){var a=b.button.data("userId");b=b.button.attr("data-popbox-position")||"top-left";return{content:EasySocial.ajax("site/views/profile/popbox",{id:a}),id:"es-wrap",type:"profile",position:b}})})});EasySocial.require().script("site/conversations/composer").done();
EasySocial.Controller("Profile.Popbox",{defaultOptions:{id:null,"{addButton}":"[data-popbox-friends-add]","{friendsButton}":"[data-popbox-friends-friends]","{respondButton}":"[data-popbox-friends-respond]","{requestedButton}":"[data-popbox-friends-requested]","{messageButton}":"[data-popbox-message]","{friendsSubmenu}":"[data-friends-submenu]","{cancelFriend}":"[data-popbox-friends-friends-cancel]","{cancelFriendRequest}":"[data-popbox-friends-requested-cancel]","{approveFriend}":"[data-popbox-friends-respond-approve]",
"{rejectFriend}":"[data-popbox-friends-respond-reject]"}},function(d){return{init:function(){d.options.id=d.element.find("[data-user-id]").data("userId");EasySocial.module("site/conversations/composer").done(function(){d.messageButton().implement(EasySocial.Controller.Conversations.Composer.Dialog,{recipient:{id:d.options.id}})})},"{self} popboxActivate":function(){d.friendsSubmenu().parent().removeClass("open")},"{addButton} click":function(){EasySocial.ajax("site/controllers/friends/request",{id:d.options.id}).done(function(){EasySocial.ajax("site/views/profile/getButton",
{button:"button.requested",id:d.options.id}).done(function(b){d.addButton().replaceWith(b)})})},"{cancelFriend} click":function(b,a){var c=e(b).data("friendid");EasySocial.dialog({content:EasySocial.ajax("site/views/profile/confirmRemoveFriend",{id:d.options.id}),bindings:{"{confirmButton} click":function(){EasySocial.ajax("site/controllers/friends/unfriend",{id:c}).done(function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/friendRemoved",{id:d.options.id})});EasySocial.ajax("site/views/profile/getButton",
{button:"button.add"}).done(function(a){d.friendsSubmenu().remove();d.friendsButton().replaceWith(a)})})}}})},"{cancelFriendRequest} click":function(b,a){var c=e(b).data("friendid");EasySocial.dialog({content:EasySocial.ajax("site/views/profile/confirmCancelRequest",{id:c}),bindings:{"{confirmButton} click":function(){EasySocial.dialog().close();EasySocial.ajax("site/controllers/friends/cancelRequest",{id:c}).done(function(){EasySocial.ajax("site/views/profile/getButton",{button:"button.add"}).done(function(a){d.friendsSubmenu().remove();
d.requestedButton().replaceWith(a)})})}}})},"{approveFriend} click":function(b,a){var c=e(b).data("friendid");EasySocial.ajax("site/controllers/friends/approve",{id:c}).done(function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/confirmFriends",{id:d.options.id})});EasySocial.ajax("site/views/profile/getButton",{button:"button.friends"}).done(function(a){d.friendsSubmenu().remove();d.respondButton().replaceWith(a)})})},"{rejectFriend} click":function(b,a){var c=e(b).data("friendid");
EasySocial.ajax("site/controllers/friends/reject",{id:c}).done(function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/rejected",{id:d.options.id})});EasySocial.ajax("site/views/profile/getButton",{button:"button.add"}).done(function(a){d.friendsSubmenu().remove();d.respondButton().replaceWith(a)})})}}});e(document).on("mouseover.es.profile.popbox","[data-popbox-tooltip=profile]",function(){e(this).addController("EasySocial.Controller.Profile.Popbox")});this.resolve()});EasySocial.module("site/conversations/composer",
function(e){var d=this;EasySocial.require().library("expanding").script("site/friends/suggest","uploader/uploader","location").language("COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_RECIPIENTS","COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_MESSAGE").done(function(b){EasySocial.Controller("Conversations.Composer",{defaultOptions:{attachments:!0,location:!0,extensionsAllowed:"","{uploader}":"[data-composer-attachment]","{location}":"[data-composer-location]","{editor}":"[data-composer-editor]","{friendSuggest}":"[data-friends-suggest]",
"{recipients}":"input[name=uid\\[\\]],input[name=list_id\\[\\]]","{recipientRow}":"[data-composer-recipients]","{messageRow}":"[data-composer-message]","{submit}":"[data-composer-submit]"}},function(a){return{init:function(){a.initSuggest();a.initEditor();a.options.attachments&&a.initUploader();a.options.location&&a.initLocation()},initLocation:function(){a.location().implement(EasySocial.Controller.Location.Form)},resetForm:function(){a.editor().val("")},initUploader:function(){a.uploader().implement(EasySocial.Controller.Uploader,
{temporaryUpload:!0,query:"type=conversations",type:"conversations",extensionsAllowed:a.options.extensionsAllowed});"development"==EasySocial.environment&&(console.log("Extensions Allowed: "+a.options.extensionsAllowed),console.log("Maximum individual file size: "+a.options.maxSize))},initSuggest:function(){a.friendSuggest().addController(EasySocial.Controller.Friends.Suggest,{friendList:!0,friendListName:"list_id[]"})},initEditor:function(){a.editor().expandingTextarea()},checkErrors:function(){if(0>=
a.recipients().length)return a.recipientRow().addClass("error"),a.clearMessage(),a.setMessage(b.language("COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_RECIPIENTS"),"error"),!0;a.recipientRow().removeClass("error");if(""==a.editor().val())return a.messageRow().addClass("error"),a.clearMessage(),a.setMessage(b.language("COM_EASYSOCIAL_CONVERSATIONS_ERROR_EMPTY_MESSAGE"),"error"),!0;a.messageRow().removeClass("error");return!1},"{submit} click":function(b,f){f.preventDefault();if(a.checkErrors())return!1;
if(a.options.attachments){var g=a.uploader().controller();if(g.options.uploading&&g.hasFiles())return!1}a.element.submit()}}});EasySocial.Controller("Conversations.Composer.Dialog",{defaultOptions:{recipient:{}}},function(a){return{init:function(){},"{self} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/composer",{id:a.options.recipient.id}),bindings:{"{sendButton} click":function(){var c=b("[data-composer-recipient]").val(),f=b("[data-composer-message]").val();
EasySocial.ajax("site/controllers/conversations/store",{uid:c,message:f}).done(function(b){EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/sent",{id:a.options.recipient.id}),bindings:{"{viewButton} click":function(){document.location=b}}})}).fail(function(b){a.setMessage(b)})}}})}}});d.resolve()})});EasySocial.module("site/friends/suggest",function(e){var d=this;EasySocial.require().view("site/friends/suggest.item").library("textboxlist").language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT").done(function(b){EasySocial.Controller("Friends.Suggest.User",
{defaultOptions:{"{addButton}":"[data-friend-suggest-add]","{button}":"[data-friend-suggest-button]"}},function(a){return{init:function(){},"{addButton} click":function(c){EasySocial.ajax("site/controllers/friends/request",{id:a.element.data("uid")}).done(function(c){a.button().html(b.language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT"))}).fail(function(b){a.button().html(b)})}}});EasySocial.Controller("Friends.Suggest",{defaultOptions:{max:null,exclusive:!0,exclusion:[],minLength:1,highlight:!0,name:"uid[]",
friendList:!1,friendListName:"",view:{suggestItem:"site/friends/suggest.item"}}},function(a){return{init:function(){var b=a.options;a.element.textboxlist({name:b.name,max:b.max,plugin:{autocomplete:{exclusive:b.exclusive,minLength:b.minLength,highlight:b.highlight,showLoadingHint:!0,showEmptyHint:!0,query:function(a){return b.friendList?EasySocial.ajax("site/controllers/friends/suggestWithList",{search:a,inputName:b.name,friendListName:b.friendListName}):EasySocial.ajax("site/controllers/friends/suggest",
{search:a})}}}}).textboxlist("enable")},"{self} filterItem":function(b,f,g){if(!a.options.friendList)return b=a.view.suggestItem(!0,{item:g,name:a.options.name}),g.title=g.screenName,g.menuHtml=b,g.html=b,g},"{self} filterMenu":function(c,f,g,d,e,l){if(!a.options.friendList){c=l.getAddedItems();var m=b.pluck(c,"id"),m=m.concat(a.options.exclusion);d.each(function(){var a=b(this),c=a.data("item");a.toggleClass("hidden",-1<b.inArray(c.id.toString(),m))})}}}});d.resolve()})});EasySocial.module("location",
function(e){var d=this;EasySocial.require().library("ui/autocomplete").view("site/location/delete.confirmation").done(function(){EasySocial.Controller("Location.Form",{defaultOptions:{language:"en",initialLocation:null,mapType:"ROADMAP",staticMap:"https://www.google.com/maps?q=",showTip:!0,"{locationInput}":"[data-locationForm-input]","{locationCoordinates}":"[data-locationForm-coordinates]","{locationLatitude}":"[data-locationForm-latitude]","{locationLongitude}":"[data-locationForm-longitude]",
"{latitudeDisplay}":"[data-locationForm-latitudeDisplay]","{longitudeDisplay}":"[data-locationForm-longitudeDisplay]","{locationMap}":"[data-locationForm-map]","{locationMapWrapper}":".locationMapWrapper","{viewStaticMap}":".viewStaticMap","{editGeographic}":"[data-locationForm-edit]","{updateGeographic}":"[data-locationForm-update]","{cancelUpdateGeographic}":"[data-locationForm-cancel]","{searchButton}":"[data-locationForm-searchAddress]","{autoDetectButton}":"[data-locationForm-autodetect]","{clearLocation}":"[data-locationForm-clear]"}},
function(b){return{init:function(){var a=e.uid("ext");window[a]=function(){e.___GoogleMaps.resolve()};e.___GoogleMaps||(e.___GoogleMaps=e.Deferred(),EasySocial.require().script({prefetch:!1},"http://maps.googleapis.com/maps/api/js?sensor=true&language="+b.options.language+"&callback="+a));e.___GoogleMaps.done(function(){b._init()})},_init:function(){b.geocoder=new google.maps.Geocoder;b.hasGeolocation=void 0!==navigator.geolocation;b.hasGeolocation?b.autoDetectButton().show():b.autoDetectButton().remove();
b.locationInput().autocomplete({delay:300,minLength:0,source:b.retrieveSuggestions,select:function(a,f){b.locationInput().autocomplete("close");b.setLocation(f.item.location)}}).prop("disabled",!1);b.autocomplete=b.locationInput().autocomplete("widget");b.autocomplete.addClass("location-suggestion");var a=e.trim(b.options.initialLocation);a&&b.getLocationByAddress(a,function(a){b.setLocation(a[0])});b.busy(!1)},busy:function(a){b.locationInput().toggleClass("loading",a)},getUserLocations:function(a){b.getLocationAutomatically(function(c){b.userLocations=
b.buildDataset(c);a&&a(c)})},getLocationByAddress:function(a,c){b.geocoder.geocode({address:a},c)},getLocationByCoords:function(a,c,f){b.geocoder.geocode({location:new google.maps.LatLng(a,c)},f)},getLocationAutomatically:function(a,c){if(!navigator.geolocation)return c("ERRCODE","Browser does not support geolocation or do not have permission to retrieve location data.");navigator.geolocation.getCurrentPosition(function(c){b.getLocationByCoords(c.coords.latitude,c.coords.longitude,a)},c)},renderMap:function(a,
c){b.busy(!0);b.locationMapWrapper().show();var f=new google.maps.Map(b.locationMap()[0],{zoom:15,center:a.geometry.location,mapTypeId:google.maps.MapTypeId[b.options.mapType],disableDefaultUI:!0}),g=new google.maps.Marker({draggable:!0,position:a.geometry.location,center:a.geometry.location,title:a.formatted_address,map:f});if(b.showTip){var d=new google.maps.InfoWindow({content:c});google.maps.event.addListener(f,"tilesloaded",function(){d.open(f,g);b.busy(!1)})}google.maps.event.addListener(g,
"dragend",function(a){b.getLocationByCoords(this.getPosition().lat(),this.getPosition().lng(),function(a){b.userLocations=b.buildDataset(a);b.suggestUserLocations()});b.locationLatitude().val(this.getPosition().lat());b.locationLongitude().val(this.getPosition().lng());b.latitudeDisplay().html(this.getPosition().lat());b.longitudeDisplay().html(this.getPosition().lng())})},setLocation:function(a){a&&(b.locationResolved=!0,b.lastResolvedLocation=a,b.locationInput().val(a.formatted_address),b.locationLatitude().val(a.geometry.location.lat()),
b.locationLongitude().val(a.geometry.location.lng()),b.latitudeDisplay().html(a.geometry.location.lat()),b.longitudeDisplay().html(a.geometry.location.lng()),b.renderMap(a,a.formatted_address),b.trigger("locationSelected",[a]))},removeLocation:function(){b.locationResolved=!1;b.locationInput().val("");b.locationLatitude().val("");b.locationLongitude().val("");b.latitudeDisplay().html("");b.longitudeDisplay().html("");b.locationMapWrapper().hide();b.locationCoordinates().hide()},buildDataset:function(a){return e.map(a,
function(a){return{label:a.formatted_address,value:a.formatted_address,location:a}})},retrieveSuggestions:function(a,c){b.busy(!0);var f=a.term,g=function(a){c(a);b.busy(!1)};""==f?g(b.userLocations||[]):b.getLocationByAddress(f,function(a){g(b.buildDataset(a))})},suggestUserLocations:function(){b.hasGeolocation&&b.userLocations&&b.locationInput().autocomplete("search","");b.busy(!1)},"{locationInput} blur":function(){setTimeout(function(){var a=e.trim(b.locationInput().val());""==a?b.removeLocation():
b.locationResolved?a!=b.lastResolvedLocation.formatted_address&&b.setLocation(b.lastResolvedLocation):b.removeLocation()},250)},"{self} locationSelected":function(a,c,f){b.locationCoordinates().show();b.options.onLocationSelected&&b.options.onLocationSelected(f);b.viewStaticMap().attr("href",b.options.staticMap+encodeURIComponent(f.formatted_address))},"{cancelUpdateGeographic} click":function(){b.editGeographic().click()},"{editGeographic} click":function(){b.locationCoordinates().toggleClass("editMode")},
"{updateGeographic} click":function(){b.editGeographic().click()},"{clearLocation} click":function(){b.removeLocation()},"{autoDetectButton} click":function(){b.busy(!0);b.hasGeolocation&&!b.userLocations?b.getUserLocations(b.suggestUserLocations):b.suggestUserLocations()}}});EasySocial.Controller("Location.Map",{defaultOptions:{animation:"drop",language:"en",useStaticMap:!1,disableMapsUI:!0,showTip:!0,zoom:5,fitBounds:null,minZoom:null,maxZoom:null,center:null,locations:[],mapType:"ROADMAP",width:500,
height:400,"{locationMap}":".locationMap","{locationMapWrapper}":".locationMapWrapper","{removeUserLocation}":".removeUserLocation",view:{deleteConfirmation:"site/location/delete.confirmation"}}},function(b){return{init:function(){b.mapLoaded=!1;var a=e.uid("ext");window[a]=function(){e.___GoogleMaps.resolve()};if(!0==b.options.useStaticMap){var c="&language="+String(b.options.language),f="&size="+String(b.options.width)+"x"+String(b.options.height),a="&zoom="+String(b.options.zoom),g="&center="+
String(parseFloat(b.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(b.options.locations[0].longitude).toFixed(6)),d="&maptype="+google.maps.MapTypeId[b.options.mapType],h="&markers=",c="http://maps.googleapis.com/maps/api/staticmap?sensor=false"+c+f;if(1==b.options.locations.length)h+=String(parseFloat(b.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(b.options.locations[0].longitude).toFixed(6)),c+=a+g+d+h;else{var l=[];e.each(b.options.locations,function(a,b){l.push(String(parseFloat(b.latitude).toFixed(6))+
","+String(parseFloat(b.longitude).toFixed(6)))});h+=l.join("|");c+=h+d}b.locationMap().html('<img src="'+c+'" />');b.locationMapWrapper().show();b.busy(!1)}else a=e.uid("ext"),window[a]=function(){e.___GoogleMaps.resolve()},e.___GoogleMaps||(e.___GoogleMaps=e.Deferred(),EasySocial.require().script({prefetch:!1},"http://maps.googleapis.com/maps/api/js?sensor=true&language="+b.options.language+"&callback="+a)),e.___GoogleMaps.done(function(){b._init()})},_init:function(){null===b.options.fitBounds&&
(b.options.fitBounds=1==b.options.locations.length?!1:!0);b.options.disableMapsUI=Boolean(b.options.disableMapsUI);b.locations=[];e.each(b.options.locations,function(a,c){"null"!=c.latitude&&"null"!=c.longitude&&b.locations.push(new google.maps.LatLng(c.latitude,c.longitude))});0<b.locations.length&&b.renderMap();b.busy(!1)},busy:function(a){b.locationMap().toggleClass("loading",a)},renderMap:function(){b.busy(!0);b.locationMapWrapper().show();var a;a=b.options.center?new google.maps.LatLng(center.latitude,
center.longitude):b.locations[0];b.map=new google.maps.Map(b.locationMap()[0],{zoom:parseInt(b.options.zoom),minZoom:parseInt(b.options.minZoom),maxZoom:parseInt(b.options.maxZoom),center:a,mapTypeId:google.maps.MapTypeId[b.options.mapType],disableDefaultUI:b.options.disableMapsUI});google.maps.event.addListener(b.map,"tilesloaded",function(){!1==b.mapLoaded&&(b.mapLoaded=!0,b.loadLocations())})},loadLocations:function(){b.bounds=new google.maps.LatLngBounds;b.infoWindow=[];setTimeout(function(){e.each(b.locations,
function(a,c){b.bounds.extend(c);setTimeout(function(){b.addMarker(c,b.options.locations[a])},100*(a+1))});b.options.fitBounds&&b.map.fitBounds(b.bounds)},500)},addMarker:function(a,c){if(a){var f=new google.maps.Marker({position:a,map:b.map});f.setAnimation(google.maps.Animation.DROP);b.addInfoWindow(f,c)}},addInfoWindow:function(a,c){if(b.showTip){var f=c.content;f||(f=c.address);var g=new google.maps.InfoWindow;g.setContent(f);b.infoWindow.push(g);1<b.options.locations.length?google.maps.event.addListener(a,
"click",function(){e.each(b.infoWindow,function(a,b){b.close()});g.open(b.map,a)}):(google.maps.event.addListener(a,"click",function(){g.open(b.map,a)}),g.open(b.map,a))}},"{removeUserLocation} click":function(){var a=b.element.data("id");content=b.view.deleteConfirmation({});e.dialog({content:content,buttons:[{name:e.language("COM_EASYSOCIAL_YES_BUTTON"),click:function(){EasySocial.ajax("site/controllers/location/delete",{id:a},function(){e.dialog().close();b.element.remove()})}},{name:e.language("COM_EASYSOCIAL_CANCEL_BUTTON"),
click:function(){e.dialog().close()}}]})}}});d.resolve()})});EasySocial.module("site/privacy/privacy",function(e){var d=this;EasySocial.require().library("textboxlist").language("COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_PUBLIC","COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_MEMBER","COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_FRIENDS_OF_FRIEND","COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_FRIEND","COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_ONLY_ME","COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_CUSTOM").done(function(b){EasySocial.Controller("Privacy",
{defaultOptions:{"{menu}":"[data-privacy-menu]","{item}":"[data-privacy-item]","{icon}":"[data-privacy-icon]","{button}":"[data-privacy-toggle]","{tooltip}":"[data-original-title]","{key}":"[data-privacy-hidden]"}},function(a){return{init:function(){a.instanceId=b.uid();a.addPlugin("custom")},getData:function(a){return b._.pick(a.data(),"uid","utype","value","pid","icon")},"{self} click":function(c,f){var g=b(f.target),d=a.button();0<g.parents().andSelf().filter(d).length&&a.toggle()},"{item} click":function(b){b=
a.getData(b);a.trigger("privacyChange",[b]);b.preventSave||(a.save(b),a.deactivate())},"{self} privacyChange":function(b,f,g){a.item().removeClass("active").filter("[data-value="+g.value+"]").addClass("active")},toggle:function(){var b=a.element.hasClass("active");a[b?"deactivate":"activate"]()},activate:function(){a.element.addClass("active");a.trigger("activate",[a]);b(window).trigger("activatePrivacy",[a]);var c="click.privacy."+a.instanceId;b(document).on(c,function(f){f=b(f.target);0<f.parents().andSelf().filter(a.element).length||
0<f.parents("[data-textboxlist-autocomplete]").length||0<f.parents("[data-textboxlist-item]").length||(b(document).off(c),a.deactivate())})},deactivate:function(){a.element.removeClass("active");a.trigger("deactivate",[a]);b(window).trigger("deactivatePrivacy",[a])},"{window} activatePrivacy":function(b,f,g){g!==a&&a.deactivate()},save:function(c){a.key().val(c.value);a.icon().attr("class",c.icon);a.trigger("privacySave",[c]);a.element.attr("data-original-title",b.language("COM_EASYSOCIAL_PRIVACY_TOOLTIPS_SHARED_WITH_"+
c.value.toUpperCase()));"ajax"==a.element.data("privacyMode")&&EasySocial.ajax("site/controllers/privacy/update",{uid:c.uid,utype:c.utype,value:c.value,pid:c.pid,custom:c.custom}).done(function(){}).fail(function(){})}}});EasySocial.Controller("Privacy.Custom",{defaultOptions:{"{textField}":"[data-textfield]","{saveButton}":"[data-save-button]","{cancelButton}":"[data-cancel-button]","{customItem}":"[data-privacy-item][data-value=custom]","{customKey}":"[data-privacy-custom-hidden]"}},function(a){return{init:function(){a.textField().textboxlist({unique:!0,
plugin:{autocomplete:{exclusive:!0,minLength:1,cache:!1,query:function(b){var f=a.getIds();return EasySocial.ajax("site/views/privacy/getfriends",{q:b,exclude:f})}}}});a.textboxlist=a.textField().controller("TextboxList")},getIds:function(){var c=a.textField().textboxlist("controller").getAddedItems();return b.map(c,function(a,b){return a.id})},updateIds:function(){var b=a.getIds();a.customKey().val(b.join(","))},"{parent} privacyChange":function(b,f,g){b="custom"==g.value;a.element.toggleClass("custom-privacy",
b);b?g.preventSave=!0:a.textField().textboxlist("controller").clearItems()},"{parent} privacySave":function(a,b,g){},"{parent} deactivate":function(){a.textboxlist.autocomplete.hide()},"{cancelButton} click":function(){a.element.removeClass("custom-privacy");a.textboxlist.autocomplete.hide()},"{saveButton} click":function(){var b=a.parent,f=a.customItem(),b=b.getData(f);b.custom=a.customKey().val();a.parent.save(b);a.parent.deactivate()},"{textField} addItem":function(){a.updateIds()},"{textField} removeItem":function(){a.updateIds()}}});
b(document).on("click.es.privacy","[data-es-privacy-container]",function(){var a=b(this);a.hasController("EasySocial.Controller.Privacy")||a.addController("EasySocial.Controller.Privacy").toggle()});d.resolve()})});EasySocial.module("site/locations/popbox",function(e){EasySocial.module("locations/popbox",function(d){this.resolve(function(b){var a=b.button;b=a.data("lat");a=a.data("lng");return{id:"es-wrap",type:"location",position:"bottom",content:'<a href="'+("//maps.google.com/?q="+b+","+a)+'" target="_blank"><img src="'+
("//maps.googleapis.com/maps/api/staticmap?size=400x200&sensor=true&zoom=15&center="+b+","+a+"&markers="+b+","+a)+'" width="400" height="200" /></a>'}})});this.resolve()});EasySocial.module("site/sidebar/sidebar",function(e){e(function(){e("[data-sidebar-toggle]").on("click",function(){var d=e("[data-sidebar]");d.toggleClass("sidebar-open");d.trigger("sidebarToggle")})});this.resolve()});EasySocial.module("locations",function(e){var d=this;EasySocial.require().library("gmaps").done();EasySocial.require().library("scrollTo").view("apps/user/locations/suggestion").language("COM_EASYSOCIAL_AT_LOCATION").done(function(){EasySocial.Controller("Locations",
{defaultOptions:{view:{suggestion:"apps/user/locations/suggestion"},map:{lat:0,lng:0},"{textField}":"[data-location-textField]","{detectLocationButton}":"[data-detect-location-button]","{suggestions}":"[data-location-suggestions]","{suggestion}":"[data-story-location-suggestion]","{mapPreview}":"[data-location-map]","{latitude}":"[data-location-lat]","{longitude}":"[data-location-lng]"}},function(b){return{init:function(){navigator.geolocation&&b.detectLocationButton().show();EasySocial.require().library("gmaps").done(function(){b.textField().removeAttr("disabled")})},
navigate:function(a,c){var f=b.mapPreview(),g=b.map;void 0===g&&(g=b.map=f.show().gmaps(b.options.map));g.setCenter(a,c);g.removeMarkers();g.addMarker({lat:a,lng:c})},locations:{},lastQueryAddress:null,"{textField} keypress":function(a,c){switch(c.keyCode){case 38:var f=e(b.suggestion(".active").prev(b.suggestion.selector)[0]||b.suggestion(":last")[0]);b.suggestion().removeClass("active");f.addClass("active").trigger("activate");b.suggestions().scrollTo(f,{offset:-1*f.height()});c.preventDefault();
break;case 40:f=e(b.suggestion(".active").next(b.suggestion.selector)[0]||b.suggestion(":first")[0]);b.suggestion().removeClass("active");f.addClass("active").trigger("activate");b.suggestions().scrollTo(f,{offset:-1*f.height()});c.preventDefault();break;case 13:f=b.suggestion(".active").data("location"),b.set(f),b.suggestions().hide()}},"{textField} keyup":function(a,c){switch(c.keyCode){case 38:case 40:case 13:case 27:break;default:var f=e.trim(a.val());""===f&&b.suggestions().hide();if(f==b.lastQueryAddress)break;
var g=b.locations[f];g?(b.suggest(g),b.lastQueryAddress=f):b.lookup(f)}},lookup:e._.debounce(function(a){e.GMaps.geocode({address:a,callback:function(c,f){"OK"==f&&(b.locations[a]=c,b.suggest(c),b.lastQueryAddress=a)}})},250),suggest:function(a){var c=b.suggestions();c.hide().empty();e.each(a,function(a,g){b.view.suggestion({location:g}).data("location",g).appendTo(c)});c.show()},"{suggestion} activate":function(a,c){var f=a.data("location");b.navigate(f.geometry.location.lat(),f.geometry.location.lng())},
"{suggestion} mouseover":function(a){b.suggestion().removeClass("active");a.addClass("active").trigger("activate")},"{suggestion} click":function(a,c){var f=a.data("location");b.set(f);b.suggestions().hide()},set:function(a){b.currentLocation=a;var c=a.formatted_address;b.textField().val(c);b.latitude().val(a.geometry.location.lat());b.longitude().val(a.geometry.location.lng());b.trigger("locationChange",[a])},"{detectLocationButton} click":function(){e.GMaps.geolocate({success:function(a){e.GMaps.geocode({lat:a.coords.latitude,
lng:a.coords.longitude,callback:function(a,f){"OK"==f&&(b.suggest(a),b.textField().focus())}})},error:function(a){},always:function(){}})},"{story} save":function(a,c,f){(a=b.currentLocation)&&f.addData(b,{short_address:a.address_components[0].long_name,formatted_address:a.formatted_address,lat:a.geometry.location.lat(),lng:a.geometry.location.lng()})},"{story} clear":function(){b.unset()}}});d.resolve()})});EasySocial.module("oauth/facebook",function(e){e(document).on("click","[data-oauth-facebook-login]",
function(){var d=e(this),b=d.parents("[data-oauth-facebook]");1>b.length||b.hasController("EasySocial.Controller.OAuth.Facebook")||b.addController("EasySocial.Controller.OAuth.Facebook",{url:d.data("oauth-facebook-url"),appId:d.data("oauth-facebook-appid")}).openDialog()});EasySocial.Controller("OAuth.Facebook",{defaultOptions:{appId:null,url:"","{login}":"[data-oauth-facebook-login]","{revoke}":"[data-oauth-facebook-revoke]","{pushInput}":"[data-oauth-facebook-push]"}},function(d){return{init:function(){},
openDialog:function(){window.open(d.options.url,"","scrollbars=no,resizable=no,width=300,height=300,left="+(screen.width/2-150)+",top="+(screen.height/2-150))},"{pushInput} change":function(b){b=e(b).val();1==b&&d.options.requestPush&&d.openDialog(d.options.addPublishURL);0==b&&d.openDialog(d.options.revokePublishURL)},"{login} click":function(){d.openDialog()},"{revoke} click":function(){var b=d.element.data("callback");EasySocial.dialog({content:EasySocial.ajax("site/views/oauth/confirmRevoke",
{client:"facebook",callbackUrl:b})})}}});this.resolve()});EasySocial.module("pagination",function(){var e=this;EasySocial.require().done(function(d){EasySocial.Controller("Pagination",{defaultOptions:{"{pages}":".pageItem","{limitstart}":"#limitstart","{previousItem}":".previousItem","{nextItem}":".nextItem"}},function(b){return{init:function(){b.pages().implement(EasySocial.Controller.Pagination.Page,{pagination:b})},"{previousItem} click":function(a){var c=d(a).data("limitstart");d(a).hasClass("disabled")||
b.submitForm(c)},"{nextItem} click":function(a){var c=d(a).data("limitstart");d(a).hasClass("disabled")||b.submitForm(c)},submitForm:function(a){b.limitstart().val(a);Joomla.submitform()}}});EasySocial.Controller("Pagination.Page",{defaultOptions:{pagination:null,limitstart:0}},function(b){return{init:function(){b.options.limitstart=b.element.data("limitstart")},"{self} click":function(){if(b.element.hasClass("active"))return!1;b.options.pagination.submitForm(b.options.limitstart)}}});e.resolve()})});
EasySocial.module("photos/avatar",function(e){var d=this;EasySocial.require().library("imgareaselect").stylesheet("imgareaselect/default").done(function(){EasySocial.Controller("Photos.Avatar",{defaultOptions:{view:{selection:"site/photos/avatar.selection"},redirect:!0,"{image}":"[data-photo-image]","{viewport}":"[data-photo-avatar-viewport]","{photoId}":"[data-photo-id]","{userId}":"[data-user-id]","{createButton}":"[data-create-button]","{selection}":"[data-selection-box]","{loadingIndicator}":"[data-photos-avatar-loading]"}},
function(b){return{init:function(){b.setLayout()},data:function(){var a=b.viewport(),c=a.width(),f=a.height(),a=a.imgAreaSelect({instance:!0}).getSelection();return{id:b.photoId().val(),uid:b.userId().val(),top:a.y1/f,left:a.x1/c,width:a.width/c,height:a.height/f}},imageLoaders:{},setLayout:function(){var a=b.image(),c=e.uri(a.css("backgroundImage")).extract(0);(b.imageLoaders[c]||(b.imageLoaders[c]=e.Image.get(c))).done(function(c,g){var d=e.Image.resizeWithin(g.width,g.height,a.width(),a.height()),
h=Math.min(d.width,d.height),l=Math.floor((d.width-h)/2),m=Math.floor((d.height-h)/2),q=l+h,h=m+h;b.viewport().css(d).imgAreaSelect({handles:!0,aspectRatio:"1:1",parent:b.image(),x1:l,y1:m,x2:q,y2:h,onSelectEnd:function(a,c){var f=!("0"==c.width&&"0"==c.height);b.createButton().enabled(f)}})})},"{createButton} click":function(a){a=b.data();var c=EasySocial.ajax("site/controllers/photos/createAvatar",a).done(function(a,c,d){b.options.redirect&&(window.location=d)}).fail(function(a,c){b.setMessage(a,
c)});b.trigger("avatarCreate",[c,a,b])}}});d.resolve()})});EasySocial.module("photos/browser",function(e){var d=this;EasySocial.require().library("masonry").done();EasySocial.require().library("history").done(function(){EasySocial.Controller("Photos.Browser",{defaultOptions:{tilesPerRow:4,"{sidebar}":"[data-photo-browser-sidebar]","{content}":"[data-photo-browser-content]","{backButton}":"[data-photo-back-button]","{backButtonLink}":"[data-photo-back-button-link]","{listItemGroup}":"[data-photo-list-item-group]",
"{listItem}":"[data-photo-list-item]","{listItemLink}":"[data-photo-list-item] > a","{listItemTitle}":"[data-photo-list-item-title]","{listItemCover}":"[data-photo-list-item-cover]","{listItemImage}":"[data-photo-list-item-image]","{featuredListItem}":"[data-photo-list-item].featured","{featuredListItemImage}":"[data-photo-list-item].featured [data-photo-list-item-image]","{photoItem}":"[data-photo-item]"}},function(b){return{init:function(){e.module("masonry").done(function(){b.setLayout()})},setLayout:function(){var a=
b.listItemGroup().addClass("masonry"),c=b.setLayout.seed==a.width();hasPhotoItem=0<b.listItem().length;masonry=a.data("masonry");if(c)masonry&&masonry.reload();else{var a=b.listItemGroup(),f=b.listItem(),c=b.options.tilesPerRow,g=a.width(),c=Math.floor(g/c)*c/c,d=f.outerWidth(!0)-f.width(),e=f.outerHeight(!0)-f.height(),f=c-d,g=c-e,d=2*c-d,e=2*c-e;b.listItem.css({width:f,height:g});b.listItemImage.css({width:f,height:g});b.featuredListItem.css({width:d,height:e});b.featuredListItemImage.css({width:d,
height:e});a.masonry({columnWidth:c}).masonry("reload")}b.setLayout.seed=a.width()},open:function(a){var c=e.makeArray(arguments);b.trigger("contentLoad",c);var f="view"+e.String.capitalize(a),f=b[f].apply(b,c.slice(1));f.done(b.displayContent(function(){b.trigger("contentDisplay",c);return arguments})).fail(function(){b.trigger("contentFail",c)}).always(function(){b.trigger("contentComplete",c)});return f},displayContent:e.Enqueue(function(a){var c=[];a=e(e.buildFragment([a],document,c));b.content().html(a);
e(c).remove()}),viewPhoto:function(a){var c=b.listItem().removeClass("active loading").filterBy("photoId",a).addClass("active loading");return EasySocial.ajax("site/views/photos/item",{id:a,browser:!1}).fail(function(){}).always(function(){c.removeClass("loading")})},"{listItem} click":function(a){var c=a.data("photoId");b.open("Photo",c);a.find("> a").route()},"{listItemLink} click":function(a,b){b.preventDefault();a.blur()},"{backButtonLink} click":function(a,c){var f=b.browser;if(f){var g=b.element.data("albumId");
f.open("album",g);c.preventDefault();a.route()}},getListItem:function(a,c){var f=a?b.listItem().filterBy("photoId",a):b.listItem(".new");return c?f.find(b["listItem"+e.String.capitalize(c)].selector):f},getNextListItem:function(a){a=b.getListItem(a).next(b.listItem.selector);1>a.length&&(a=b.listItem(":first"));return a},getPrevListItem:function(a){a=b.getListItem(a).prev(b.listItem.selector);1>a.length&&(a=b.listItem(":last"));return a},removeListItem:function(a,c){var f=b.getListItem(a),g=b.getPrevListItem(a);
f.remove();b.setLayout();if(1>b.listItem().length)return b.element.addClass("loading"),window.location=b.backButtonLink().attr("href");c&&g.click()},"{photoItem} init.photos.item":function(a,c,f){b.addSubscriber(f)},"{photoItem} photoSave":function(a,c,f){f.done(function(a,c){b.getListItem(a.id,"title").html(a.title)})},"{photoItem} photoNext":function(a,c,f){b.getNextListItem(f.id).click()},"{photoItem} photoPrev":function(a,c,f){b.getPrevListItem(f.id).click()},"{photoItem} photoMove":function(a,
c,f,g,d){f.done(function(){b.removeListItem(g.id,!0)})},"{photoItem} photoDelete":function(a,c,f,g){f.done(function(){b.removeListItem(g.id,!0)})},"{photoItem} photoFeature":function(a,c,f,g,d){var e=b.getListItem(g.id);e.toggleClass("featured",d);b.setLayout();f.fail(function(){e.toggleClass("featured",!d);b.setLayout()})}}});d.resolve()})});EasySocial.module("photos/cover",function(e){var d=this;EasySocial.require().library("image").done(function(){EasySocial.Controller("Photos.Cover",{defaultOptions:{"{image}":"[data-cover-image]",
"{editButton}":"[data-cover-edit-button]","{doneButton}":"[data-cover-done-button]","{cancelButton}":"[data-cover-cancel-button]","{uploadButton}":"[data-cover-upload-button]","{selectButton}":"[data-cover-select-button]","{removeButton}":"[data-cover-remove-button]","{menu}":"[data-cover-menu]"}},function(b){return{init:function(){b.setLayout();b.element.hasClass("editing")&&b.enable()},"{window} resize":e.debounce(function(){b.setLayout()},250),"{editButton} click":function(){b.enable()},"{cancelButton} click":function(){b.disable()},
ready:!1,disabled:!0,toggle:function(){b[b.disabled?"enable":"disable"]()},enable:function(){b.setLayout();b.disabled=!1;b.element.addClass("editing")},disable:function(){b.disabled=!0;b.element.removeClass("editing");var a=e.uri(window.location.href).deleteQueryParam("cover_id").toString();History.pushState({state:0},window.title,a)},imageLoaders:{},setLayout:function(){var a=b.image(),c=b.setLayout.image,f=b.element.width()/3;b.element.height(f);if(c){var f=c.data("width"),g=c.data("height"),c=
a.width(),a=a.height(),f=e.Image.resizeProportionate(f,g,c,a,"outer");b.availableWidth=c-f.width;b.availableHeight=a-f.height}else if(a=e.uri(a.css("backgroundImage")).extract(0))f=b.imageLoaders,(f[a]||(f[a]=e.Image.get(a))).done(function(a){b.setLayout.image=a;b.setLayout()})},setCover:function(a,c){b.element.addClass("loading");e.Image.get(c).done(function(){b.image().data("photoId",a).css({backgroundImage:e.cssUrl(c),backgroundPosition:"50% 50%"});b.x=0.5;b.y=0.5;b.enable()}).fail(function(){b.disable()}).always(function(){b.element.removeClass("loading")})},
drawing:!1,moveCover:function(a,c,f){f||(f=b.image());var g=b.availableWidth,d=b.availableHeight;a=0==g?0:b.x+(a/g||0);c=0==d?0:b.y+(c/d||0);0>a&&(a=0);1<a&&(a=1);0>c&&(c=0);1<c&&(c=1);f.css("backgroundPosition",100*(b.x=a)+"% "+100*(b.y=c)+"% ")},x:0.5,y:0.5,"{image} mousedown":function(a,c){if(!b.disabled){c.target===b.image()[0]&&c.preventDefault();b.drawing=!0;b.element.addClass("active");var f=b.image(),g=b.image().css("backgroundPosition").split(" ");b.x=parseInt(g[0])/100;b.y=parseInt(g[1])/
100;var d=c.pageX,h=c.pageY;e(document).on("mousemove.movingCover mouseup.movingCover",function(a){b.drawing&&b.moveCover(-1*(d-(d=a.pageX)),-1*(h-(h=a.pageY)),f)}).on("mouseup.movingCover",function(){e(document).off("mousemove.movingCover mouseup.movingCover");b.element.removeClass("active")})}},save:function(){var a=b.image().data("photoId");return EasySocial.ajax("site/controllers/photos/createCover",{id:a,x:b.x,y:b.y}).done(function(a){b.element.css({backgroundImage:e.cssUrl(a.url),backgroundPosition:a.position}).removeClass("no-cover");
b.disable()})},"{doneButton} click":function(){b.save()},"{menu} dropdownOpen":function(){b.element.addClass("show-all")},"{menu} dropdownClose":function(){b.element.removeClass("show-all")},"{selectButton} click":function(){EasySocial.photos.selectPhoto({bindings:{"{self} photoSelected":function(a,c,f){if(a=f[0])b.setCover(a.id,a.sizes.large),this.parent.close()}}})},"{uploadButton} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/uploadCover"),bindings:{"{self} upload":function(a,
c,f,g){f.done(function(a){b.setCover(a.id,a.sizes.large.url)})}}})},"{removeButton} click":function(){EasySocial.ajax("site/controllers/photos/removeCover").done(function(a){b.element.css({backgroundImage:e.cssUrl(a),backgroundPosition:"50% 50%"}).addClass("no-cover");b.disable()})}}});d.resolve()})});EasySocial.module("photos/editor",function(e){var d=this;EasySocial.require().done(function(){var b=EasySocial.Controller("Photos.Editor",{defaultOptions:{view:{uploadItem:"upload.item",photoForm:"site/albums/photo.form"},
"{titleField}":"[data-photo-title-field]","{captionField}":"[data-photo-caption-field]","{location}":"[data-photo-location]","{locationCaption}":"[data-photo-location-caption]","{addLocationButton}":"[data-photo-addLocation-button]","{date}":"[data-photo-date]","{dateCaption}":"[data-photo-date-caption]","{addDateCaption}":"[data-photo-adddate-button]","{locationWidget}":".es-photo-location-form .es-location","{latitude}":"[data-location-lat]","{longitude}":"[data-location-lng]","{dateDay}":"[name=date-day]",
"{dateMonth}":"[name=date-month]","{dateYear}":"[name=date-year]","{actionsMenu}":"[data-item-actions-menu]","{featureButton}":"[data-photo-feature-button]","{coverButton}":"[data-photo-cover-button]","{editButton}":"[data-photo-edit-button]","{editButtonLink}":"[data-photo-edit-button] > a","{doneButton}":"[data-photo-done-button]","{doneButtonLink}":"[data-photo-done-button] > a","{moveButton}":"[data-photo-move-button]","{deleteButton}":"[data-photo-delete-button]","{rotateLeftButton}":"[data-photo-rotateLeft-button]",
"{rotateRightButton}":"[data-photo-rotateRight-button]","{profileAvatarButton}":"[data-photo-profileAvatar-button]","{profileCoverButton}":"[data-photo-profileCover-button]"}},function(a){return{init:function(){},data:function(){return{id:a.photo.id,title:a.titleField().val(),caption:a.captionField().val(),date:a.formatDate(),address:a.locationCaption().html(),latitude:a.latitude().val(),longitude:a.longitude().val()}},save:function(){var b=a.data();a.clearMessage();b=EasySocial.ajax("site/controllers/photos/update",
b).done(function(b){a.photo.setLayout("item")}).fail(function(){a.setMessage(message,"error")}).progress(function(b,c){"success"==c&&a.setMessage(b)});a.trigger("photoSave",[b,a]);return b},enable:function(){a.photo.setLayout("form");a.photo.album&&a.element.addClass("active");a.trigger("enabled",[a])},disable:function(){a.photo.setLayout("item");a.photo.album&&a.element.removeClass("active");a.trigger("disabled",[a])},setImage:function(b){var f=a.photo.image();b=a.photo[b+"Image"]();var g=b.data("src"),
d=b.data("loader");d||(d=e.Image.get(g),b.data("loader",d));d.done(function(){f.css("backgroundImage","url("+g+")")});return d},"{featureButton} click":function(b,f){f.stopPropagation();var g=a.element.hasClass("featured");a.element.addTransitionClass("featuring",800).toggleClass("featured",!g);setTimeout(function(){a.setImage(g?"thumbnail":"featured")},1E3);var d=EasySocial.ajax("site/controllers/photos/feature",{id:a.photo.id}).done(function(a,f){b.toggleClass("btn-es-primary",f)}).fail(function(){a.element.addTransitionClass("featuring",
800).toggleClass("featured",g);setTimeout(function(){a.setImage(g?"featured":"thumbnail")},1E3)});a.trigger("photoFeature",[d,a.photo,!g])},"{coverButton} click":function(){var b=a.photo.album;b&&b.editor&&b.editor.setCover(a.photo.id)},"{dateDay} keyup":function(){a.updateDate()},"{dateMonth} change":function(){a.updateDate()},"{dateYear} keyup":function(){a.updateDate()},updateDate:function(){setTimeout(function(){a.date().addClass("has-data");var b=a.dateDay().val()+" "+e.trim(a.dateMonth().find(":selected").text()+
" "+a.dateYear().val());a.dateCaption().html(b)},1)},formatDate:function(){var b=a.dateDay().val()||a.dateDay().data("date-default"),f=a.dateMonth().val()||a.dateMonth().data("date-default");return(a.dateYear().val()||a.dateYear().data("date-default"))+"-"+f+"-"+b},"{locationWidget} locationChange":function(b,f,g){b=g.formatted_address;a.locationCaption().html(b);a.location().addClass("has-data")},rotate:function(b){var f=a.photo;f.content().addClass("loading");var g=EasySocial.ajax("site/controllers/photos/rotate",
{id:f.id,angle:b}).done(function(b){b=a.photo.album?b.sizes.thumbnail.url:b.sizes.large.url;f.image().css({backgroundImage:e.cssUrl(b)});a.element.addTransitionClass("rotating-ready",150).removeClass("rotating-right rotating-left")}).fail(function(b,c){a.setMessage(b,c)}).always(function(){f.content().removeClass("loading")});a.trigger("photoRotate",[g,b,f])},"{rotateRightButton} click":function(){a.element.addClass("rotating-right");a.rotate(90)},"{rotateLeftButton} click":function(){a.element.addClass("rotating-left");
a.rotate(-90)},"{moveButton} click":function(){var b=a.photo,f=EasySocial.dialog({content:EasySocial.ajax("site/views/photos/moveToAnotherAlbum",{id:b.id}),bindings:{"{moveButton} click":function(){var g=this.albumSelection().val(),d=EasySocial.ajax("site/controllers/photos/move",{id:b.id,albumId:g}).always(function(){f.close()});a.trigger("photoMove",[d,b,g])}}})},"{deleteButton} click":function(){var b=a.photo;EasySocial.dialog({content:EasySocial.ajax("site/views/photos/confirmDelete",{id:b.id}),
bindings:{"{deleteButton} click":function(f){var g=this.parent;f.disabled(!0);f=EasySocial.ajax("site/controllers/photos/delete",{id:b.id}).always(function(){g.close()});a.trigger("photoDelete",[f,b])}}})},"{editButton} click":function(){a.photo.setLayout("form");a.editButtonLink().route()},"{editButtonLink} click":function(a,b){b.preventDefault()},"{doneButton} click":function(){a.save().done(function(){a.photo.setLayout("item");a.doneButtonLink().route()}).fail(function(){})},"{doneButtonLink} click":function(a,
b){b.preventDefault()},"{profileAvatarButton} click":function(){EasySocial.photos.createAvatar(a.photo.id)}}});d.resolve(b)})});EasySocial.module("photos/item",function(e){var d=this;EasySocial.require().script("photos/tags","photos/editor","photos/tagger","photos/navigation").done();EasySocial.require().library("image").done(function(){var b=EasySocial.Controller("Photos.Item",{hostname:"photo",defaultOptions:{editable:!1,taggable:!1,navigation:!1,"{header}":"[data-photo-header]","{content}":"[data-photo-content]",
"{footer}":"[data-photo-footer]","{info}":"[data-photo-info]","{title}":"[data-photo-title]","{titleLink}":"[data-photo-title-link]","{caption}":"[data-photo-caption]","{image}":"[data-photo-image]","{imageLink}":"[data-photo-image-link]","{thumbnailImage}":"[data-photo-image-thumbnail]","{featuredImage}":"[data-photo-image-featured]","{largeImage}":"[data-photo-image-large]","{menu}":"[data-photo-menu]","{actions}":"[data-item-actions]","{actionsMenu}":"[data-item-actions-menu]","{comments}":"[data-comments]",
"{share}":"[data-repost-action]","{likes}":"[data-likes-action]","{likeContent}":"[data-likes-content]","{repostContent}":"[data-repost-content]","{counterBar}":"[data-stream-counter]","{privacy}":"[data-es-privacy-container]","{likeCount}":"[data-photo-like-count]","{commentCount}":"[data-photo-comment-count]","{tagCount}":"[data-photo-tag-count]"}},function(a){return{init:function(){a.id=a.element.data("photoId");EasySocial.module("photos/tags").done(function(b){a.tags=a.addPlugin("tags",b)});a.options.editable&&
EasySocial.module("photos/editor").done(function(b){a.editor=a.addPlugin("editor",b)});a.options.taggable&&EasySocial.module("photos/tagger").done(function(b){a.tagger=a.addPlugin("tagger",b)});a.options.navigation&&EasySocial.module("photos/navigation").done(function(b){a.navigation=a.addPlugin("navigation",b)})},data:function(){return{id:a.id,title:e.trim(a.title().text()),caption:e.trim(a.caption().text()),sizes:{thumbnail:a.thumbnailImage().data("src"),featured:a.featuredImage().data("src"),large:a.largeImage().data("src")}}},
setLayout:function(b){a.element.data("photoLayout",b).switchClass("layout-"+b);a.trigger("layoutChange",[b,a])},"{self} click":function(b,f){var g=e(f.target),d=a.menu();0<g.parents().andSelf().filter(d).length||a.trigger("activate",[a])},"{self} photoSave":function(b,f,g){g.done(function(b,c){a.info().replaceWith(c)})},"{self} photoDelete":function(b,f,g){g.done(function(){}).fail(function(b,c){a.setMessage(b,c)})},"{imageLink} click":function(a,b){b.preventDefault()},"{titleLink} click":function(a,
b){},"{self} dropdownOpen":function(){a.element.addClass("show-all")},"{self} dropdownClose":function(){a.element.removeClass("show-all")},"{share} create":function(b,f,g){a.counterBar().removeClass("hide")},"{likes} onLiked":function(b,f,g){a.counterBar().removeClass("hide");a.count("like",1,!0)},"{likes} onUnliked":function(b,f,g){b=a.likeContent().hasClass("hide");f=a.repostContent().hasClass("hide");b&&f&&a.counterBar().addClass("hide");a.count("like",-1,!0)},"{self} tagAdd":function(){a.count("tag",
1,!0)},"{self} tagRemove":function(){a.count("tag",-1,!0)},"{comments} newCommentSaved":function(){a.count("comment",1,!0)},"{comments} commentDeleted":function(){a.count("comment",-1,!0)},"{privacy} activate":function(){setTimeout(function(){a.element.addClass("show-all")},0)},"{privacy} deactivate":function(){a.element.removeClass("show-all")},count:function(b,f,g){b=a[b+"Count"];e.isFunction(b)&&(b=b(),0>b.length||(f=g?(parseInt(b.text())||0)+(parseInt(f)||0):f,0>f&&(f=0),b.text(f)))}}});d.resolve(b)})});
EasySocial.module("photos/tags",function(e){var d=this;EasySocial.require().library("scrollTo").done();EasySocial.require().done(function(){var b=EasySocial.Controller("Photos.Tags",{hostname:"tags",defaultOptions:{"{viewport}":"[data-photo-tag-viewport]","{tagItem}":"[data-photo-tag-item]","{tagButton}":"[data-photo-tag-button]","{tagListItemGroup}":"[data-photo-tag-list-item-group]","{tagListItem}":"[data-photo-tag-list-item]"}},function(a){return{init:function(){a.setLayout()},imageLoaders:{},
setLayout:function(b){var f=a.photo.image(),g=e.uri(f.css("backgroundImage")).extract(0);(a.imageLoaders[g]||(a.imageLoaders[g]=e.Image.get(g))).done(function(g,d){a.viewport().css(e.Image.resizeWithin(d.width,d.height,f.width(),f.height()));b&&b()})},getTagItem:function(b){return a.tagItem().filterBy("photoTagId",b)},getTagListItem:function(b){return a.tagListItem().filterBy("photoTagId",b)},getTaggedUsers:function(){var b=[];a.tagListItem("[data-photo-tag-uid]").each(function(){b.push(e(this).data("photoTagUid"))});
return e.uniq(b)},activateTag:function(b){a.getTagItem(b).addClass("active");a.getTagListItem(b).addClass("active")},deactivateTag:function(b){a.getTagItem(b).removeClass("active");a.getTagListItem(b).removeClass("active")},"{tagListItem} click":function(b){var f=(b.hasClass("active")?"deactivate":"activate")+"Tag";b=b.data("photoTagId");a[f](b)},"{tagListItem} mouseover":function(b){a.getTagItem(b.data("photoTagId")).addClass("focus")},"{tagListItem} mouseout":function(b){a.getTagItem(b.data("photoTagId")).removeClass("focus")},
"{self} tagRemove":function(b,f,g,d){g.done(function(){a.getTagItem(d).remove();a.getTagListItem(d).remove()})},"{self} photoRotate":function(b,f,g,d,h){g.done(function(b,c){setTimeout(function(){a.setLayout(function(){var b=a.tagItem();e.each(c,function(a,c){b.filterBy("photoTagId",c.id).css({width:100*c.width+"%",height:100*c.height+"%",top:100*c.top+"%",left:100*c.left+"%"})})})},1)})}}});d.resolve(b)})});EasySocial.module("photos/tagger",function(e){var d=this;EasySocial.require().library("scrollTo").done();
EasySocial.require().view("site/photos/tags.item","site/photos/tags.menu.item").done(function(){var b=EasySocial.Controller("Photos.Tagger",{hostname:"tagger",defaultOptions:{view:{tagItem:"site/photos/tags.item"},width:100,height:100,drawTolerance:30,"{viewport}":"[data-photo-tag-viewport]","{tagItem}":"[data-photo-tag-item]","{tagSelection}":"[data-photo-tag-item].new","{tagButton}":"[data-photo-tag-button]","{tagListItemGroup}":"[data-photo-tag-list-item-group]","{tagListItem}":"[data-photo-tag-list-item]",
"{tagRemoveButton}":"[data-photo-tag-remove-button]"}},function(a){return{init:function(){},newTagItem:function(){var b=a.viewport(),f=a.tagItem(".new");1>f.length&&(f=a.view.tagItem().addClass("new").appendTo(b),a.addSubscriber(f.addController("EasySocial.Controller.Photos.Tag")));return f},"{tagButton} click":function(b){a[b.data("photoTagButton")||"toggle"]()},disabled:!0,enable:function(){a.disabled=!1;a.element.addClass("tagging");e.scrollTo&&e.scrollTo(a.photo.content(),250,{offset:{top:-100}});
a.trigger("tagEnter")},disable:function(){a.tagSelection().remove();a.tagItem(".focus").removeClass("focus");a.disabled=!0;a.element.removeClass("tagging");a.trigger("tagLeave")},toggle:function(){a[a.disabled?"enable":"disable"]()},area:{},calculateArea:function(b,f){b||(b="clip");f||(f={x:0,y:0});var g=a.viewport(),d=g.offset();d.width=g.width();d.height=g.height();d.right=d.width+d.left;d.bottom=d.height+d.top;g=a.area;g.top=(g.startY<=g.endY?g.startY:g.endY)+f.y;g.left=(g.startX<=g.endX?g.startX:
g.endX)+f.x;g.width=Math.abs(g.endX-g.startX);g.height=Math.abs(g.endY-g.startY);g.right=g.width+g.left;g.bottom=g.height+g.top;"clip"==b&&(g.top<=d.top&&(g.top=d.top),g.bottom>=d.bottom&&(g.bottom=d.bottom),g.left<=d.left&&(g.left=d.left),g.right>=d.right&&(g.right=d.right),g.width=g.right-g.left,g.height=g.bottom-g.top);"flip"==b&&(g.top<=d.top&&(g.top=d.top),g.left<=d.left&&(g.left=d.left),g.right>=d.right&&(g.right=d.right,g.left=g.right-g.width),g.bottom>=d.bottom&&(g.bottom=d.bottom,g.top=g.bottom-
g.height));g.pixel={top:g.top-d.top,left:g.left-d.left,width:g.width,height:g.height};g.decimal={top:g.pixel.top/d.height,left:g.pixel.left/d.width,width:g.width/d.width,height:g.height/d.height};g.percentage={top:100*g.decimal.top+"%",left:100*g.decimal.left+"%",width:100*g.decimal.width+"%",height:100*g.decimal.height+"%"};d=a.options.drawTolerance;a.autodraw=g.width<d&&g.height<d;return g},setPivot:function(b,f,d){var e=a.area;e[b+"X"]=f;e[b+"Y"]=d},drawing:!1,autodraw:!1,drawTag:function(){var b=
a.calculateArea();options=a.options;a.autodraw&&(b.endX=b.startX+options.width,b.endY=b.startY+options.height,a.calculateArea("flip",{x:options.width/-2,y:options.height/-2}));a.newTagItem().css(b.percentage).trigger("focusInput")},"{viewport} mousedown":function(b,f){a.disabled||f.target!==b[0]||(f.preventDefault(),a.tagItem(".focus").removeClass("focus"),a.drawing=!0,a.setPivot("start",f.pageX,f.pageY),e(document).on("mousemove.tagger",function(b){a.drawing&&(a.setPivot("end",b.pageX,b.pageY),a.drawTag())}).on("mouseup.tagger",
function(b){a.setPivot("end",b.pageX,b.pageY);a.drawTag();e(document).off("mousemove.tagger mouseup.tagger")}))},createTag:function(b){b=e.extend({photo_id:a.photo.id},b,a.area.decimal);var f=EasySocial.ajax("site/controllers/photos/createTag",b);a.trigger("tagCreate",[f,b,a]);return f},removeTag:function(b){var f=EasySocial.ajax("site/controllers/photos/removeTag",{id:b});a.trigger("tagRemove",[f,b,a]);return f},addTag:function(b,f,d){f=e.buildHTML(f).addClass("focus").appendTo(a.viewport());d=e.buildHTML(d).appendTo(a.tagListItemGroup());
a.trigger("tagAdd",[b,f,d,a])},"{self} avatarEnter":function(){a.tagItem().hide();a.disable()},"{self} avatarLeave":function(){a.tagItem().show()},"{tagRemoveButton} click":function(b,f){var d=b.data("photoTagId");a.removeTag(d);f.stopPropagation()},"{tagRemoveButton} mouseover":function(){a.viewport().addClass("active")},"{tagRemoveButton} mouseout":function(){a.viewport().removeClass("active")}}});EasySocial.Controller("Photos.Tag",{defaultOptions:{view:{menuItem:"site/photos/tags.menu.item"},"{form}":"[data-photo-tag-form]",
"{title}":"[data-photo-tag-title]","{removeButton}":"[data-photo-tag-remove-button]","{textField}":"[data-photo-tag-input]","{menu}":"[data-photo-tag-menu]","{menuItem}":"[data-photo-tag-menu-item]"}},function(a){return{init:function(){a.data=a.options.data},"{self} focusInput":function(){a.textField().focus()},"{textField} keyup":e._.debounce(function(b,f){var d=e.trim(a.textField().val());switch(f.keyCode){case 38:case 40:case 13:case 27:break;default:var k=a.tagger.photo.tags.getTaggedUsers();
EasySocial.ajax("site/controllers/friends/suggestPhotoTagging",{search:d,exclude:k,includeme:"1"}).done(a.render())}},250),"{textField} keypress":function(b,f){var d=e.trim(a.textField().val()),k=a.menuItem(".active");switch(f.keyCode){case 38:a.menuItem().removeClass("active");1>k.length?a.menuItem(":last").addClass("active"):k.prev(a.menuItem.selector).addClass("active");f.preventDefault();break;case 40:a.menuItem().removeClass("active");1>k.length?a.menuItem(":first").addClass("active"):k.next(a.menuItem.selector).addClass("active");
f.preventDefault();break;case 13:0<k.length?k.trigger("click"):a.create({type:"label",label:d});a.menu().hide();break;case 27:a.menu().hide()}},"{menuItem} mouseover":function(b){a.menuItem().removeClass("active");b.addClass("active")},"{menuItem} mouseout":function(b){a.menuItem().removeClass("active")},render:e.Enqueue(function(b){var f=a.menu();!b||1>b.length?f.hide():(f.empty(),e.each(b,function(b,c){a.view.menuItem({item:c}).data("item",c).appendTo(f);f.show()}))}),create:function(b){var f=a.element;
a.data=b;a.title().html(b.label);""!==e.trim(b.label)&&a.tagger.createTag(b).done(function(b,c,f){a.tagger.addTag(b,c,f);a.element.remove()}).fail(function(){f.remove()})},remove:function(){var b=a.element,f=(a.data||{}).id;if(!f)return b.remove();a.tagger.removeTag(f).done(function(){b.remove()})},"{menuItem} click":function(b){b=b.data("item");a.create({uid:b.id,type:"person",label:b.screenName})},"{removeButton} click":function(){a.remove()}}});d.resolve(b)})});EasySocial.module("photos/navigation",
function(e){e.fn.intersectsWith=function(b,a,c,f){var d=this.offset(),d={top:d.top,left:d.left,bottom:d.top+(sourceHeight=this.height()),right:d.left+(sourceWidth=this.width()),width:sourceWidth,height:sourceHeight};b={top:b,left:a,bottom:b+(f||(f=0)),right:a+(c||(c=0)),width:c,height:f};return d.left<=b.right&&b.left<=d.right&&d.top<=b.bottom&&b.top<=d.bottom?{reference:d,subject:b}:!1};var d=EasySocial.Controller("Photos.Navigation",{hostname:"navigation",defaultOptions:{"{navButton}":".es-photo-nav-button",
"{nextButton}":"[data-photo-next-button]","{prevButton}":"[data-photo-prev-button]"}},function(b){return{init:function(){b.setDirection(window.esPhotosNavigationLastDirection)},disabled:!1,disable:function(){b.disabled=!0},enable:function(){b.disabled=!1},setDirection:function(a){b.navButton().removeClass("active");(window.esPhotosNavigationLastDirection=b.currentDirection=a)&&b[a+"Button"]().addClass("active")},"{window} mousemove":function(a,c){if(!(b.disabled||(b.setDirection(null),1>e(c.target).parents().filter(b.photo.content.selector).length))){var f=
b.photo.content().intersectsWith(c.pageY,c.pageX);f&&b.setDirection(f.subject.left<f.reference.right-f.reference.width/2?"prev":"next")}},"{self} tagEnter":function(){b.disable()},"{self} tagLeave":function(){b.enable()},"{self} click":function(a,c){if(!(b.disabled||1>e(c.target).parents().filter(b.photo.content.selector).length)){var f=b.currentDirection;f&&b.trigger("photo"+e.String.capitalize(f),[b.photo])}},"{self} photoNext":function(){},"{self} photoPrev":function(){}}});this.resolve(d)});EasySocial.module("privacy",
function(e){var d=this;EasySocial.require().library("dialog").view("admin/profiles/form.privacy.custom.item").done(function(b){EasySocial.Controller("Profiles.Form.Privacy",{defaultOptions:{path:"admin","{selection}":".privacySelection","{browseButton}":".browseButton","{userDeleteButton}":".userDeleteButton","{customContainer}":".customContainer",view:{customItem:"admin/profiles/form.privacy.custom.item"}}},function(a){return{init:function(){},"{selection} change":function(c,f){var d=b(c).val();
b(c).attr("name");"custom"==d?a.customContainer().show():a.customContainer().hide()},"{userDeleteButton} click":function(a,f){b(a).parents("li").remove()},"{browseButton} click":function(c,f){var d=b(c).attr("id"),e=b(c).data("index"),h=b.rootPath+"administrator/index.php?option=com_easysocial&view=users&layout=listing&show=iframe";"site"==a.options.path&&(h=b.rootPath+"index.php?option=com_easysocial&view=friends&layout=listing&show=iframe");b.dialog({title:"Browse Users & Groups",content:h,body:{css:{width:400,
height:300}},buttons:[{name:"Assign",click:function(){var c=b(".foundryDialog").find("iframe").contents().find("input:checked");if(0<c.length)for(var f=0;f<c.length;f++)if("toggle"!=b(c[f]).attr("name")){var h=b(c[f]).val(),r=b(".foundryDialog").find("iframe").contents().find('input[name="user_'+h+'"]').val(),n=b("ul#privacy_ul"+e+" input:hidden"),u=!0;if(0<n.length)for(var t=0;t<n.length;t++)if(b(n[t]).val()==h){u=!1;break}u&&(html=a.view.customItem({userName:r,eleName:d,userId:h}),b("ul#privacy_ul"+
e).append(html))}b.dialog().close()}},{name:"Close",click:function(){b.dialog().close()}}]})}}});d.resolve()})});EasySocial.module("sharing",function(e){var d=this;EasySocial.require().library("textboxlist").done(function(){EasySocial.Controller("Sharing",{defaultOptions:{"{vendors}":"[data-sharing-vendor]","{emailForm}":"[data-sharing-email]"}},function(b){return{init:function(){b.initLinks();b.initEmail()},initLinks:function(){e.each(b.vendors(),function(a,b){b=e(b);if(!b.data("loaded")){var f=
b.attr("href");b.data("href",f);b.attr("href","javascript:void(0);");b.attr("loaded",!0)}})},initEmail:function(){e.each(b.emailForm(),function(a,c){c=e(c);c.data("loaded")||(b.addPlugin("email"),c.attr("loaded",!0))})},"{vendors} click":function(a,b){var f=a.data("options")||"";window.open(a.data("href"),"",f)}}});e.template("sharing/recipientContent",'[%= title %]<input type="hidden" name="items" value="[%= title %]" />');EasySocial.Controller("Sharing.Email",{defaultOptions:{token:"","{container}":"[data-sharing-email]",
"{frames}":"[data-sharing-email-frame]","{recipients}":"[data-sharing-email-recipients]","{input}":"[data-sharing-email-input]","{content}":"[data-sharing-email-content]","{send}":"[data-sharing-email-send]","{frames}":"[data-sharing-email-frame]","{frameForm}":"[data-sharing-email-form]","{frameSending}":"[data-sharing-email-sending]","{frameDone}":"[data-sharing-email-done]","{frameFail}":"[data-sharing-email-fail]","{failMsg}":"[data-sharing-email-fail-msg]"}},function(b){return{init:function(){b.options.token=
b.container().data("token");b.recipients().textboxlist({view:{itemContent:"sharing/recipientContent"}});b.originalPosition=b.container().css("position")},getRecipients:function(){var a=b.recipients().controller("textboxlist").getAddedItems(),c=[];e.each(a,function(a,b){c.push(b.title)});a=b.input().val();1>c.length&&!e.isEmpty(a)&&c.push(a);return c},getContent:function(){return b.content().val()},"{send} click":function(a,c){if(a.enabled()){a.disabled(!0);b.frames().hide();b.frameSending().show();
var f=b.options.token,d=b.getRecipients(),e=b.getContent();b.submitForm(f,d,e).done(function(){b.frames().hide();b.frameDone().show();setTimeout(function(){b.recipients().controller("textboxlist").clearItems();b.content().val("");b.frameDone().hide();b.frameForm().show()},1E3)}).fail(function(a){b.frames().hide();b.frameFail().show();b.frameForm().show();void 0!==a&&b.failMsg().html(a)}).always(function(){a.enabled(!0)})}},"{input} keypress":function(a,c){if(44===c.which)return b.recipients().controller("textboxlist").addItem(a.val()),
a.val(""),!1},submitForm:function(a,b,f){return EasySocial.ajax("site/controllers/sharing/send",{token:a,recipients:b,content:f})}}});d.resolve()})});EasySocial.module("site/activities/activities",function(e){var d=this;EasySocial.require().script("site/activities/sidebar","site/activities/sidebar.item").view("site/loading/small").done(function(b){EasySocial.Controller("Activities",{defaultOptions:{items:null,"{container}":"[data-activities]","{contentTitle}":"[data-activities-content-title]","{content}":"[data-activities-content]",
"{sidebar}":"[data-activities-sidebar]","{sidebarItem}":"[data-sidebar-item]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.sidebar().implement(EasySocial.Controller.Activities.Sidebar,{"{parent}":a});a.sidebarItem().implement(EasySocial.Controller.Activities.Sidebar.Item,{"{parent}":a})},updatingContents:function(){a.content().html(a.view.loadingContent())},updateContent:function(b,f){a.content().html(b);a.contentTitle().html(f)}}});d.resolve()})});EasySocial.module("site/activities/sidebar",
function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Activities.Sidebar",{defaultOptions:{"{menuItem}":"[data-sidebar-menu]"}},function(a){return{init:function(){},"{menuItem} click":function(c,f){a.menuItem().removeClass("active");b(c).addClass("active")}}});d.resolve()})});EasySocial.module("site/activities/sidebar.item",function(e){var d=this;EasySocial.require().library("history").done(function(b){EasySocial.Controller("Activities.Sidebar.Item",{defaultOptions:{}},
function(a){return{init:function(){},"{self} click":function(b,f){var d=a.element.data("type"),e=a.element.data("url"),h=a.element.data("title");a.element.data("description");History.pushState({state:1},h,e);a.parent.updatingContents();EasySocial.ajax("site/controllers/activities/getActivities",{type:d}).done(function(b){a.parent.updateContent(b,h)}).fail(function(a){console.log(a)});a.parent.updateContent()}}});d.resolve()})});EasySocial.module("site/activities/apps",function(e){var d=this;EasySocial.require().view("site/loading/small").language("COM_EASYSOCIAL_ACTIVITY_APPS_UNHIDE_SUCCESSFULLY").done(function(b){EasySocial.Controller("Activities.Apps.List",
{defaultOptions:{"{item}":"[data-hidden-app-item]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Activities.Apps.Item)}}});EasySocial.Controller("Activities.Apps.Item",{defaultOptions:{id:"",context:"","{unhideLink}":"[data-hidden-app-unhide]","{content}":"[data-hidden-app-content]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.options.id=a.element.data("id");a.options.context=a.element.data("context")},
"{unhideLink} click":function(){EasySocial.ajax("site/controllers/activities/unhideapp",{context:a.options.context,id:a.options.id}).done(function(){a.content().html(b.language("COM_EASYSOCIAL_ACTIVITY_APPS_UNHIDE_SUCCESSFULLY"))}).fail(function(a){console.log(a)})}}});d.resolve()})});EasySocial.module("site/activities/item",function(e){var d=this;EasySocial.require().script().done(function(b){EasySocial.Controller("Activities.Item",{defaultOptions:{"{toggle}":"[data-activity-toggle]","{deleteBtn}":"[data-activity-delete]"}},
function(a){return{init:function(){},"{toggle} click":function(c,f){EasySocial.ajax("site/controllers/activities/toggle",{id:a.element.data("id"),curState:a.element.data("current-state")}).done(function(f,d){b(c).text(f);a.element.data("current-state",d);d?a.element.children("div.es-stream").addClass("isHidden"):a.element.children("div.es-stream").removeClass("isHidden")}).fail(function(a){console.log(a)})},"{deleteBtn} click":function(){var b=a.element.data("id");EasySocial.dialog({content:EasySocial.ajax("site/views/activities/confirmDelete"),
bindings:{"{deleteButton} click":function(){EasySocial.ajax("site/controllers/activities/delete",{id:b}).done(function(b){a.element.fadeOut();EasySocial.dialog().close()})}}})}}});d.resolve()})});EasySocial.module("site/activities/list",function(e){var d=this;EasySocial.require().view("site/loading/small").script("site/activities/item").done(function(b){b.fn.visible=function(a){var c=b(this),f=b(window),d=f.scrollTop(),f=d+f.height(),e=c.offset().top,c=e+c.height();return(!0===a?e:c)<=f&&(!0===a?
c:e)>=d};EasySocial.Controller("Activities.List",{defaultOptions:{"{item}":"[data-activity-item]","{pagination}":"[data-activity-pagination]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Activities.Item);a.on("scroll.activities",window,b._.debounce(function(){a.loading||a.pagination().visible()&&a.loadMore()},250))},loadMore:function(){var c=b("[data-sidebar-menu].active").data("type"),f=a.pagination().data("startlimit");
""!=f&&(a.loading=!0,EasySocial.ajax("site/controllers/activities/getActivities",{limitstart:f,loadmore:"1",type:c},{beforeSend:function(){a.pagination().html(a.view.loadingContent())}}).done(function(b,c){a.pagination().data("startlimit",c);a.pagination().before(b);a.item().implement(EasySocial.Controller.Activities.Item)}).fail(function(a){return a}).always(function(){a.loading=!1;a.pagination().html("")}))}}});d.resolve()})});EasySocial.module("site/apps/apps",function(e){var d=this;EasySocial.require().library("history").view("site/loading/small").done(function(b){EasySocial.Controller("Apps",
{defaultOptions:{requireTerms:!0,"{content}":"[data-apps-listing]","{sort}":"[data-apps-sort]","{filter}":"[data-apps-filter]","{item}":"[data-apps-item]","{sorting}":"[data-apps-sorting]","{title}":"[data-page-apps-title]",view:{loading:"site/loading/small"}}},function(a){return{init:function(){a.initAppItem()},initAppItem:function(){a.item().implement(EasySocial.Controller.Apps.Item,{requireTerms:a.options.requireTerms})},"{filter} click":function(c,f){a.sort().removeClass("active");a.filter().removeClass("active");
b(c).addClass("active");var d=b(c).data("apps-filter-type"),e=b(c).data("apps-filter-url"),h=b(c).data("apps-title");a.title().html(h);a.options.filter=d;History.pushState({state:1},"",e);"mine"==d?a.sorting().hide():a.sorting().show();EasySocial.ajax("site/controllers/apps/getApps",{filter:d},{beforeSend:function(){a.sort(".alphabetical").addClass("active");a.content().html(a.view.loading())}}).done(function(b){a.content().html(b);a.initAppItem()})},"{sort} click":function(c,f){var d=b(c).data("apps-sort-type"),
e=b(c).data("apps-sort-url");History.pushState({state:1},"",e);a.sort().removeClass("active");b(c).addClass("active");EasySocial.ajax("site/controllers/apps/getApps",{sort:d,filter:a.options.filter},{beforeSend:function(){a.content().html(a.view.loading())}}).done(function(b){a.content().html(b);a.initAppItem()})}}});EasySocial.Controller("Apps.Item",{defaultOptions:{id:null,requireTerms:!0,"{install}":"[data-apps-item-install]","{installed}":"[data-apps-item-installed]","{settings}":"[data-apps-item-settings]",
view:{installAppForm:"site/apps/dialog.install",uninstallAppForm:"site/apps/dialog.uninstall"}}},function(a){return{init:function(){a.element.data("id")&&(a.options.id=a.element.data("id"))},"{install} click":function(b){EasySocial.dialog({content:EasySocial.ajax("site/views/apps/getTnc"),bindings:{"{cancelButton} click":function(){EasySocial.dialog().close()},"{installButton} click":function(){!a.options.requireTerms||this.agreeCheckbox().is(":checked")?(this.termsError().hide(),a.installApp()):
this.termsError().show()}}})},installApp:function(){var b=EasySocial.ajax("site/controllers/apps/installApp",{id:a.options.id});EasySocial.dialog({content:b,bindings:{"{closeButton} click":function(){EasySocial.dialog().close()}}});b.done(function(){a.install().enabled(!0);a.install().hide();a.installed().show();a.settings().hide()})},"{settings} click":function(b,f){EasySocial.dialog({content:EasySocial.ajax("site/views/apps/settings",{id:a.options.id}),bindings:{}})},"{installed} click":function(b){b.enabled()&&
(b.disabled(!0),EasySocial.dialog({content:EasySocial.ajax("site/views/apps/confirmUninstall"),bindings:{"{parent.closeButton} click":function(){a.installed().enabled(!0)},"{cancelButton} click":function(){a.installed().enabled(!0);EasySocial.dialog().close()},"{uninstallButton} click":function(){a.uninstallApp()}}}))},uninstallApp:function(){var b=EasySocial.ajax("site/controllers/apps/uninstallApp",{id:a.options.id});EasySocial.dialog({content:b,bindings:{"{closeButton} click":function(){EasySocial.dialog().close()}}});
b.done(function(){a.installed().enabled(!0);a.installed().hide();a.settings().hide();a.install().show()})}}});d.resolve()})});EasySocial.module("site/badges/badge",function(e){EasySocial.Controller("Badges.Badge",{defaultOptions:{id:0,total:0,"{achieversList}":"[data-badge-achievers-list]","{achiever}":"[data-badge-achievers-achiever]","{loadIndicator}":"[data-badge-achievers-loading]","{loadButton}":"[data-badge-achievers-load]"}},function(d){return{init:function(){d.options.id=d.element.data("id");
d.options.total=d.element.data("total-achievers")},"{loadButton} click":function(b){var a=d.achiever().length;b.enabled()&&a<d.options.total&&(b.disabled(!0),b.hide(),d.loadIndicator().show(),EasySocial.ajax("site/controllers/badges/loadAchievers",{id:d.options.id,start:a}).done(function(a){d.achieversList().append(a);b.enabled(!0);d.loadIndicator().hide();d.achiever().length<d.options.total&&b.show()}).fail(function(a){}))},loadAchievers:function(){}}});this.resolve()});EasySocial.module("site/comments/control",
function(e){var d=this;EasySocial.Controller("CommentsControl",{defaultOptions:{interval:30}},function(b){return{init:function(){b.startUpdate()},$Blocks:{},startUpdate:function(){b.options.monitoring=!0;b.updateBlocks()},stopUpdate:function(){b.options.monitoring=!1},updateBlocks:function(){(b.updateBlocks=e._.debounce(function(){var a=b.populate();if(!b.options.monitoring)return!1;EasySocial.ajax("site/controllers/comments/getUpdates",{data:a}).done(function(a){e.each(a,function(a,c){e.each(c,function(c,
d){var g=b.$Blocks[a][c];g._destroyed||g.updateComment(d)})})}).always(function(){b.updateBlocks()})},1E3*b.options.interval))()},register:function(a){var c=a.options.uid,f=a.options.element+"."+a.options.group;void 0===b.$Blocks[f]&&(b.$Blocks[f]={});b.$Blocks[f][c]=a;a.trigger("commentBlockRegistered")},populate:function(){var a={};e.each(b.$Blocks,function(b,f){a[b]={};e.each(f,function(f,d){a[b][f]=d._export()})});return a}}});EasySocial.ready(function(){EasySocial.Comments=e("body").addController("EasySocial.Controller.CommentsControl");
d.resolve()})});EasySocial.module("site/comments/frame",function(e){var d=this;EasySocial.require().library("expanding").script("site/comments/item").language("COM_EASYSOCIAL_COMMENTS_LOADED_OF_TOTAL","COM_EASYSOCIAL_COMMENTS_STATUS_SAVING","COM_EASYSOCIAL_COMMENTS_STATUS_SAVED").done(function(){EasySocial.Controller("Comments",{defaultOptions:{group:"user",element:"stream",uid:0,url:"","{actionContent}":"[data-action-contents-comments]","{actionLink}":"[data-stream-action-comments]","{stat}":"[data-comments-stat]",
"{load}":"[data-comments-load]","{list}":"[data-comments-list]","{item}":"[data-comments-item]","{form}":"[data-comments-form]"}},function(b){return{init:function(){b.options.uid=b.element.data("uid")||b.options.uid;b.options.element=b.element.data("element")||b.options.element;b.options.group=b.element.data("group")||b.options.group;b.options.url=b.element.data("url")||b.options.url;b.$Stat=b.addPlugin("stat");b.$Load=b.addPlugin("load");b.$List=b.addPlugin("list");b.$Form=b.addPlugin("form");EasySocial.require().script("site/comments/control").done(function(){EasySocial.Comments.register(b)});
b.trigger("commentInit",[b])},$Comments:{},registerComment:function(a){b.$Comments[a.options.id]=a},"{actionLink} click":function(){b.actionContent().toggle()},_export:function(){return{total:b.$Stat.total(),count:b.$Stat.count(),ids:e._.keys(b.$Comments)}},updateComment:function(a){var c=[];e.each(a.ids,function(a,d){if(!0!==d)if(!1===d)b.trigger("commentDeleted",[a]);else{var k=!1;e.each(b.$Comments,function(c,e){if(c>a)return b.$List.addToList(d,c,!1),k=!0,!1});k||b.$List.addToList(d,"append",
!1);c.push(d)}});b.$Stat.total(a.total);b.trigger("oldCommentsLoaded",[c])}}});EasySocial.Controller("Comments.List",{defaultOptions:{"{list}":"[data-comments-list]","{item}":"[data-comments-item]"}},function(b){return{init:function(){b.initItemController(b.item(),!1)},initItemController:function(a,c){a.addController("EasySocial.Controller.Comments.Item",{controller:{parent:b.parent},isNew:c});return a},"{parent} newCommentSaved":function(a,c,f){b.addToList(f)},addToList:function(a,c,f){c=void 0===
c?"append":c;f=void 0===f?!0:f;a=e(a);b.initItemController(a,f);if("append"==c||"prepend"==c)if(f="append"==c?":last":":first",c="append"==c?"after":"before",0===b.item().length)b.list().html(a);else b.item(f)[c](a);else c=b.parent.$Comments[c],void 0!==c&&c.element.before(a);b.parent.actionContent().show()},"{parent} commentDeleted":function(a,c,f){void 0!==b.parent.$Comments[f]&&(b.parent.$Comments[f].element.remove(),delete b.parent.$Comments[f])}}});EasySocial.Controller("Comments.Stat",{defaultOptions:{"{stats}":"[data-comments-stats]",
count:0,total:0,limit:10}},function(b){return{init:function(){b.options.count=b.element.data("count");b.options.total=b.element.data("total")},total:function(a){void 0!==a&&(b.options.total=parseInt(a),b.stats().text(e.language("COM_EASYSOCIAL_COMMENTS_LOADED_OF_TOTAL",b.count(),b.total())));return b.options.total},count:function(a){void 0!==a&&(b.options.count=parseInt(a),b.stats().text(e.language("COM_EASYSOCIAL_COMMENTS_LOADED_OF_TOTAL",b.count(),b.total())));return b.options.count},getNextCycle:function(){var a=
Math.max(b.total()-b.count()-b.options.limit,0),c=b.total()-b.count()-a;return{start:a,limit:c}},"{parent} oldCommentsLoaded":function(a,c,f){a=f.length;b.count(b.count()+a)},"{parent} newCommentSaved":function(){b.total(b.total()+1);b.count(b.count()+1)},"{parent} commentDeleted":function(){b.total(b.total()-1);b.count(b.count()-1)}}});EasySocial.Controller("Comments.Load",{defaultOptions:{"{load}":"[data-comments-load]","{loadMore}":"[data-comments-load-loadMore]"}},function(b){return{init:function(){},
"{loadMore} click":function(a,c){if(a.enabled()){a.disabled(!0);var f=b.parent.$Stat.getNextCycle();if(0==f.limit)return!1;b.loadComments(f.start,f.limit).done(function(c){var d=c.slice().reverse();e.each(d,function(a,c){b.parent.$List.addToList(c,"prepend",!1)});b.parent.trigger("oldCommentsLoaded",[c]);a.enabled(!0);0==f.start&&b.load().hide()}).fail(function(a){b.parent.trigger("oldCommentsLoadError",[a])})}},loadComments:function(a,c){return EasySocial.ajax("site/controllers/comments/load",{uid:b.parent.options.uid,
element:b.parent.options.element,group:b.parent.options.group,start:a,length:c||10})}}});EasySocial.Controller("Comments.Form",{defaultOptions:{"{input}":"[data-comments-form-input]","{submit}":"[data-comments-form-submit]","{status}":"[data-comments-form-status]"}},function(b){return{init:function(){var a=b.input();a.one("click",function(){a.expandingTextarea()})},"{input} keypress":function(a,c){13!=c.keyCode||c.shiftKey||c.altKey||c.ctrlKey||c.metaKey||b.submitComment()},"{submit} click":function(a,
c){a.enabled()&&b.submitComment()},submitComment:function(){var a=b.input().val();if(""==e.trim(a))return!1;b.parent.trigger("newCommentSaving");b.save().done(function(a){b.parent.trigger("newCommentSaved",[a]);b.submit().enabled(!0)}).fail(function(a){b.parent.trigger("newCommentSaveError",[a.message])})},save:function(){var a={url:b.parent.options.url};return EasySocial.ajax("site/controllers/comments/save",{uid:b.parent.options.uid,element:b.parent.options.element,group:b.parent.options.group,
input:b.input().val(),data:a})},disableForm:function(){b.input().attr("disabled",!0);b.submit().disabled(!0)},enableForm:function(){b.input().removeAttr("disabled");b.submit().enabled(!0)},"{parent} newCommentSaving":function(){b.status().show();b.status().removeClass("label-important label-success label-info");b.status().addClass("label-info");b.status().text(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_SAVING"));b.disableForm()},"{parent} newCommentSaved":function(){b.status().show();b.status().text(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_SAVED"));
b.status().removeClass("label-important label-success label-info");b.status().addClass("label-success");setTimeout(function(){b.status().fadeOut("fast")},2E3);b.enableForm();b.input().val("");b.input().expandingTextarea("resize")},"{parent} newCommentSaveError":function(a,c,f){b.status().show();b.status().removeClass("label-important label-success label-info");b.status().addClass("label-important");b.status().text(f);b.enableForm()}}});d.resolve()})});EasySocial.module("site/comments/item",function(e){var d=
this;EasySocial.require().language("COM_EASYSOCIAL_COMMENTS_STATUS_SAVE_ERROR","COM_EASYSOCIAL_COMMENTS_STATUS_LOADING","COM_EASYSOCIAL_COMMENTS_STATUS_LOAD_ERROR","COM_EASYSOCIAL_COMMENTS_STATUS_DELETING","COM_EASYSOCIAL_COMMENTS_STATUS_DELETE_ERROR","COM_EASYSOCIAL_LIKES_LIKE","COM_EASYSOCIAL_LIKES_UNLIKE").done(function(){EasySocial.Controller("Comments.Item",{defaultOptions:{id:0,isNew:!1,"{frame}":"[data-comments-item-frame]","{avatar}":"[data-comments-item-avatar]","{commentFrame}":"[data-comments-item-commentFrame]",
"{author}":"[data-comments-item-author]","{action}":"[data-comments-item-actions]","{edit}":"[data-comments-item-actions-edit]","{delete}":"[data-comments-item-actions-delete]","{spam}":"[data-comments-item-actions-spam]","{comment}":"[data-comments-item-comment]","{meta}":"[data-comments-item-meta]","{date}":"[data-comments-item-date] a","{like}":"[data-comments-item-like]","{likeCount}":"[data-comments-item-likeCount]","{editFrame}":"[data-comments-item-editFrame]","{editInput}":"[data-comments-item-edit-input]",
"{editSubmit}":"[data-comments-item-edit-submit]","{editStatus}":"[data-comments-item-edit-status]","{statusFrame}":"[data-comments-item-statusFrame]"}},function(b){return{init:function(){b.options.id=b.element.data("id");b.parent.registerComment(b);b.status=b.element.addController("EasySocial.Controller.Comments.Item.Status",{controller:{parent:b.parent,item:b}})},"{like} click":function(a){a.enabled()&&(a.disabled(!0),b.likeComment().done(function(c,f,d){a.enabled(!0);b.likeCount().text(f);d=e("<div></div>").html(d).text();
b.likeCount().attr("data-original-title",d);b.like().find("a").text(e.language(c?"COM_EASYSOCIAL_LIKES_UNLIKE":"COM_EASYSOCIAL_LIKES_LIKE"))}).fail(function(){}))},likeComment:function(){return EasySocial.ajax("site/controllers/comments/like",{id:b.options.id})},"{likeCount} click":function(){EasySocial.dialog({content:b.getLikedUsers()})},getLikedUsers:function(){return EasySocial.ajax("site/controllers/comments/likedUsers",{id:b.options.id})},"{edit} click":function(a){a.enabled()&&(a.disabled(!0),
b.trigger("commentEditLoading",[b.options.id]),b.getRawComment().done(function(a){b.trigger("commentEditLoaded",[b.options.id],a);b.editInput().val(a);b.editInput().focus();b.editInput().expandingTextarea()}).fail(function(a){b.trigger("commentEditLoadError",[b.options.id,a])}))},getRawComment:function(){return EasySocial.ajax("site/controllers/comments/getRawComment",{id:b.options.id})},"{editInput} keyup":function(a,c){if(13==c.which||27==c.which){switch(c.which){case 13:c.shiftKey||c.ctrlKey||
c.altKey||c.metaKey||b.submitEdit();break;case 27:b.trigger("commentEditCancel",[b.options.id])}b.edit().enabled(!0)}},"{editSubmit} click":function(){b.submitEdit()},submitEdit:function(){var a=e.trim(b.editInput().val());if(""==a)return!1;b.trigger("commentEditSaving",[b.options.id,a]);b.saveEdit(a).done(function(a){b.trigger("commentEditSaved",[b.options.id,a]);b.comment().html(a);b.edit().enabled(!0)}).fail(function(a){b.trigger("commentEditSaveError",[b.options.id,a])})},saveEdit:function(a){return EasySocial.ajax("site/controllers/comments/update",
{id:b.options.id,input:a})},"{delete} click":function(a){a.enabled()&&(a.disabled(!0),b.frame().hide(),b.commentFrame().show(),b.element.clone(),EasySocial.dialog({content:EasySocial.ajax("site/views/comments/confirmDelete",{id:b.options.id}),selectors:{"{deleteButton}":"[data-delete-button]","{cancelButton}":"[data-cancel-button]"},bindings:{"{deleteButton} click":function(){EasySocial.dialog().close();b.parent.trigger("commentDeleting",[b.options.id]);b.trigger("commentDeleting");b.deleteComment().done(function(){b.parent.trigger("commentDeleted",
[b.options.id]);a.enabled(!0)}).fail(function(a){b.parent.trigger("commentDeleteError",[b.options.id,a]);b.trigger("commentDeleteError",[b.options.id,a])})},"{cancelButton} click":function(){EasySocial.dialog().close();a.enabled(!0)}}}))},deleteComment:function(){return EasySocial.ajax("site/controllers/comments/delete",{id:b.options.id})}}});EasySocial.Controller("Comments.Item.Status",{defaultOptions:{"{frame}":"[data-comments-item-frame]","{statusFrame}":"[data-comments-item-statusFrame] div",
"{commentFrame}":"[data-comments-item-commentFrame]","{editFrame}":"[data-comments-item-editFrame]"}},function(b){return{init:function(){},setStatus:function(a){b.frame().hide();b.statusFrame().html(a);b.statusFrame().show()},"{self} commentEditLoading":function(){b.setStatus(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_LOADING"))},"{self} commentEditLoaded":function(){b.frame().hide();b.editFrame().show()},"{self} commentEditLoadError":function(){b.setStatus(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_LOAD_ERROR"))},
"{self} commentEditCancel":function(){b.frame().hide();b.commentFrame().show()},"{self} commentEditSaving":function(){b.setStatus(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_SAVING"))},"{self} commentEditSaved":function(){b.frame().hide();b.commentFrame().show()},"{self} commentEditSaveError":function(){b.setStatus(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_SAVE_ERROR"))},"{self} commentDeleting":function(){b.setStatus(e.language("COM_EASYSOCIAL_COMMENTS_STATUS_DELETING"))},"{self} commentDeleteError":function(a,
c,f,d){d=d||e.language("COM_EASYSOCIAL_COMMENTS_STATUS_DELETE_ERROR");b.setStatus(d)}}});d.resolve()})});EasySocial.module("site/conversations/api",function(e){var d=this;EasySocial.require().library("dialog").done(function(){e(document).on("click.es.conversations.compose","[data-es-conversations-compose]",function(){var b=e(this),a=b.data("es-conversations-id"),c=b.data("es-conversations-listid");EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/composer",{id:a,listId:c}),bindings:{"{sendButton} click":function(){var b=
e("input[name=recipient\\[\\]]"),d=e("[data-composer-message]").val(),k=[];e(b).each(function(){k.push(e(this).val())});EasySocial.ajax("site/controllers/conversations/store",{uid:k,message:d}).done(function(b){a&&EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/sent",{id:a}),bindings:{"{viewButton} click":function(){document.location=b}}});c&&EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/sentList",{id:c}),bindings:{"{viewButton} click":function(){document.location=
b}}})}).fail(function(a){self.setMessage(a)})}}})});d.resolve()})});EasySocial.module("site/conversations/conversations",function(e){var d=this;EasySocial.require().script("site/conversations/mailbox","site/conversations/item","site/conversations/filter").language("COM_EASYSOCIAL_NO_BUTTON").done(function(b){EasySocial.Controller("Conversations",{defaultOptions:{"{mailbox}":"[data-conversations-mailbox]","{list}":"[data-conversations-list]","{content}":"[data-conversations-content]","{item}":"[data-conversations-item]",
"{actions}":"[data-conversations-actions]","{filterItem}":"[data-conversations-filter]","{checkAll}":"[data-conversations-checkAll]","{checkbox}":"[data-conversationItem-checkbox]","{delete}":"[data-conversations-delete]","{archive}":"[data-conversations-archive]","{unarchive}":"[data-conversations-unarchive]","{unread}":"[data-conversations-unread]","{read}":"[data-conversations-read]"}},function(a){return{init:function(){a.mailbox().implement(EasySocial.Controller.Conversations.Mailbox,{"{parent}":a});
a.item().implement(EasySocial.Controller.Conversations.Item,{"{parent}":a});a.filterItem().implement(EasySocial.Controller.Conversations.Filter,{"{parent}":a})},"{filterItem} click":function(c){a.filterItem().removeClass("active");b(c).addClass("active")},"{checkbox} change":function(b){if(0>=a.checkbox(":checked").length&&!b.is(":checked"))return a.actions().removeClass("is-checked");a.actions().addClass("is-checked")},"{checkAll} click":function(c){if(0>=a.checkbox().length)return b(c).prop("checked",
!1),!1;c.is(":checked")?a.checkbox(":not(:checked)").click():a.checkbox(":checked").click()},showEmpty:function(){a.content().addClass("is-empty")},hideEmpty:function(){a.content().removeClass("is-empty")},toggleLoading:function(){a.content().removeClass("is-empty").toggleClass("is-loading")},updateContent:function(b,f){void 0!=f?a.content().addClass("layout-"+f):a.content().removeClass("layout-archives");a.actions().removeClass("is-checked");a.checkAll().removeAttr("checked");a.list().html(b)},getSelectedConversations:function(){if(0>=
a.checkbox(":checked").length)return!1;var c=[];a.checkbox(":checked").each(function(a,d){c.push(b(d).val())});return c},"{archive} click":function(){var c=a.getSelectedConversations();EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmArchive",{ids:c}),bindings:{"{confirmButton} click":function(){b("[data-conversation-archive-form]").submit()}}})},"{unarchive} click":function(){var c=a.getSelectedConversations();EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmUnarchive",
{ids:c}),bindings:{"{confirmButton} click":function(){b("[data-conversation-archive-form]").submit()}}})},"{delete} click":function(){var c=a.getSelectedConversations();EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmDelete",{ids:c}),bindings:{"{deleteButton} click":function(){b("[data-conversation-delete-form]").submit()}}})},"{read} click":function(){if(0>=a.checkbox(":checked").length)return!1;var c=[];a.checkbox(":checked").each(function(a,d){c.push(b(d).val())});EasySocial.ajax("site/controllers/conversations/markRead",
{ids:c}).done(function(){a.checkbox().parents("[data-conversations-item]").removeClass("unread").addClass("read");a.mailbox().controller().updateCounters()}).fail(function(b){a.setMessage(b)})},"{unread} click":function(){if(0>=a.checkbox(":checked").length)return!1;var c=[];a.checkbox(":checked").each(function(a,d){c.push(b(d).val())});EasySocial.ajax("site/controllers/conversations/markUnread",{ids:c}).done(function(){a.checkbox().parents("[data-conversations-item]").removeClass("read").addClass("unread");
a.mailbox().controller().updateCounters()}).fail(function(a){console.log(a)})}}});d.resolve()})});EasySocial.module("site/conversations/mailbox",function(e){var d=this;EasySocial.require().library("history").done(function(b){EasySocial.Controller("Conversations.Mailbox",{defaultOptions:{"{item}":"[data-mailboxItem]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Conversations.Mailbox.Item,{"{parent}":a})},updateCounters:function(){a.item(".active").controller().updateCounter()},
updateContent:function(b,f){a.parent.updateContent(b,f)},showEmpty:function(){a.parent.showEmpty()},hideEmpty:function(){a.parent.hideEmpty()},toggleLoading:function(){a.parent.toggleLoading()}}});EasySocial.Controller("Conversations.Mailbox.Item",{defaultOptions:{"{counter}":"[data-mailboxItem-counter]",view:{emptyTemplate:"site/conversations/default.item.empty"}}},function(a){return{init:function(){},updateCounter:function(){EasySocial.ajax("site/controllers/conversations/getCount",{mailbox:a.element.data("mailbox")}).done(function(b){0>=
b?a.counter().html(""):a.counter().html("("+b+")")})},toggleLoading:function(){a.element.toggleClass("loading")},"{self} click":function(){var b=a.element.data("url"),f=a.element.data("title"),d=a.element.data("mailbox");a.parent.item().removeClass("active");a.element.addClass("active");History.pushState({state:1},f,b);EasySocial.ajax("site/views/conversations/getItems",{mailbox:d,limitstart:0},{beforeSend:function(){a.toggleLoading();a.parent.toggleLoading()}}).done(function(b,c){a.toggleLoading();
a.parent.toggleLoading();if(0>=b.length)return a.parent.updateContent(""),a.parent.showEmpty();a.parent.hideEmpty();a.parent.updateContent(b,a.element.data("mailbox"))})}}});d.resolve()})});EasySocial.module("site/conversations/item",function(e){var d=this;EasySocial.require().script("site/conversations/mailbox").done(function(b){EasySocial.Controller("Conversations.Item",{defaultOptions:{"{checkbox}":"[data-conversationItem-checkbox]"}},function(a){return{init:function(){},"{checkbox} change":function(c){return b(c).is(":checked")?
a.element.addClass("selected"):a.element.removeClass("selected")}}});d.resolve()})});EasySocial.module("site/conversations/filter",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Conversations.Filter",{defaultOptions:{}},function(a){return{init:function(){},"{self} click":function(){var c=a.element.data("filter");a.parent.item("."+c);if(1==b("[data-mailboxitem]").filter(".active").length){var f=b("[data-mailboxitem]").filter(".active"),d=f.data("url"),e=f.data("title"),
h=f.data("mailbox");History.pushState({state:1},e,d);EasySocial.ajax("site/views/conversations/getItems",{mailbox:h,filter:c,limitstart:0},{beforeSend:function(){a.parent.toggleLoading()}}).done(function(b,c){a.parent.toggleLoading();if(0>=b.length)return a.parent.updateContent(""),a.parent.showEmpty();a.parent.hideEmpty();a.parent.updateContent(b,h)})}}}});d.resolve()})});EasySocial.module("site/conversations/read",function(e){var d=this;EasySocial.require().library("dialog").script("site/conversations/composer",
"site/friends/suggest").language("COM_EASYSOCIAL_CONVERSATION_REPLY_POSTED_SUCCESSFULLY","COM_EASYSOCIAL_CONVERSATION_REPLY_FORM_EMPTY").done(function(b){EasySocial.Controller("Conversations.Read",{defaultOptions:{id:"",attachments:!0,location:!1,maxSize:"3mb",extensionsAllowed:"",attachmentController:null,composerController:null,"{item}":"[data-readConversation-item]","{items}":"[data-readConversation-items]","{composer}":"[data-readConversation-composer]","{replyButton}":"[data-readConversation-replyButton]",
"{addParticipant}":"[data-readConversation-addParticipant]","{leaveConversation}":"[data-readConversation-leaveConversation]","{delete}":"[data-readConversation-delete]","{attachments}":"[data-uploaderQueue-id]","{replyNotice}":"[data-readConversation-replyNotice]","{readLoadMore}":"[data-readconversation-load-more]",view:{messageItem:"site/conversations/read.message"}}},function(a){return{init:function(){a.composer().implement(EasySocial.Controller.Conversations.Composer,{"{uploader}":"[data-readConversation-attachment]",
"{location}":"[data-readConversation-location]",maxSize:a.options.maxSize,extensionsAllowed:a.options.extensionsAllowed});a.options.composerController=a.composer().controller();a.options.attachments&&(a.options.attachmentController=a.options.composerController.uploader().controller());a.options.location&&(a.options.locationController=a.options.composerController.location().controller());a.item().implement(EasySocial.Controller.Conversations.Read.Item);a.options.id=a.element.data("id")},resetForm:function(){a.options.composerController.resetForm();
a.options.location&&a.options.locationController.removeLocation();a.options.attachments&&a.options.attachmentController.reset()},"{readLoadMore} click":function(c){var f=b(c).data("id"),d=b(c).data("limitstart");a.readLoadMore().hide();b(".loading-indicator").show();EasySocial.ajax("site/controllers/conversations/loadPrevious",{id:f,limitstart:d}).done(function(f,d){b.buildHTML(f).prependTo(a.items()).addController("EasySocial.Controller.Conversations.Read.Item");0==d?a.readLoadMore().hide():(a.readLoadMore().show(),
b(c).data("limitstart",d))}).always(function(){b(".loading-indicator").hide()})},"{replyButton} click":function(c,f){f.preventDefault();var d=a.options.composerController.editor().val(),e=[];if(0>=d.length)return a.replyNotice().html(b.language("COM_EASYSOCIAL_CONVERSATION_REPLY_FORM_EMPTY")).addClass("alert alert-error").removeClass("alert-success"),!1;a.options.attachments&&a.attachments().each(function(a,c){e.push(b(c).val())});d={id:a.options.id,message:d};a.options.attachments&&(d["upload-id"]=
e);a.options.location&&(d.address=a.options.locationController.locationInput().val(),d.latitude=a.options.locationController.locationLatitude().val(),d.longitude=a.options.locationController.locationLongitude().val());a.replyButton().attr("disabled",!0);EasySocial.ajax("site/controllers/conversations/reply",d).done(function(c){a.replyNotice().html(b.language("COM_EASYSOCIAL_CONVERSATION_REPLY_POSTED_SUCCESSFULLY")).addClass("alert alert-success").removeClass("alert-error");c=b(c);c.implement(EasySocial.Controller.Conversations.Read.Item);
a.items().append(c);a.resetForm()}).always(function(){a.replyButton().attr("disabled",!1)});return!1},"{leaveConversation} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmLeave",{id:a.options.id})})},"{addParticipant} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/addParticipantsForm",{id:a.options.id})})},"{delete} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmDelete",
{ids:[a.options.id]}),bindings:{"{deleteButton} click":function(){b("[data-conversation-delete-form]").submit()}}})},addItem:function(b){a.messageList().append(a.view.messageItem({item:b}));a.textMessage().val("").focus()}}});EasySocial.Controller("Conversations.Read.Item",{defaultOptions:{id:null,"{attachmentsWrapper}":"[data-conversation-attachment-wrapper]","{attachments}":"[data-conversation-attachment]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.attachments().implement(EasySocial.Controller.Conversations.Read.Item.Attachment,
{"{parent}":a})},removeAttachment:function(c,f){b(c).remove();0==a.attachments().length&&a.attachmentsWrapper().hide()}}});EasySocial.Controller("Conversations.Read.Item.Attachment",{defaultOptions:{"{deleteAttachment}":"[data-attachment-delete]"}},function(a){return{init:function(){},"{deleteAttachment} click":function(c,f){var d=b(c).data("id");EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/confirmDeleteAttachment",{id:d}),bindings:{"{deleteButton} click":function(){EasySocial.ajax("site/controllers/conversations/deleteAttachment",
{id:d}).done(function(){a.parent.removeAttachment(a.element);EasySocial.dialog({content:EasySocial.ajax("site/views/conversations/attachmentDeleted",{})})}).fail(function(b){a.setMessage(b)})}}})}}});d.resolve()})});EasySocial.module("site/dashboard/apps",function(e){var d=this;EasySocial.require().library("history").done(function(b){EasySocial.Controller("Dashboard.Apps",{defaultOptions:{parent:null,pageTitle:null,"{item}":"[data-dashboardApps-item]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Dashboard.Apps.Item,
{"{parent}":a,"{dashboard}":a.parent,pageTitle:a.options.pageTitle})}}});EasySocial.Controller("Dashboard.Apps.Item",{defaultOptions:{}},function(a){return{init:function(){},"{self} click":function(c,f){f.preventDefault();var d=a.element.data("layout"),e=a.element.data(d+"-url"),h=a.element.data("title"),l=a.element.data("description"),m=a.element.data("id");"canvas"==d?window.location=e:(h=b._.isEmpty(a.options.pageTitle)?h:a.options.pageTitle,History.pushState({state:1},h,e),a.dashboard.content().html(""),
a.dashboard.updatingContents(),a.element.addClass("loading"),EasySocial.ajax("site/controllers/dashboard/getAppContents",{appId:m}).done(function(b){a.dashboard.updateHeading(h,l);a.dashboard.updateContents(b)}).fail(function(a){return a}).always(function(){a.element.removeClass("loading")}))}}});d.resolve()})});EasySocial.module("site/dashboard/dashboard",function(e){var d=this;EasySocial.require().script("site/dashboard/apps","site/dashboard/feeds","site/dashboard/sidebar","site/stream/filter").done(function(b){EasySocial.Controller("Dashboard",
{defaultOptions:{"{heading}":"[data-dashboard-heading]","{sidebar}":"[data-dashboard-sidebar]","{content}":"[data-dashboard-real-content]","{feeds}":"[data-dashboard-feeds]","{apps}":"[data-dashboard-apps]","{saveHashTag}":"[data-hashtag-filter-save]"}},function(a){return{init:function(){a.sidebar().implement(EasySocial.Controller.Dashboard.Sidebar,{"{parent}":a});a.feedsController=a.feeds().addController(EasySocial.Controller.Dashboard.Feeds,{"{parent}":a});a.apps().implement(EasySocial.Controller.Dashboard.Apps,
{"{parent}":a,pageTitle:a.options.pageTitle})},updateHeading:function(b,f){a.heading().find("[data-heading-title]").html(b);a.heading().find("[data-heading-desc]").html(f)},updatingContents:function(){a.element.addClass("loading")},updateContents:function(b){a.element.removeClass("loading");a.content().html(b)},"{saveHashTag} click":function(c){var f=c.data("tag");EasySocial.dialog({content:EasySocial.ajax("site/views/stream/confirmSaveFilter",{tag:f}),bindings:{"{saveButton} click":function(){this.inputWarning().hide();
filterName=this.inputTitle().val();""==filterName?this.inputWarning().show():EasySocial.ajax("site/controllers/stream/addFilter",{title:filterName,tag:f}).done(function(c,f){var d=b.buildHTML(c);a.feedsController.addFilterItem(d);EasySocial.dialog(f);setTimeout(function(){EasySocial.dialog().close()},2E3)})}}})}}});d.resolve()})});EasySocial.module("site/dashboard/feeds",function(e){var d=this;EasySocial.require().library("history").done(function(b){EasySocial.Controller("Dashboard.Feeds",{defaultOptions:{"{item}":"[data-dashboardFeeds-item]",
"{filter}":"[data-dashboardFeeds-Filter-edit]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Dashboard.Feeds.Item,{"{parent}":a,"{dashboard}":a.parent})},addFilterItem:function(b){b.find("[data-dashboardFeeds-item]").implement(EasySocial.Controller.Dashboard.Feeds.Item,{"{parent}":a,"{dashboard}":a.parent});b.appendTo(a.element)}}});EasySocial.Controller("Dashboard.Feeds.Item",{defaultOptions:{}},function(a){return{init:function(){},"{self} click":function(){b(".es-streams").removeClass("no-stream");
var c=a.element.data("type"),f=a.element.data("id"),d=a.element.data("url"),e=a.element.data("title"),h=a.element.data("description");a.element.removeClass("has-notice");History.pushState({state:1},e,d);a.dashboard.content().html("");a.dashboard.updatingContents();a.element.addClass("loading");EasySocial.ajax("site/controllers/dashboard/getStream",{type:c,id:f,view:"dashboard"}).done(function(c,f){a.dashboard.updateHeading(e,h);0==f&&b(".es-streams").addClass("no-stream");a.dashboard.updateContents(c)}).fail(function(a){return a}).always(function(){a.element.removeClass("loading")})}}});
d.resolve()})});EasySocial.module("site/dashboard/sidebar",function(e){var d=this;EasySocial.require().library("history").done(function(b){EasySocial.Controller("Dashboard.Sidebar",{defaultOptions:{"{menuItem}":"[data-dashboardSidebar-menu]","{filterBtn}":"[data-stream-filter-button]","{editIcon}":"[data-dashboardFeeds-Filter-edit]"}},function(a){return{init:function(){},"{menuItem} click":function(c,f){a.menuItem().removeClass("active");b(c).addClass("active")},"{editIcon} click":function(c,f){f.preventDefault();
b(c).route();var d=c.data("id");a.parent.content().html("");a.parent.updatingContents();EasySocial.ajax("site/controllers/stream/getFilter",{id:d}).done(function(b){a.parent.updateContents(b)}).fail(function(a){return a}).always(function(){})},"{filterBtn} click":function(c,f){f.preventDefault();b(c).route();a.parent.content().html("");a.parent.updatingContents();EasySocial.ajax("site/controllers/stream/getFilter",{id:0}).done(function(b){a.parent.updateContents(b)}).fail(function(a){return a}).always(function(){})}}});
d.resolve()})});EasySocial.module("site/followers/api",function(e){var d=this;EasySocial.require().library("dialog","popbox").done(function(){e(document).on("click.es.followers.follow","[data-es-followers-follow]",function(){var b=e(this),a=b.data("es-followers-id"),c=e.Deferred();b.popbox({content:c,id:"es-wrap",type:"followers",toggle:"click"});b.popbox("show");EasySocial.ajax("site/controllers/profile/follow",{id:a,type:"user"}).done(function(b){EasySocial.ajax("site/views/profile/popboxFollow",
{id:a}).done(function(a){c.resolve(a)})})});e(document).on("click.es.followers.unfollow","[data-es-followers-unfollow]",function(){var b=e(this),a=b.data("es-followers-id"),c=e.Deferred();b.popbox({content:c,id:"es-wrap",type:"followers",toggle:"click"});b.popbox("show");EasySocial.ajax("site/controllers/profile/unfollow",{id:a,type:"user"}).done(function(b){EasySocial.ajax("site/views/profile/popboxUnfollow",{id:a}).done(function(a){c.resolve(a)})})});d.resolve()})});EasySocial.module("site/followers/followers",
function(e){var d=this;EasySocial.require().view("site/loading/small").script("site/conversations/composer").done(function(b){EasySocial.Controller("Followers",{defaultOptions:{"{content}":"[data-followers-content]","{filter}":"[data-followers-filter]","{items}":"[data-followers-item]","{followingCounter}":"[data-following-count]",view:{loader:"site/loading/small"}}},function(a){return{init:function(){a.initItemController()},initItemController:function(){a.items().implement(EasySocial.Controller.Followers.Item,
{"{parent}":a})},updateFollowingCounter:function(b){var f=a.followingCounter().html();b=parseInt(f)+b;a.followingCounter().html(b)},updateContents:function(b){a.content().html(b)},"{filter} click":function(b,f){var d=b.data("followers-filter-type"),e=b.data("followers-filter-title"),h=b.data("followers-filter-id"),l=b.data("followers-filter-url");a.filter().removeClass("active");b.addClass("active");History.pushState({state:1},e,l);EasySocial.ajax("site/controllers/followers/filter",{id:h,type:d}).done(function(b){a.updateContents(b);
a.initItemController()})}}});EasySocial.Controller("Followers.Item",{defaultOptions:{"{unfollowButton}":"[data-followers-item-unfollow]","{composer}":"[data-followers-item-compose]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.initComposer()},initComposer:function(){a.composer().implement(EasySocial.Controller.Conversations.Composer.Dialog,{recipient:{id:a.options.id}})},"{unfollowButton} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/followers/confirmUnfollow",
{id:a.options.id}),bindings:{"{unfollowButton} click":function(){EasySocial.ajax("site/controllers/followers/unfollow",{id:a.options.id}).done(function(){a.parent.updateFollowingCounter(-1);a.element.remove();EasySocial.dialog().close()})}}})}}});d.resolve()})});EasySocial.module("site/friends/api",function(e){var d=this;EasySocial.require().library("dialog","popbox").done(function(){e(document).on("click.es.friends.cancel","[data-es-friends-cancel]",function(){var b=e(this).data("es-friends-id");
EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmCancel"),bindings:{"{confirmButton} click":function(){EasySocial.ajax("site/controllers/friends/cancelRequest",{id:b}).done(function(){EasySocial.dialog().close()})}}})});e(document).on("click.es.friends.add","[data-es-friends-add]",function(){var b=e(this),a=b.data("es-friends-id"),c=e.Deferred();b.popbox({content:c,id:"es-wrap",type:"friends",toggle:"click"});b.popbox("show");EasySocial.ajax("site/controllers/friends/request",
{viewCallback:"popboxRequest",id:a}).done(function(a){c.resolve(a)})});d.resolve()})});EasySocial.module("site/friends/friends",function(e){var d=this;EasySocial.require().script("site/friends/list","site/friends/item","site/friends/suggest","site/conversations/composer").view("site/loading/small","site/friends/default.empty","site/friends/list.assign").done(function(b){EasySocial.Controller("Friends.Birthday",{defaultOptions:{"{messageButton}":"[data-upcoming-birthday-message-button]"}},function(a){return{init:function(){a.options.id=
a.element.data("id");a.options.name=a.element.data("name");a.options.avatar=a.element.data("avatar");a.messageButton().implement(EasySocial.Controller.Conversations.Composer.Dialog,{recipient:{id:a.options.id,name:a.options.name,avatar:a.options.avatar}})}}});EasySocial.Controller("Friends",{defaultOptions:{activeList:null,"{friendList}":"[data-friends-list]","{content}":"[data-friends-content]","{friendItems}":"[data-friends-items]","{friendItem}":"[data-friends-item]","{emptyList}":"[data-friends-emptyItems]",
"{activeTitle}":"[data-friends-activeTitle]","{filterItem}":"[data-friends-filter]","{friendListActions}":"[data-friendList-actions]","{addFriendToList}":"[data-friends-add]","{friendsCounter}":"[data-total-friends]","{pendingCounter}":"[data-total-friends-pending]","{suggestionCounter}":"[data-total-friends-suggestion]","{requestCount}":"[data-frields-request-sent-count]",view:{loader:"site/loading/small",emptyFriendItems:"site/friends/default.empty",addUserForm:"site/friends/list.assign"}}},function(a){return{init:function(){a.friendList().implement(EasySocial.Controller.Friends.List,
{"{parent}":a});a.initFriendItems()},initFriendItems:function(){a.friendListActions().implement(EasySocial.Controller.Friends.List.Actions,{"{parent}":a});a.friendItem().implement(EasySocial.Controller.Friends.Item,{"{parent}":a})},updateFriendsCounter:function(){EasySocial.ajax("site/controllers/friends/getCounters").done(function(b,f,d,e){a.friendsCounter().html(b);a.pendingCounter().html(f);a.requestCount().html(d);a.suggestionCounter().html(e)})},updateListCounters:function(){EasySocial.ajax("site/controllers/friends/getListCounts",
{}).done(function(a){b(a).each(function(a,c){b("[data-list-"+c.id+"]").controller().updateCounter(c.count)})})},insertItem:function(c){a.emptyList().hide();a.updateListCounters();b(c).implement(EasySocial.Controller.Friends.Item,{"{parent}":a}).prependTo(a.friendItems())},removeItem:function(b){a.friendItem("[data-friendItem-"+b+"]").remove();0>=a.friendItem().length&&a.emptyList().show();a.updateListCounters()},updateFriendRequestCount:function(b){curCount=parseInt(a.requestCount().text(),10);NaN!=
curCount&&(curCount+=b,a.requestCount().text(curCount))},updateContent:function(b){a.content().html(b);a.initFriendItems()},removeActiveFilter:function(){a.filterItem().removeClass("active")},"{filterItem} click":function(b,f){var d=b.data("filter"),e=b.data("title"),h=b.data("userid"),l=b.data("url");0<a.friendList().length&&a.friendList().controller().removeActiveList();a.filterItem().removeClass("active");b.addClass("active");History.pushState({state:1},e,l);b.addClass("loading");EasySocial.ajax("site/controllers/friends/filter",
{filter:d,userid:h}).done(function(b){a.updateContent(b)}).always(function(){b.removeClass("loading")})}}});d.resolve()})});EasySocial.module("site/friends/list",function(e){var d=this;EasySocial.require().view("site/loading/small").library("history").script("site/friends/suggest").done(function(b){EasySocial.Controller("Friends.List",{defaultOptions:{parent:null,"{item}":"[data-friends-listItem]","{items}":"[data-friends-listItems]","{loadMoreButton}":".loadMoreButton","{loadMore}":".loadMore",view:{loader:"site/loading/small",
items:"site/friends/default.lists"}}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Friends.List.Item,{"{parent}":a})},removeActiveList:function(){a.item().removeClass("active")},setDefault:function(b){a.item().removeClass("default");a.item(".item-"+b).addClass("default")},"{item} click":function(c){var f=b(c).data("title"),d=b(c).data("url");History.pushState({state:1},f,d);a.parent.removeActiveFilter();a.item().removeClass("active");a.item(c).addClass("active");f=b(c).data("id");
a.parent.options.activeList=f;EasySocial.ajax("site/controllers/friends/getListFriends",{id:f},{beforeSend:function(){b(c).addClass("loading")}}).done(function(f){b(c).removeClass("loading");a.parent.updateContent(f)})},"{loadMoreButton} click":function(){var b=a.loadMoreButton().data("limitstart");a.loadMore().html(a.view.loader());EasySocial.ajax("site/controllers/friends/getLists",{limitstart:b}).done(function(b){a.loadMore().hide();a.view.items({items:b}).appendTo(a.items())})}}});EasySocial.Controller("Friends.List.Item",
{defaultOptions:{id:null,"{counter}":"[data-list-counter]"}},function(a){return{init:function(){a.options.id=a.element.data("id")},updateCounter:function(b){a.counter().html(b)}}});EasySocial.Controller("Friends.List.Actions",{defaultOptions:{"{delete}":"[data-friendListActions-delete]","{add}":"[data-friendListActions-add]","{default}":"[data-friendListActions-default]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.options.title=a.element.data("title");a.options.userId=
a.element.data("userid")},"{default} click":function(){EasySocial.ajax("site/controllers/friends/setDefault",{id:a.options.id}).done(function(){a.parent.friendList().controller().setDefault(a.options.id)})},"{add} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/assignList",{id:a.options.id}),bindings:{"{insertButton} click":function(){var c=this.suggest().textboxlist("controller").getAddedItems();EasySocial.ajax("site/controllers/friends/assign",{uid:b.pluck(c,"id"),
userId:a.options.userId,listId:a.options.id}).done(function(c){b("[data-assignFriends-notice]").hide();b(c).each(function(b,c){a.parent.insertItem(c);EasySocial.dialog().close()})}).fail(function(a){b("[data-assignFriends-notice]").addClass("alert alert-error").html(a.message)})}}})},"{delete} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmDeleteList",{id:a.options.id}),bindings:{"{deleteButton} click":function(){b("[data-friends-list-delete-form]").submit()}}})}}});
d.resolve()})});EasySocial.module("site/friends/item",function(e){var d=this;EasySocial.require().script("site/conversations/composer").language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_PENDING_APPROVAL","COM_EASYSOCIAL_FRIENDS_REQUEST_DIALOG_TITLE","COM_EASYSOCIAL_FRIENDS_CANCEL_REQUEST_DIALOG_CANCELLED").done(function(b){EasySocial.Controller("Friends.Item",{defaultOptions:{id:null,name:null,friendId:null,"{removeFromList}":"[data-lists-removeFriend]","{unfriend}":"[data-friends-unfriend]","{addfriend}":"[data-friends-addfriend]",
"{block}":"[data-friends-block]","{message}":"[data-friendItem-message]","{reject}":"[data-friendItem-reject]","{approve}":"[data-friendItem-approve]","{cancelRequest}":"[data-friendItem-cancel-request]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.options.name=a.element.data("name");a.options.friendId=a.element.data("friendid");a.options.avatar=a.element.data("avatar");a.initConversation()},initConversation:function(){a.message().implement(EasySocial.Controller.Conversations.Composer.Dialog,
{recipient:{name:a.options.name,id:a.options.id,avatar:a.options.avatar}})},"{removeFromList} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmRemoveFromList",{id:a.options.id}),bindings:{"{removeButton} click":function(){EasySocial.ajax("site/controllers/friends/removeFromList",{listId:a.parent.options.activeList,userId:a.options.id}).done(function(){a.parent.removeItem(a.options.id);EasySocial.dialog({title:"User removed from list",content:"The user has been removed from the list.",
buttons:[{name:"Done",classNames:"btn btn-es",click:function(){EasySocial.dialog().close()}}]})}).fail(function(a){console.log(a)})}}})},"{reject} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmReject",{id:a.options.id}),bindings:{"{rejectButton} click":function(){EasySocial.ajax("site/controllers/friends/reject",{id:a.options.friendId}).done(function(){a.parent.removeItem(a.options.id);a.parent.updateFriendsCounter();EasySocial.dialog({content:EasySocial.ajax("site/views/friends/friendRejected")})})}}})},
"{unfriend} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmUnfriend",{id:a.options.id}),bindings:{"{unfriendButton} click":function(){EasySocial.ajax("site/controllers/friends/unfriend",{id:a.options.friendId}).done(function(){a.parent.removeItem(a.options.id);a.parent.updateFriendsCounter();EasySocial.dialog({content:EasySocial.ajax("site/views/friends/friendRemoved",{id:a.options.id})})})}}})},"{cancelRequest} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmCancelRequest",
{id:a.options.id}),bindings:{"{cancelRequestButton} click":function(){EasySocial.ajax("site/controllers/friends/cancelRequest",{id:a.options.friendId}).done(function(){a.parent.removeItem(a.options.id);a.parent.updateFriendRequestCount(-1);EasySocial.dialog({content:EasySocial.ajax("site/views/friends/requestCancelled",{id:a.options.id})})})}}})},"{approve} click":function(b){EasySocial.ajax("site/controllers/friends/approve",{id:a.options.friendId}).done(function(){a.parent.updateFriendsCounter();
a.element.remove()})},"{addfriend} click":function(c){EasySocial.ajax("site/controllers/friends/request",{id:a.options.id}).done(function(c){a.parent.updateFriendRequestCount(1);EasySocial.dialog({title:b.language("COM_EASYSOCIAL_FRIENDS_REQUEST_DIALOG_TITLE"),content:b.language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_PENDING_APPROVAL",a.options.name)});a.parent.removeItem(a.options.id)}).fail(function(a){EasySocial.dialog({title:"Info",content:a})})},"{block} click":function(){console.log("block")}}});
d.resolve()})});EasySocial.module("site/notifications/list",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("NotificationsList",{defaultOptions:{"{item}":"[data-notifications-list-item]","{list}":"[data-notifications-list]","{allread}":"[data-notification-all-read]","{allclear}":"[data-notification-all-clear]","{notiLoadMoreBtn}":"[data-notification-loadmore-btn]"}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.NotificationsList.Item,
{"{parent}":a})},"{allread} click":function(){EasySocial.ajax("site/controllers/notifications/setAllState",{state:"read"}).done(function(){a.item().removeClass("is-read is-hidden is-unread").addClass("is-read")})},"{allclear} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/notifications/clearAllConfirm"),bindings:{"{clearButton} click":function(){EasySocial.ajax("site/controllers/notifications/setAllState",{state:"clear"}).done(function(){a.item().removeClass("is-read is-hidden is-unread is-read").addClass("is-remove");
EasySocial.dialog().close()})}}})},"{notiLoadMoreBtn} click":function(c,f){var d=b(c).data("startlimit");0>d||EasySocial.ajax("site/controllers/notifications/loadmore",{startlimit:d}).done(function(f,d){b(c).data("startlimit",d);console.log(d);0<f.length&&(b.buildHTML(f).insertBefore(a.notiLoadMoreBtn()),a.item().implement(EasySocial.Controller.NotificationsList.Item));0>d&&a.notiLoadMoreBtn().hide()}).fail(function(a){return a}).always(function(){})}}});EasySocial.Controller("NotificationsList.Item",
{defaultOptions:{"{unread}":"[data-notifications-list-item-unread]","{read}":"[data-notifications-list-item-read]","{delete}":"[data-notifications-list-item-delete]"}},function(a){return{init:function(){a.options.id=a.element.data("id")},"{unread} click":function(){EasySocial.ajax("site/controllers/notifications/setState",{id:a.options.id,state:"unread"}).done(function(){a.element.removeClass("is-read is-hidden is-unread").addClass("is-unread\t")})},"{read} click":function(){EasySocial.ajax("site/controllers/notifications/setState",
{id:a.options.id,state:"read"}).done(function(){a.element.removeClass("is-read is-hidden is-unread").addClass("is-read")})},"{delete} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/notifications/clearConfirm"),bindings:{"{clearButton} click":function(){EasySocial.ajax("site/controllers/notifications/setState",{id:a.options.id,state:"clear"}).done(function(){a.element.removeClass("is-read is-hidden is-unread is-read").addClass("is-remove");EasySocial.dialog().close()}).fail(function(a){EasySocial.dialog({content:a.message})})}}})}}});
d.resolve()})});EasySocial.module("site/points/history",function(){var e=this;EasySocial.require().done(function(d){EasySocial.Controller("Points.History",{defaultOptions:{"{loadMore}":"[data-points-history-pagination]","{timeline}":"[data-points-history-timeline]"}},function(b){return{init:function(){},"{loadMore} click":function(a,c){var f=d(a).data("current");EasySocial.ajax("site/views/points/getHistory",{limitstart:f,id:b.options.id}).done(function(c,f,e){b.timeline().append(c);d(a).data("current",
f);e&&d(a).hide()})}}});e.resolve()})});EasySocial.module("notifications/popbox",function(e){this.resolve(function(d){return{content:EasySocial.ajax("site/controllers/notifications/getSystemItems",{layout:"popbox.notifications"}),id:"es-wrap",type:"notifications",cache:!1}})});EasySocial.module("conversations/popbox",function(e){this.resolve(function(d){return{content:EasySocial.ajax("site/controllers/notifications/getConversationItems",{usemax:"1",layout:"popbox.conversations"}),id:"es-wrap",type:"notifications",
cache:!1}})});EasySocial.module("friends/popbox",function(e){this.resolve(function(d){return{content:EasySocial.ajax("site/controllers/notifications/friendsRequests",{layout:"popbox.friends"}),id:"es-wrap",type:"notifications",cache:!1}})});EasySocial.module("site/profile/about",function(e){var d=this;EasySocial.require().script("field").done(function(b){EasySocial.Controller("Profile.About",{defaultOptions:{userid:null,"{stepItem}":"[data-profile-about-step-item]","{stepContent}":"[data-profile-about-step-content]",
"{fieldItem}":"[data-profile-about-fields-item]"}},function(a){return{init:function(){a.fieldItem().addController("EasySocial.Controller.Field.Base",{userid:a.options.userid,mode:"display"})},"{stepItem} click":function(b,f){var d=b.data("for");a.stepItem().removeClass("active");b.addClass("active");a.stepContent().trigger("activateTab",[d])},"{stepContent} activateTab":function(a,b,d){b=a.data("id");a.toggleClass("active",d==b)}}});d.resolve()})});EasySocial.module("site/profile/avatar",function(e){EasySocial.Controller("Profile.Avatar",
{defaultOptions:{"{menu}":"[data-avatar-menu]","{uploadButton}":"[data-avatar-upload-button]","{selectButton}":"[data-avatar-select-button]","{removeButton}":"[data-avatar-remove-button]"}},function(d){return{init:function(){},"{uploadButton} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/uploadAvatar")})},"{selectButton} click":function(){EasySocial.photos.selectPhoto({bindings:{"{self} photoSelected":function(b,a,c){(b=c[0])&&EasySocial.photos.createAvatar(b.id)}}})},
"{menu} dropdownOpen":function(){d.element.addClass("show-all")},"{menu} dropdownClose":function(){d.element.removeClass("show-all")},"{removeButton} click":function(){}}});this.resolve()});EasySocial.module("site/profile/edit",function(e){var d=this;EasySocial.require().script("validate","field","oauth/facebook").done(function(b){EasySocial.Controller("Profile.Edit",{defaultOptions:{userid:null,"{stepContent}":"[data-profile-edit-fields-content]","{stepItem}":"[data-profile-edit-fields-step]","{profileForm}":"[data-profile-fields-form]",
"{profileContent}":"[data-profile-edit-fields]","{fieldItem}":"[data-profile-edit-fields-item]","{save}":"[data-profile-fields-save]","{deleteProfile}":"[data-profile-edit-delete]"}},function(a){return{init:function(){a.fieldItem().addController("EasySocial.Controller.Field.Base",{userid:a.options.userid,mode:"edit"})},errorFields:[],"{fieldItem} error":function(b,f){a.triggerStepError(b)},"{fieldItem} clear":function(b,f){a.clearStepError(b)},"{fieldItem} onError":function(b,f){a.triggerStepError(b)},
triggerStepError:function(c){var f=c.data("id");c=c.parents(a.stepContent.selector).data("id");0>b.inArray(f,a.errorFields)&&a.errorFields.push(f);a.stepItem().filterBy("for",c).trigger("error")},clearStepError:function(c){var f=c.data("id");c=c.parents(a.stepContent.selector).data("id");a.errorFields=b.without(a.errorFields,f);a.stepItem().filterBy("for",c).trigger("clear")},"{stepItem} click":function(c,f){var d=b(c).data("for");a.profileContent().show();a.stepContent().hide();a.stepItem().removeClass("active");
a.stepItem(c).addClass("active");d=a.stepContent(".step-"+d);d.show();d.find(a.fieldItem.selector).trigger("show")},"{stepItem} error":function(a){a.addClass("error")},"{stepItem} clear":function(b){1>a.errorFields.length&&b.removeClass("error")},"{tabItem} click":function(c,f){var d=b(c).data("for");a.tabHeaderItem().hide();a.tabHeaderItem("."+d+"Header").show().addClass("active")},"{save} click":function(c,f){f.preventDefault();b(c).addClass("btn-loading");a.profileForm().validate().fail(function(){b(c).removeClass("btn-loading");
EasySocial.dialog({content:EasySocial.ajax("site/views/profile/showFormError")})}).done(function(){a.profileForm().submit()});return!1},"{deleteProfile} click":function(){EasySocial.dialog({content:EasySocial.ajax("site/views/profile/confirmDelete")})}}});d.resolve()})});EasySocial.module("validate",function(e){e.isController("EasySocial.Controller.Validator")||EasySocial.Controller("Validator",{defaultOptions:{checks:["required","validate"],typeAttr:"data-check-type",formatAttr:"data-check-format",
modifierAttr:"data-check-modifier",errorTrigger:"onError",submitTrigger:"onSubmit","{container}":"[data-check]","{notice}":"[data-check-notice]","{required}":"[data-check-required]","{validate}":"[data-check-validate]"}},function(d){return{vars:{},register:[],deferreds:[],errors:[],state:e.Deferred(),init:function(){},reset:function(){d.vars={};d.register=[];d.deferreds=[];d.errors=[];d.state=e.Deferred();d.container().removeClass("error")},start:function(){d.reset();e.each(d.container(),function(b,
a){d.vars.container=a=e(a);a.trigger(d.options.submitTrigger,[d.register]);e.each(d.getFields(),function(a,b){d.vars.field=b=e(b);e.each(d.options.checks,function(a,b){d.vars.check=b;d[b+"Check"]()})})});e.each(d.register,function(b,a){if(e.isDeferred(a))d.deferreds.push(a);else if(!a)return d.errors.push(b),!0});0<d.errors.length?d.state.reject():0<d.deferreds.length?e.when.apply(null,d.deferreds).done(function(){d.state.resolve()}).fail(function(){d.state.reject()}):d.state.resolve();return d.state},
getFields:function(){return e.merge(d.vars.container.find(d.required.selector),d.vars.container.find(d.validate.selector))},requiredCheck:function(){if(d.vars.field.is(d.required.selector)){var b=d.vars.field.attr(d.options.typeAttr)||d.vars.field.attr("type")||"text";"text"===b&&""==e.trim(d.vars.field.val())&&d.raiseError();"checkbox"===b&&1>d.vars.field.find('input[type="checkbox"]').filter(":checked").length&&d.raiseError()}},validateCheck:function(){if(void 0!==d.vars.field.attr(d.options.formatAttr)){var b=
d.vars.field.attr(d.options.formatAttr)||"",a=d.vars.field.attr(d.options.modifierAttr)||"";RegExp(b,a).test(d.vars.field.val())||d.raiseError()}},raiseError:function(){d.vars.container.addClass("error");d.vars.container.trigger(d.options.errorTrigger,[d.vars.check,d.vars.field]);d.register.push(!1)}}});e.fn.validate=function(d){return 0<this.length?this.addController("EasySocial.Controller.Validator",d).start():!1};this.resolve()});EasySocial.module("site/profile/friends",function(e){var d=this;
EasySocial.require().view("site/loading/small").language("COM_EASYSOCIAL_FRIENDS_DIALOG_CANCEL_REQUEST","COM_EASYSOCIAL_CANCEL_BUTTON","COM_EASYSOCIAL_YES_CANCEL_MY_REQUEST_BUTTON").done(function(b){EasySocial.Controller("Profile.Friends.Request",{defaultOptions:{id:null,callback:null,"{addButton}":"[data-profileFriends-add]","{manageButton}":"[data-profileFriends-manage]","{pendingButton}":"[data-profileFriends-pending]","{respondButton}":"[data-profileFriends-respond]","{cancelRequest}":"[data-profileFriends-cancelRequest]",
"{unfriend}":"[data-profile-friends-unfriend]","{approve}":"[data-friends-response-approve]","{reject}":"[data-friends-response-reject]","{button}":"[data-profileFriends-button]","{dropdown}":"[data-profileFriends-dropdown]",view:{loader:"site/loading/small"}}},function(a){return{init:function(){a.options.id=a.element.data("friend");a.options.target=a.element.data("id");a.options.callback=a.element.data("callback")},showDropDown:function(){a.element.addClass("open")},hideDropDown:function(){a.element.removeClass("open")},
"{addButton} click":function(b){var f=a.button();f.addClass("loading");EasySocial.ajax("site/controllers/friends/request",{id:a.options.target}).done(function(b,c){a.dropdown().remove();a.options.id=b;a.button().replaceWith(c)}).fail(function(){f.removeClass("loading")})},"{cancelRequest} click":function(b,f){a.hideDropDown();EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmCancel"),bindings:{"{confirmButton} click":function(){EasySocial.ajax("site/controllers/friends/cancelRequest",
{id:a.options.id}).done(function(b){a.dropdown().remove();a.button().replaceWith(b);EasySocial.dialog().close()})}}})},"{unfriend} click":function(c,f){var d=b(c).data("id");EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmUnfriend",{id:d}),bindings:{"{unfriendButton} click":function(){EasySocial.ajax("site/controllers/friends/unfriend",{id:a.options.id}).done(function(b){a.dropdown().remove();a.button().replaceWith(b);EasySocial.dialog().close()})}}})},"{approve} click":function(b,
f){var d=a.options.id;a.dropdown().remove();EasySocial.ajax("site/controllers/friends/approve",{id:d}).done(function(b){a.button().replaceWith(b)})},"{reject} click":function(b,f){var d=a.options.id;a.dropdown().remove();EasySocial.dialog({content:EasySocial.ajax("site/views/friends/confirmReject"),bindings:{"{rejectButton} click":function(){EasySocial.ajax("site/controllers/friends/reject",{id:d}).done(function(b){a.button().replaceWith(b);EasySocial.dialog({content:EasySocial.ajax("site/views/friends/friendRejected")})})}}})},
"{dropdown} click":function(a,b){b.stopPropagation()},"{approveRequest} click":function(){a.respondForm().find("input[name=task]").val("approve");a.respondForm().find("input[name=id]").val(a.options.friendId);a.respondForm().find("input[name=return]").val(a.options.callback);a.respondForm().submit()}}});d.resolve()})});EasySocial.module("site/profile/header",function(e){var d=this;EasySocial.require().script("site/profile/friends","site/profile/subscriptions","site/conversations/composer").done(function(b){EasySocial.Controller("Profile.Header",
{defaultOptions:{id:null,"{friendRequest}":"[data-profile-friends]","{subscribe}":"[data-profile-followers]","{conversation}":"[data-profile-conversation]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.options.name=a.element.data("name");a.options.avatar=a.element.data("avatar");a.friendRequest().implement(EasySocial.Controller.Profile.Friends.Request,{"{parent}":a});a.subscribe().implement(EasySocial.Controller.Profile.Subscriptions,{"{parent}":a});a.conversation().implement(EasySocial.Controller.Conversations.Composer.Dialog,
{recipient:{id:a.options.id,name:a.options.name,avatar:a.options.avatar}})}}});d.resolve()})});EasySocial.module("site/profile/subscriptions",function(e){EasySocial.Controller("Profile.Subscriptions",{defaultOptions:{id:null,"{follow}":"[data-subscription-follow]","{unfollow}":"[data-subscription-unfollow]","{message}":"[data-subscription-message]","{button}":"[data-subscription-button]"}},function(d){return{init:function(){d.options.id=d.element.data("id")},toggleDropDown:function(){d.element.toggleClass("open")},
"{unfollow} click":function(){d.toggleDropDown();EasySocial.ajax("site/controllers/profile/unfollow",{id:d.options.id,type:"user"}).done(function(b){d.button().replaceWith(b)})},"{follow} click":function(){d.toggleDropDown();EasySocial.ajax("site/controllers/profile/follow",{id:d.options.id,type:"user"}).done(function(b){d.button().replaceWith(b)})}}});this.resolve()});EasySocial.module("site/profile/miniheader",function(e){var d=this;EasySocial.require().library("scrollTo").done(function(b){EasySocial.Controller("Profile.MiniHeader",
{defaultOptions:{"{viewport}":"[data-appscroll-viewport]","{content}":"[data-appscroll-content]","{apps}":"[data-appscroll-content] li","{buttons}":"[data-appscroll-buttons]","{nextButton}":"[data-appscroll-next-button]","{prevButton}":"[data-appscroll-prev-button]"}},function(a){return{init:function(){a.setLayout();a.viewport().scrollTo(0)},"{window} resize":b.debounce(function(){a.setLayout()},300),setLayout:function(){var c=a.viewport(),f=5;b("#es-wrap.es-main").hasClass("w480")?(a.content().css({width:"auto"}),
a.enabled=!1):(a.apps().each(function(){f+=b(this).outerWidth(!0)}),f>c.width()&&(a.content().css({width:f,float:"none"}),a.buttons().css("opacity",1),a.enabled=!0))},enabled:!1,"{nextButton} click":function(){if(a.enabled){var b=a.viewport(),f=b.width()-80;b.scrollTo("+="+f+"px",800,{axis:"x",easing:"easeInOutCubic"})}},"{prevButton} click":function(){if(a.enabled){var b=a.viewport(),f=b.width()-80;b.scrollTo("-="+f+"px",800,{axis:"x",easing:"easeInOutCubic"})}}}});d.resolve()})});EasySocial.module("site/profile/notifications",
function(e){var d=this;EasySocial.require().script("site/profile/header").done(function(){EasySocial.Controller("Profile.Notifications",{defaultOptions:{"{sidebarItem}":"[data-notification-item]","{contentItem}":"[data-notification-content]","{notificationForm}":"[data-notifications-form]"}},function(b){return{init:function(){},"{sidebarItem} click":function(a,c){b.sidebarItem().removeClass("active");a.addClass("active");b.contentItem().hide();var f=a.data("alert-element");b.contentItem('[data-alert-element="'+
f+'"]').show()}}});d.resolve()})});EasySocial.module("site/profile/privacy",function(e){var d=this;EasySocial.require().script("site/profile/header").library("history","textboxlist").view("site/loading/small").done(function(b){EasySocial.Controller("Profile.Privacy",{defaultOptions:{"{sidebarItem}":"[data-profile-privacy-item]","{contentItem}":"[data-privacy-content]","{privacyItem}":"[data-privacy-item]","{privacyForm}":"[data-profile-privacy-form]",view:{loading:"site/loading/small"}}},function(a){return{init:function(){a.sidebarItem().implement(EasySocial.Controller.Profile.Privacy.Sidebar,
{"{parent}":a});a.privacyItem().implement(EasySocial.Controller.Profile.Privacy.Item,{"{parent}":a})},updateContent:function(c){a.contentItem().hide();b(".privacy-content-"+c).show()}}});EasySocial.Controller("Profile.Privacy.Sidebar",{defaultOptions:{"{sidebarItem}":"[data-profile-privacy-item]"}},function(a){return{init:function(){},"{self} click":function(c){b("[data-profile-privacy-item]").removeClass("active");b(c).addClass("active");c=a.element.data("group");a.parent.updateContent(c)}}});EasySocial.Controller("Profile.Privacy.Item",
{defaultOptions:{"{selection}":"[data-privacy-select]","{hiddenCustom}":"[data-hidden-custom]","{customForm}":"[data-privacy-custom-form]","{customTextInput}":"[data-textfield]","{customItems}":"input[]","{customHideBtn}":"[data-privacy-custom-hide-button]","{customInputItem}":"[data-textboxlist-item]","{customEditBtn}":"[data-privacy-custom-edit-button]"}},function(a){return{init:function(){a.customTextInput().textboxlist({unique:!0,plugin:{autocomplete:{exclusive:!0,minLength:2,cache:!1,query:function(b){var f=
a.getTaggedUsers();return EasySocial.ajax("site/views/privacy/getfriends",{q:b,exclude:f})}}}});a.textboxlistLib=a.customTextInput().textboxlist("controller")},getTaggedUsers:function(){var c=[],f=a.customInputItem();0<f.length&&b.each(f,function(a,f){c.push(b(f).data("id"))});return c},"{customTextInput} addItem":function(b,f,d){b=a.hiddenCustom().val();f="";""==b?f=d.id:(b=b.split(","),b.push(d.id),f=b.join(","));a.hiddenCustom().val(f)},"{customTextInput} removeItem":function(b,f,d){b="";b=[];
f=a.hiddenCustom().val().split(",");for(var e=0;e<f.length;e++)f[e]!=d.id&&b.push(f[e]);b=0>=b.length?"":b.join(",");a.hiddenCustom().val(b)},"{customEditBtn} click":function(b){a.customForm().toggle()},"{selection} change":function(b){"custom"==b.val()?(a.customForm().show(),a.customEditBtn().show()):(a.customForm().hide(),a.customEditBtn().hide())},"{customHideBtn} click":function(){a.customForm().hide();a.customEditBtn().show();a.textboxlistLib.autocomplete.hide()}}});d.resolve()})});EasySocial.module("site/profile/profile",
function(e){var d=this;EasySocial.require().script("site/profile/header").library("history").done(function(b){EasySocial.Controller("Profile",{defaultOptions:{id:null,"{header}":"[data-profile-header]","{app}":"[data-profile-apps-item]","{action}":"[data-profile-apps-menu]","{contents}":"[data-profile-real-content]"}},function(a){return{init:function(){a.options.id=a.element.data("id");a.header().implement(EasySocial.Controller.Profile.Header,{"{parent}":a});a.app().implement(EasySocial.Controller.Profile.Apps.Item,
{"{parent}":a})},"{app} click":function(c){a.app().removeClass("active");b(c).addClass("active")},updateContent:function(b){a.element.removeClass("loading");a.contents().html(b)},loading:function(){a.contents().html("");a.element.addClass("loading")}}});EasySocial.Controller("Profile.Apps.Item",{defaultOptions:{}},function(a){return{init:function(){a.options.layout=a.element.data("layout");a.options.id=a.element.data("id");a.options.url=a.element.data(a.options.layout+"-url");a.options.namespace=
a.element.data("namespace");a.options.title=a.element.data("title");a.options.description=a.element.data("description");a.options.appId=a.element.data("app-id")},"{self} click":function(b,f){f.preventDefault();"canvas"==a.options.layout?window.location=a.options.url:(History.pushState({state:1},a.options.title,a.options.url),EasySocial.ajax(a.options.namespace,{id:a.options.id,view:"profile",appId:a.options.appId},{beforeSend:function(){a.parent.loading()}}).done(function(b){a.parent.updateContent(b)}).fail(function(a){return a}))}}});
d.resolve()})});EasySocial.module("site/registrations/registrations",function(e){var d=this;EasySocial.require().script("validate","field").view("site/registration/dialog.error").language("COM_EASYSOCIAL_CLOSE_BUTTON","COM_EASYSOCIAL_REGISTRATION_ERROR_DIALOG_TITLE").done(function(b){EasySocial.Controller("Registrations.Form",{defaultOptions:{previousLink:null,"{submit}":"[data-registration-submit]","{field}":"[data-registration-fields-item ]","{previous}":"[data-registration-previous]",view:{formError:"site/registration/dialog.error"}}},
function(a){return{init:function(){a.field().addController("EasySocial.Controller.Field.Base",{mode:"register"})},"{previous} click":function(b,f){f.preventDefault();window.location.href=a.options.previousLink;return!1},"{submit} click":function(c,f){f.preventDefault();b(c).addClass("btn-loading");b(a.element).validate().fail(function(){b(c).removeClass("btn-loading");EasySocial.dialog({title:b.language("COM_EASYSOCIAL_REGISTRATION_ERROR_DIALOG_TITLE"),content:a.view.formError({}),width:400,height:150,
buttons:[{name:b.language("COM_EASYSOCIAL_CLOSE_BUTTON"),classNames:"btn btn-es-primary",click:function(){EasySocial.dialog().close()}}]})}).done(function(){a.element.submit()});return!1}}});d.resolve()})});EasySocial.module("site/search/item",function(e){var d=this;EasySocial.require().view("site/loading/small").language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_NOTICE").done(function(b){EasySocial.Controller("Search.Item",{defaultOptions:{"{toggle}":"[data-activity-toggle]","{deleteBtn}":"[data-activity-delete]",
"{addFriendButton}":"[data-search-friend-button]","{pendingFriendButton}":"[data-search-friend-pending-button]","{dropdown}":"[data-profileFriends-dropdown]",view:{loader:"site/loading/small"}}},function(a){return{init:function(){null},"{pendingFriendButton} click":function(c){a.dropdown().html(b.language("COM_EASYSOCIAL_FRIENDS_REQUEST_SENT_NOTICE"))},"{addFriendButton} click":function(c){var f=a.element.data("friend-uid");b(c).addClass("btn-loading");EasySocial.ajax("site/controllers/friends/request",
{viewCallback:"usersRequest",id:f}).done(function(f){b(c).replaceWith(f);a.dropdown().remove();b(c).removeClass("btn-loading")}).fail(function(b){a.dropdown().html(b)})}}});d.resolve()})});EasySocial.module("site/search/list",function(e){var d=this;EasySocial.require().view("site/loading/small").script("site/search/item").language("COM_EASYSOCIAL_SEARCH_LOAD_MORE_ITEMS").done(function(b){EasySocial.Controller("Search.List",{defaultOptions:{"{item}":"[data-search-item]","{pagination}":"[data-search-pagination]",
"{loadmorebutton}":"[data-search-loadmore-button]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.item().implement(EasySocial.Controller.Search.Item);a.on("scroll.search",window,b._.debounce(function(){a.loading||a.pagination().visible()&&a.loadMore()},250))},"{loadmorebutton} click":function(){a.loadMore()},loadMore:function(){var c=b("[data-search-query]").val(),f=b("[data-sidebar-menu].active").data("type"),d=a.pagination().data("last-limit"),e=a.pagination().data("last-type");
"-1"==d?a.loadmorebutton.hide():(a.loading=!0,EasySocial.ajax("site/controllers/search/getItems",{next_limit:d,last_type:e,type:f,q:c,loadmore:"1"},{beforeSend:function(){a.pagination().html(a.view.loadingContent())}}).done(function(c,f,d){a.pagination().data("last-limit",d);a.pagination().data("last-type",f);a.pagination().before(c);a.item().implement(EasySocial.Controller.Search.Item);"-1"==d?a.pagination().html(""):(link='<a class="btn btn-es-primary btn-stream-updates" href="javascript:void(0);" data-search-loadmore-button><i class="ies-refresh"></i>\t'+
b.language("COM_EASYSOCIAL_SEARCH_LOAD_MORE_ITEMS")+"</a>",a.pagination().html(link))}).fail(function(a){return a}).always(function(){a.loading=!1}))}}});d.resolve()})});EasySocial.module("site/search/search",function(e){var d=this;EasySocial.require().library("history").script("site/search/sidebar","site/profile/friends").view("site/loading/small").done(function(b){EasySocial.Controller("Search",{defaultOptions:{items:null,"{container}":"[data-search]","{contentTitle}":"[data-search-content-title]",
"{content}":"[data-search-content]","{sidebar}":"[data-search-sidebar]","{sidebarItem}":"[data-sidebar-item]",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){a.sidebar().implement(EasySocial.Controller.Search.Sidebar,{"{parent}":a});a.sidebarItem().implement(EasySocial.Controller.Search.Sidebar.Item,{"{parent}":a})},updatingContents:function(){a.content().html(a.view.loadingContent())},updateContent:function(b){a.content().html(b)}}});d.resolve()})});EasySocial.module("site/search/sidebar",
function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Search.Sidebar",{defaultOptions:{"{menuItem}":"[data-sidebar-menu]"}},function(a){return{init:function(){},"{menuItem} click":function(c,f){a.menuItem().removeClass("active");b(c).addClass("active")}}});EasySocial.Controller("Search.Sidebar.Item",{defaultOptions:{}},function(a){return{init:function(){},"{self} click":function(c,f){var d=a.element.data("type"),e=a.element.data("url"),h=b("[data-search-query]").val();
History.pushState({state:1},"",e);a.parent.updatingContents();EasySocial.ajax("site/controllers/search/getItems",{type:d,q:h}).done(function(b){a.parent.updateContent(b)}).fail(function(a){console.log(a)});a.parent.updateContent()}}});d.resolve()})});EasySocial.module("site/search/toolbar",function(e){var d=this;EasySocial.require().library("history").view("site/loading/small").done(function(b){EasySocial.Controller("Search.Toolbar",{defaultOptions:{items:null,"{searchInput}":"[data-nav-search-input]",
"{seachDropdown}":"[data-nav-search-dropdown]","{searchResult}":"li.navSearchItem",view:{loadingContent:"site/loading/small"}}},function(a){return{init:function(){b(document).on("click.toolbar.search",function(c){c=c.target;c==a.element[0]||0<b(c).parents(a.element.data("directSelector")).length||a.seachDropdown().hide()})},"{self} destroy":function(){b(document).off("click.toolbar.search")},"{searchInput} keyup":b._.debounce(function(b,f){if(!a.loading){var d=b.val();3<=d.length&&(a.loading=!0,EasySocial.ajax("site/controllers/search/getItems",
{q:d,mini:"1"},{beforeSend:function(){a.seachDropdown().show();a.seachDropdown().html(a.view.loadingContent())}}).done(function(b){a.seachDropdown().html(b)}).fail(function(a){console.log(a)}).always(function(){a.loading=!1}))}},250),"{searchInput} focus":function(){cnt=a.searchResult().length;0<cnt&&a.seachDropdown().show()}}});d.resolve()})});EasySocial.module("site/stream/filter",function(e){var d=this;EasySocial.require().script("site/stream/sidebar").language("COM_EASYSOCIAL_STREAM_FILTER_WARNING_TITLE_EMPTY",
"COM_EASYSOCIAL_STREAM_FILTER_WARNING_HASHTAG_EMPTY").done(function(b){EasySocial.Controller("Stream.Filter",{defaultOptions:{"{heading}":"[data-filter-heading]","{sidebar}":"[data-sidebar-item]","{content}":"[data-filter-real-content]"}},function(a){return{init:function(){a.sidebar().implement(EasySocial.Controller.Stream.Filter.Sidebar,{"{parent}":a})},updateHeading:function(b,d){a.heading().find("[data-heading-title]").html(b);a.heading().find("[data-heading-desc]").html(d)},updatingContents:function(){a.element.addClass("loading")},
updateContents:function(b){a.element.removeClass("loading");a.content().html(b)}}});EasySocial.Controller("Stream.Filter.Item",{defaultOptions:{"{title}":"[data-filter-name]","{hashtag}":"[data-filter-hashtag]","{saveBtn}":"[data-stream-filter-save]","{deleteBtn}":"[data-stream-filter-delete]","{form}":"[data-filter-inputForm]","{notice}":"[filter-form-notice]"}},function(a){return{init:function(){},"{deleteBtn} click":function(b){var d=b.data("id");EasySocial.dialog({content:EasySocial.ajax("site/views/stream/confirmFilterDelete"),
bindings:{"{deleteButton} click":function(){EasySocial.ajax("site/controllers/stream/deleteFilter",{id:d}).done(function(b){a.element.fadeOut();EasySocial.dialog().close()})}}})},"{saveBtn} click":function(){b("div.control-group").removeClass("error");a.notice().html();a.notice().hide();if(""==a.title().val())return a.title().parents("div.control-group").addClass("error"),a.notice().html(b.language("COM_EASYSOCIAL_STREAM_FILTER_WARNING_TITLE_EMPTY")),a.notice().show(),!1;if(""==a.hashtag().val())return a.hashtag().parents("div.control-group").addClass("error"),
a.notice().html(b.language("COM_EASYSOCIAL_STREAM_FILTER_WARNING_HASHTAG_EMPTY")),a.notice().show(),!1;a.form().submit()}}});d.resolve()})});EasySocial.module("site/stream/item",function(){var e=this;EasySocial.require().library("dialog").done(function(d){EasySocial.Controller("Stream.Item",{defaultOptions:{id:"",context:"","{deleteFeed}":"[data-stream-delete]","{hideLink}":"[data-stream-hide]","{unHideLink}":"[data-stream-show]","{hideAppLink}":"[data-stream-hide-app]","{unHideAppLink}":"[data-stream-show-app]",
"{hideNotice}":"[data-stream-hide-notice]","{actions}":"[data-streamItem-actions]","{contents}":"[data-streamItem-contents]","{streamData}":"[data-stream-item]","{likes}":"[data-likes-action]","{counterBar}":"[data-stream-counter]","{likeContent}":"[data-likes-content]","{repostContent}":"[data-repost-content]","{share}":"[data-repost-action]","{streamCommentLink}":"[data-stream-action-comments]","{streamCommentBlock}":"[data-comments]"}},function(b){return{init:function(){b.options.id=b.element.data("id");
b.options.context=b.element.data("context");b.options.ishidden=b.element.data("ishidden")},plugins:{},"{likes} onLiked":function(a,c,d){b.counterBar().removeClass("hide")},"{likes} onUnliked":function(a,c,d){a=b.likeContent().hasClass("hide");c=b.repostContent().hasClass("hide");a&&c&&b.counterBar().addClass("hide")},"{share} create":function(a,c,d){b.counterBar().removeClass("hide")},"{streamCommentLink} click":function(){b.streamCommentBlock().toggle()},"{actions} click":function(a,c){b.actions().removeClass("active");
d(a).addClass("active")},"{deleteFeed} click":function(){var a=b.options.id;EasySocial.dialog({content:EasySocial.ajax("site/views/stream/confirmDelete"),bindings:{"{deleteButton} click":function(){EasySocial.ajax("site/controllers/stream/delete",{id:a}).done(function(a){EasySocial.dialog({content:a});b.element.fadeOut()}).fail(function(a){EasySocial.dialog({content:a})})}}})},"{hideLink} click":function(){b.streamData().addClass("es-feed-loading");EasySocial.ajax("site/controllers/stream/hide",{id:b.options.id}).done(function(a){b.streamData().removeClass("es-feed-loading");
b.streamData().hide();b.element.append(a)}).fail(function(a){})},"{hideAppLink} click":function(){EasySocial.ajax("site/controllers/stream/hideapp",{context:b.options.context}).done(function(a){b.streamData().hide();d(".stream-context-"+b.options.context).addClass("hide-stream");b.element.append(a)}).fail(function(a){console.log(a)})},"{unHideLink} click":function(){EasySocial.ajax("site/controllers/stream/unhide",{id:b.options.id}).done(function(){b.hideNotice().remove();b.streamData().show()}).fail(function(a){console.log(a)})},
"{unHideAppLink} click":function(){EasySocial.ajax("site/controllers/stream/unhideapp",{context:b.options.context}).done(function(){b.hideNotice().remove();b.streamData().show();d(".stream-context-"+b.options.context).removeClass("hide-stream")}).fail(function(a){console.log(a)})}}});e.resolve()})});EasySocial.module("site/stream/sidebar",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Stream.Filter.Sidebar",{defaultOptions:{}},function(a){return{init:function(){},
"{self} click":function(){b("[data-sidebar-item]").removeClass("active loading");a.element.addClass("active");var c=a.element.data("id"),d=a.element.data("url"),e=a.element.data("title");History.pushState({state:1},e,d);a.parent.content().html("");a.parent.updatingContents();a.element.addClass("loading");EasySocial.ajax("site/controllers/stream/getFilter",{id:c}).done(function(b){a.parent.updateContents(b)}).fail(function(a){return a}).always(function(){a.element.removeClass("loading")})}}});d.resolve()})});
EasySocial.module("site/stream/stream",function(){var e=this;EasySocial.require().script("site/stream/item").view("site/loading/small").language("COM_EASYSOCIAL_STREAM_LOAD_PREVIOUS_STREAM_ITEMS").done(function(d){EasySocial.Controller("Stream",{defaultOptions:{interval:30,checknew:null,source:null,sourceId:null,autoload:!0,"{story}":"[data-story]","{share}":"[data-repost-action]","{list}":"[data-stream-list]","{newNotiBar}":"[data-stream-notification-bar]","{newNotiButton}":"[data-stream-notification-button]",
"{item}":"[data-streamItem]","{pagination}":"[data-stream-pagination]","{paginationGuest}":"[data-stream-pagination-guest]",view:{loadingContent:"site/loading/small"}}},function(b){return{init:function(){b.item().addController(EasySocial.Controller.Stream.Item);"stream"!=b.options.source&&"unity"!=b.options.source&&!0==b.options.checknew&&b.startMonitoring();if(!0==b.options.autoload)b.on("scroll.stream",window,d._.debounce(function(){b.loading||("unity"==b.options.source?b.paginationGuest().visible()&&
b.loadMoreGuest():b.pagination().visible()&&b.loadMore())},250));b.setLayout()},setLayout:function(){b.element.find("[data-es-cover]").each(function(){var a=d(this);a.height(a.width()/3)})},"{window} resize":d.debounce(function(){b.setLayout()},500),"{story} create":function(a,c,f,e){d.buildHTML(f).prependTo(b.list()).addController("EasySocial.Controller.Stream.Item");b.list().children("li.empty").remove();b.updateCurrentDate();""!=e&&b.updateExcludeIds(e)},"{share} create":function(a,c,f){d.buildHTML(f).prependTo(b.list()).addController("EasySocial.Controller.Stream.Item");
b.list().children("li.empty").remove();b.updateCurrentDate()},updateCurrentDate:function(){EasySocial.ajax("site/controllers/stream/getCurrentDate",{}).done(function(a){b.element.data("currentdate",a)}).fail(function(a){})},updateExcludeIds:function(a){ids=b.element.data("excludeids");newIds="";newIds=""!=ids&&void 0!=ids?ids+","+a:a;b.element.data("excludeids",newIds)},clearExcludeIds:function(){b.element.data("excludeids","")},startMonitoring:function(){if(b._destroyed)return b.stopMonitoring();
b.options.state=setTimeout(b.check,1E3*b.options.interval)},stopMonitoring:function(){clearTimeout(b.options.state)},"{self} destroyed":function(){b.stopMonitoring()},check:function(){b.stopMonitoring();var a=d("[data-dashboardSidebar-menu].active").data("type"),c=d("[data-dashboardSidebar-menu].active").data("id"),f=b.element.data("currentdate"),e=b.element.data("excludeids");d.trim(b.newNotiBar().html());void 0==a&&void 0==c&&"profile"==b.options.source&&(a="me",c=b.options.sourceId);EasySocial.ajax("site/controllers/stream/checkUpdates",
{type:a,id:c,currentdate:f,exclude:e,source:b.options.source,view:b.options.source},{type:"jsonp"}).done(function(a,c,f){if(b._destroyed)return b.stopMonitoring();if(0<a.length){for(f=0;f<a.length;f++)if(item=a[f],0<item.cnt){var e="[data-stream-counter-"+item.type+"]";d(e).html(item.cnt);d(e).parents("li").addClass("has-notice")}c=d.trim(c);0<c.length&&b.newNotiBar().html(c)}b.startMonitoring()})},"{newNotiButton} click":function(a,c){var f=d(a).data("type"),e=d(a).data("uid"),k=d(a).data("since");
EasySocial.ajax("site/controllers/stream/getUpdates",{type:f,id:e,currentdate:k,source:b.options.source,view:b.options.source}).done(function(a,c){var k="[data-stream-counter-",k="list"==f?k+f+"-"+e:k+f;d(k+"]").parents("li").removeClass("has-notice");b.newNotiBar().html("");d.buildHTML(a).prependTo(b.list()).addController("EasySocial.Controller.Stream.Item");b.clearExcludeIds();b.element.data("currentdate",c)})},"{paginationGuest} click":function(){b.loadMoreGuest()},loadMoreGuest:function(){var a=
b.paginationGuest(),c=a.data("nextlimit"),f=b.options.source;c&&(b.loading=!0,a.html(b.view.loadingContent({content:""})),EasySocial.ajax("site/controllers/stream/loadmoreGuest",{startlimit:c,view:f}).done(function(c,f){a.data({nextlimit:f});c=d.buildHTML(c);c.insertBefore(a).filter(b.item.selector).addController("EasySocial.Controller.Stream.Item");""==f?a.html(""):(link='<a class="btn btn-es-primary btn-stream-updates" href="javascript:void(0);"><i class="ies-refresh"></i> '+d.language("COM_EASYSOCIAL_STREAM_LOAD_PREVIOUS_STREAM_ITEMS")+
"</a>",a.html(link))}).fail(function(a){return a}).always(function(){b.loading=!1}))},"{pagination} click":function(){b.loadMore()},loadMore:function(){var a=d("[data-dashboardSidebar-menu].active"),c=a.data("type"),f=a.data("id");tag=a.data("tag");var e=b.pagination(),a=e.data("startdate"),k=e.data("enddate"),h=b.options.source;a&&(void 0==c&&void 0==f&&"profile"==b.options.source&&(c="me",f=b.options.sourceId),b.loading=!0,e.html(b.view.loadingContent({content:""})),EasySocial.ajax("site/controllers/stream/loadmore",
{id:f,type:c,startdate:a,enddate:k,view:h,tag:tag}).done(function(a,c,f){e.data({startdate:c,enddate:f});a=d.buildHTML(a);a.insertBefore(e).filter(b.item.selector).addController("EasySocial.Controller.Stream.Item");b.setLayout();""==c?e.html(""):(link='<a class="btn btn-es-primary btn-stream-updates" href="javascript:void(0);"><i class="ies-refresh"></i> '+d.language("COM_EASYSOCIAL_STREAM_LOAD_PREVIOUS_STREAM_ITEMS")+"</a>",e.html(link))}).fail(function(a){return a}).always(function(){b.loading=
!1}))}}});e.resolve()})});EasySocial.module("site/stream/video",function(e){e(document).on("click","[data-es-links-embed-item]",function(){var d=e(this),b='<div class="video-container mb-15 mt-15">'+e("<div>").html(d.data("es-stream-embed-player")).html()+"</div>";d.replaceWith(b)});this.resolve()});EasySocial.module("site/subscriptions/follow",function(){var e=this;EasySocial.require().language("COM_EASYSOCIAL_SUBSCRIPTION_INFO").done(function(d){EasySocial.Controller("Follow",{defaultOptions:{}},
function(b){return{init:function(){},"{self} click":function(){EasySocial.ajax("site/controllers/subscriptions/toggle",{uid:b.element.data("id"),type:b.element.data("type"),notify:"1"}).done(function(a,c){b.element.text(c);EasySocial.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_INFO"),content:a})}).fail(function(a){b.setMessage(a,"error")})}}});e.resolve()})});EasySocial.module("site/toolbar/conversations",function(e){var d=this;EasySocial.require().library("tinyscrollbar").done(function(b){EasySocial.Controller("Notifications.Conversations",
{defaultOptions:{interval:30,"{counter}":"[data-notificationConversation-counter]"}},function(a){return{init:function(){a.startMonitoring()},startMonitoring:function(){a.options.state=setTimeout(a.check,1E3*a.options.interval)},stopMonitoring:function(){clearTimeout(a.options.state)},check:function(){a.stopMonitoring();setTimeout(function(){EasySocial.ajax("site/controllers/notifications/getConversationCounter",{},{type:"jsonp"}).done(function(b){0<b?(a.element.addClass("has-notice"),a.counter().html(b)):
a.element.removeClass("has-notice");a.startMonitoring()})},1E3*a.options.interval)}}});d.resolve()})});EasySocial.module("site/toolbar/friends",function(e){var d=this;EasySocial.require().library("tinyscrollbar").language("COM_EASYSOCIAL_FRIENDS_REQUEST_REJECTED").done(function(b){EasySocial.Controller("Notifications.Friends",{defaultOptions:{interval:3,returnURL:"","{counter}":"[data-notificationFriends-counter]","{loadRequestsButton}":".loadRequestsButton"}},function(a){return{init:function(){a.startMonitoring()},
startMonitoring:function(){a.options.state=setTimeout(a.check,1E3*a.options.interval)},stopMonitoring:function(){clearTimeout(a.options.state)},check:function(){a.stopMonitoring();setTimeout(function(){EasySocial.ajax("site/controllers/notifications/friendsCounter",{},{type:"jsonp"}).done(function(b){0<b?(a.element.addClass("has-notice"),a.counter().html(b)):a.element.removeClass("has-notice");a.startMonitoring()})},1E3*a.options.interval)}}});EasySocial.Controller("Notifications.Friends.Item",{defaultOptions:{"{actionsWrapper}":"[data-friend-item-actions]",
"{acceptFriend}":"[data-friend-item-accept]","{rejectFriend}":"[data-friend-item-reject]","{actions}":"[data-friend-item-action]","{title}":"[data-friend-item-title]","{mutual}":"[data-friend-item-mutual]",view:{loader:"site/loading/small"}}},function(a){return{init:function(){},"{acceptFriend} click":function(c,d){d.stopPropagation();a.actionsWrapper().addClass("friend-adding");EasySocial.ajax("site/controllers/friends/approve",{viewCallback:"notificationsApprove",id:b(c).data("id")}).done(function(b,
c){a.actionsWrapper().removeClass("friend-adding").addClass("added-friends");a.title().html(b);a.mutual().html(c)}).fail(function(b){a.element.html(b.message)})},"{rejectFriend} click":function(c,d){d.stopPropagation();EasySocial.ajax("site/controllers/friends/reject",{id:b(c).data("id")}).done(function(c){a.actionsWrapper().html(b.language("COM_EASYSOCIAL_FRIENDS_REQUEST_REJECTED"))}).fail(function(b){a.element.html(b.message)})}}});d.resolve()})});EasySocial.module("site/toolbar/login",function(e){var d=
this;EasySocial.require().library("popbox").done(function(b){EasySocial.Controller("Toolbar.Login",{defaultOptions:{"{dropdown}":"[data-toolbar-login-dropdown]"}},function(a){return{init:function(){var b=a.dropdown().html();a.dropdown().remove();a.element.popbox({content:b,id:"es-wrap",type:"toolbar",toggle:"click",position:"bottom-right",collision:"flip none"}).attr("data-popbox","")},"{self} popboxActivate":function(a,d,e){b(e.tooltip).find("label").on("click",function(a){a.stopPropagation()})}}});
d.resolve()})});EasySocial.module("site/toolbar/notifications",function(e){var d=this;EasySocial.require().script("site/toolbar/friends","site/toolbar/story","site/toolbar/system","site/toolbar/profile","site/toolbar/login","site/toolbar/conversations").done(function(b){EasySocial.Controller("Notifications",{defaultOptions:{friendsInterval:30,systemInterval:30,"{friendNotifications}":"[data-notifications-friends]","{conversationNotifications}":"[data-notifications-conversations]","{systemNotifications}":"[data-notifications-system]",
"{profileItem}":"[data-toolbar-profile]","{storyForm}":"[data-toolbar-story]","{login}":"[data-toolbar-login]","{item}":"[data-toolbar-item]"}},function(a){return{init:function(){a.login().addController(EasySocial.Controller.Toolbar.Login);a.profileItem().addController(EasySocial.Controller.Toolbar.Profile,{interval:a.options.systemInterval});a.systemNotifications().addController(EasySocial.Controller.Notifications.System,{interval:a.options.systemInterval});a.friendNotifications().addController(EasySocial.Controller.Notifications.Friends,
{interval:a.options.friendsInterval});a.conversationNotifications().addController(EasySocial.Controller.Notifications.Conversations,{interval:a.options.friendsInterval});a.storyForm().addController(EasySocial.Controller.Notifications.Story);a.setLayout();b("body").on("click.out-of-dropdown",function(){a.item().removeClass("open")})},"{window} resize":b.debounce(function(){a.setLayout()},250),setLayout:function(){var c=a.element,d=c.outerWidth(!0)-80,e=0;a.item().each(function(){e+=b(this).outerWidth(!0)});
d=e>d;c.toggleClass("narrow",d).toggleClass("wide",!d)}}});d.resolve()})});EasySocial.module("site/toolbar/story",function(e){var d=this;EasySocial.require().done(function(b){EasySocial.Controller("Notifications.Story",{defaultOptions:{"{loadFormButton}":".loadFormButton","{dropdown}":".dropdown-menu"}},function(a){return{init:function(){},"{dropdown} click":function(a,b){},"{self} hideDropdown":function(){},"{dropdown} click":function(a,b){b.stopPropagation()}}});d.resolve()})});EasySocial.module("site/toolbar/system",
function(e){var d=this;EasySocial.require().view("site/notifications/system.empty").library("tinyscrollbar").done(function(b){EasySocial.Controller("Notifications.System",{defaultOptions:{interval:30,"{counter}":"[data-notificationSystem-counter]"}},function(a){return{init:function(){a.startMonitoring()},startMonitoring:function(){a.options.state=setTimeout(a.check,1E3*a.options.interval)},stopMonitoring:function(){clearTimeout(a.options.state)},check:function(){a.stopMonitoring();setTimeout(function(){EasySocial.ajax("site/controllers/notifications/getSystemCounter",
{},{type:"jsonp"}).done(function(b){0<b?(a.element.addClass("has-notice"),a.counter().html(b)):a.element.removeClass("has-notice");a.startMonitoring()})},1E3*a.options.interval)},"{window} easysocial.clearSystemNotification":function(){a.element.removeClass("has-notice");a.counter().html(0)}}});EasySocial.Controller("Notifications.System.Popbox",{defaultOptions:{"{readall}":"[data-notificationsystem-readall]","{items}":"[data-notificationsystem-items]",view:{empty:"site/notifications/system.empty"}}},
function(a){return{init:function(){},"{readall} click":function(){EasySocial.ajax("site/controllers/notifications/setAllState",{state:"read"}).done(function(){a.items().html("");a.items().append(a.view.empty());b(window).trigger("easysocial.clearSystemNotification")})}}});d.resolve()})});EasySocial.module("site/toolbar/profile",function(e){var d=this;EasySocial.require().library("popbox").done(function(b){EasySocial.Controller("Toolbar.Profile",{defaultOptions:{"{dropdown}":"[data-toolbar-profile-dropdown]"}},
function(a){return{init:function(){var b=a.dropdown().html();a.element.popbox({content:b,id:"es-wrap",type:"toolbar",toggle:"click",position:"bottom-right",collision:"flip none"}).attr("data-popbox","")},"{self} popboxActivate":function(a,d,e){b(e.tooltip).implement(EasySocial.Controller.Toolbar.Profile.Logout)}}});EasySocial.Controller("Toolbar.Profile.Logout",{defaultOptions:{"{logoutForm}":"[data-toolbar-logout-form]","{logoutButton}":"[data-toolbar-logout-button]"}},function(a){return{logout:function(){a.logoutForm().submit()},
"{logoutButton} click":function(){a.logout()}}});d.resolve()})});EasySocial.module("site/users/users",function(e){var d=this;EasySocial.require().library("history").view("site/loading/small").done(function(b){EasySocial.Controller("Users",{defaultOptions:{"{content}":"[data-users-content]","{listing}":"[data-users-listing]","{sort}":"[data-users-sort]","{filter}":"[data-users-filter]","{items}":"[data-users-item]","{pagination}":"[data-users-pagination]",view:{loading:"site/loading/small"}}},function(a){return{init:function(){a.initUserController()},
initUserController:function(){a.items().implement(EasySocial.Controller.Users.Item,{"{parent}":a})},"{filter} click":function(c,d){d.preventDefault();a.sort().removeClass("active");a.filter().each(function(){b(this).parent().removeClass("active")});b(c).parent().addClass("active");var e=b(c).data("filter");a.options.filter=e;b(c).route();a.listing().html(a.view.loading());a.sort(":first").addClass("active");EasySocial.ajax("site/controllers/users/getUsers",{filter:e,showpagination:1}).done(function(b){a.content().html(b);
a.initUserController()})},"{sort} click":function(c,d){d.preventDefault();var e=b(c).data("type");b("<a>").attr({title:document.title,href:b(c).attr("href")}).route();a.sort().removeClass("active");b(c).addClass("active");a.listing().html(a.view.loading());a.pagination().remove();EasySocial.ajax("site/controllers/users/getUsers",{sort:e,filter:a.options.filter,isSort:!0,showpagination:1}).done(function(b){a.listing().html(b);a.initUserController()})}}});EasySocial.Controller("Users.Item",{defaultOptions:{id:null,
"{addFriend}":"[data-users-add-friend]","{friendsButton}":"[data-users-friends-button]","{compose}":"[data-users-friends-compose]","{unfriend}":"[data-users-friends-unfriend]"}},function(a){return{init:function(){a.options.id=a.element.data("id")},"{addFriend} click":function(c,d){b(c).addClass("btn-loading");EasySocial.ajax("site/controllers/friends/request",{viewCallback:"usersRequest",id:a.options.id}).done(function(a){b(c).replaceWith(a);b(c).removeClass("btn-loading")})}}});d.resolve()})});EasySocial.module("story",
function(e){var d=this;EasySocial.require().language("COM_EASYSOCIAL_WITH_FRIENDS","COM_EASYSOCIAL_AND_ONE_OTHER","COM_EASYSOCIAL_AND_MANY_OTHERS","COM_EASYSOCIAL_LOCATION_PERMISSION_ERROR").view("apps/user/links/story/attachment.item","apps/user/locations/suggestion","site/albums/upload.item","site/friends/suggest.item","site/friends/suggest.hint.search","site/friends/suggest.hint.empty").done();EasySocial.require().library("mentions").script("site/stream/item").language("COM_EASYSOCIAL_STORY_SUBMIT_ERROR",
"COM_EASYSOCIAL_STORY_CONTENT_EMPTY","COM_EASYSOCIAL_STORY_NOT_ON_STREAM_FILTER").done(function(){EasySocial.Controller("Story",{defaultOptions:{view:{suggestItem:"site/friends/suggest.item"},plugin:{},attachment:{limit:1,lifo:!0},"{header}":"[data-story-header]","{body}":"[data-story-body]","{footer}":"[data-story-footer]","{form}":"[data-story-form]","{textbox}":"[data-story-textbox]","{textField}":"[data-story-textField]","{target}":"[data-story-target]","{submitButton}":"[data-story-submit]",
"{resetButton}":"[data-story-reset]","{privacyButton}":"[data-story-privacy]","{panelContents}":"[data-story-panel-contents]","{panelContent}":"[data-story-panel-content]","{panelButton}":"[data-story-panel-button]","{attachmentContainer}":"[data-story-attachment-container]","{attachmentIcon}":"[data-story-attachment-icon]","{attachmentButtons}":"[data-story-attachment-buttons]","{attachmentButton}":"[data-story-attachment-button]","{attachmentItems}":"[data-story-attachment-items]","{attachmentItem}":"[data-story-attachment-item]",
"{attachmentContent}":"[data-story-attachment-content]","{attachmentToolbar}":"[data-story-attachment-toolbar]","{attachmentDragHandle}":"[data-story-attachment-drag-handle]","{attachmentRemoveButton}":"[data-story-attachment-remove-button]","{attachmentClearButton}":"[data-story-attachment-clear-button]","{attachmentPanelIcon}":"[data-story-attachment-panel-icon]","{attachmentPanelCaption}":"[data-story-attachment-panel-caption]","{streamContainer}":"[data-streams]","{streamItem}":"[data-streamItem]"},
hostname:"story"},function(b,a,c){return{init:function(){c=b.element;window.___story=b;b.id=b.element.data("story");e.each(b.options.plugin,function(a,c){var d=b.plugins[a]=c;"attachment"==d.type&&b.attachments.max++;d.selector=b.getPluginSelector(a)});b.setMentionsLayout();e.module("story-"+b.id).resolve(b)},"{self} click":function(a,c){0<e(c.target).parents().andSelf().filter(b.resetButton()[0]).length||b.expand()},"{textField} touchstart":function(){b.expand()},"{textField} keydown":function(a,
c){b.expand()},"{textField} click":function(){b.expand()},"{textField} mousedown":function(a,c){b.expand()},expand:e.debounce(function(){c.hasClass("active")?b.submitButton().removeAttr("data-disabled"):(c.addClass("active"),setTimeout(function(){c.addTransitionClass("no-transition").addClass("expanded");b.setMentionsLayout();b.submitButton().removeAttr("data-disabled");b.textField().focus()},500))},1),collapse:function(){b.submitButton().attr("data-disabled","true");c.addTransitionClass("no-transition").removeClass("expanded");
setTimeout(function(){c.removeClass("active")},0)},setMentionsLayout:function(){var a=b.textbox(),c=a.controller("mentions");if(c)c.cloneLayout();else{var d=b.header();a.mentions({triggers:{"@":{type:"entity",wrap:!1,stop:"",allowSpace:!0,finalize:!0,query:{emptyHint:!0,loadingHint:!0,searchHint:!0,data:function(a){var c=e.Deferred();EasySocial.ajax("site/controllers/friends/suggest",{search:a}).done(function(a){e.isArray(a)||c.reject();a=e.map(a,function(a){a.title=a.screenName;a.type="user";a.menuHtml=
b.view.suggestItem(!0,{item:a,name:"uid[]"});return a});c.resolve(a)}).fail(c.reject);return c}}},"#":{type:"hashtag",wrap:!0,stop:" #",allowSpace:!1}},plugin:{autocomplete:{id:"es-wrap",position:{my:"left top",at:"left bottom",of:d,collision:"none"},size:{width:function(){return d.width()}},view:{searchHint:"easysocial/site/friends/suggest.hint.search",emptyHint:"easysocial/site/friends/suggest.hint.empty"}}}})}},plugins:{},getPluginName:function(a){return e(a).data("story-plugin-name")},getPluginSelector:function(a){return"[data-story-plugin-name="+
a+"]"},hasPlugin:function(a,c){var d=b.plugins[a];return d?c?d.type===c:!0:!1},buildPluginSelectors:function(a,c,d){var h={};e.each(a,function(a,f){var e=b[f].selector+c.selector;"function"==d?h[f]=function(){return b.find(e)}:h["{"+f+"}"]=e});return h},"{self} addPlugin":function(a,c,d,h,l,m){if(b.hasPlugin(d)){a=b.plugins[d];c={};switch(a.type){case "attachment":c=b.buildPluginSelectors("attachmentIcon attachmentButton attachmentItem attachmentContent attachmentToolbar attachmentDragHandle attachmentRemoveButton".split(" "),
a,m);break;case "panel":c=b.buildPluginSelectors(["panelButton","panelContent"],a,m)}e.extend(l,c)}},"{self} registerPlugin":function(a,c,d,e){b.hasPlugin(d)&&(b.plugins[d].instance=e)},panels:{},currentPanel:null,getPanel:function(a){if(b.hasPlugin(a,"panel"))return a=b.plugins[a],b.panels[a.name]||(b.panels[a.name]={plugin:a,button:b.panelButton(a.selector),content:b.panelContent(a.selector)})},togglePanel:function(a){var c=b.currentPanel;c&&b.deactivatePanel(c);c!==a&&b.activatePanel(a)},activatePanel:function(a){var c=
b.getPanel(a);if(c){b.deactivatePanel(b.currentPanel);var d=b.panelContents();d.addClass("active");c.button.addClass("active");c.content.appendTo(d).addClass("active");b.invokePlugin(a,"activatePanel",[c]);b.trigger("activatePanel",[a])}},deactivatePanel:function(a){var c=b.getPanel(a);c&&(c.button.removeClass("active"),c.content.removeClass("active"),b.panelContents().removeClass("active"),b.invokePlugin(a,"deactivatePanel",[c]),b.trigger("deactivatePanel",[a]))},addPanelCaption:function(a,c){var d=
b.getPanel(a);d&&d.button.addClass("has-data").find(".with-data").html(c)},removePanelCaption:function(a){(a=b.getPanel(a))&&a.button.removeClass("has-data").find(".with-data").empty()},"{self} activatePanel":function(a,c,d){b.currentPanel=d},"{self} deactivatePanel":function(a,c,d){b.currentPanel===d&&(b.currentPanel=null)},"{panelButton} click":function(a,c){var d=b.getPluginName(a);b.togglePanel(d)},attachments:{length:0,max:0},currentAttachment:null,getAttachment:function(a){if(b.hasPlugin(a,
"attachment"))return b.attachments[a]},addAttachment:function(a){if(!b.hasPlugin(a,"attachment"))return!1;var c=b.plugins[a],d=b.attachments,e=d[a];if(e)return e;var l=function(){var e={plugin:c,button:b.attachmentButton(c.selector),icon:b.attachmentIcon(c.selector)};e.item=b.attachmentItem(c.selector).prependTo(b.attachmentItems());d[c.name]=e;d.length++;b.invokePlugin(a,"addAttachment",[e]);b.trigger("addAttachment",[e])},m=b.options.attachment,n=m.lifo;if(0<m.limit&&d.length>=m.limit)return n?
(l(),l=b.getPluginName(b.attachmentItem(":last")),b.removeAttachment(l),e):!1;l();return e},removeAttachment:function(a){var c=b.getAttachment(a);if(c)return b.invokePlugin(a,"removeAttachment",[c]),b.trigger("removeAttachment",[c]),c.icon.removeClass("active"),c.button.removeClass("active"),setTimeout(function(){c.item.removeClass("active")},0),delete b.attachments[a],b.attachments.length--,b.invokePlugin(a,"destroyAttachment",[c]),b.trigger("destroyAttachment",[c]),c},clearAttachment:function(){var a=
e.map(b.attachments,function(a,c){if(!/length|max/.test(c))return b.removeAttachment(c),c});b.trigger("clearAttachment",[a])},activateAttachment:function(a){var c=b.getAttachment(a);c&&(b.deactivateAttachment(b.currentAttachment),c.icon.addClass("active"),c.button.addClass("active"),setTimeout(function(){c.item.addClass("active")},0),b.invokePlugin(a,"activateAttachment",[c]),b.trigger("activateAttachment",[c]))},deactivateAttachment:function(a){var c=b.attachments[a];c&&(c.icon.removeClass("active"),
c.button.removeClass("active"),setTimeout(function(){c.item.removeClass("active")},0),b.invokePlugin(a,"deactivateAttachment",[c]),b.trigger("deactivateAttachment",[c]))},"{self} activateAttachment":function(a,c,d){a=d.plugin.name;b.currentAttachment=a;b.body().addClass("active");b.element.addClass("attaching-"+a);a=b.getPanel("attachments");c=d.button.find("[data-story-attachment-icon]").attr("class");attachmentCaption=d.button.find("[data-story-attachment-caption]").text();a.button.addClass("has-data");
b.attachmentPanelIcon().attr("class",c);b.attachmentPanelCaption().text(attachmentCaption)},"{self} deactivateAttachment":function(a,c,d){a=d.plugin.name;b.currentAttachment===a&&(b.currentAttachment=null);b.body().removeClass("active");b.element.removeClass("attaching-"+a)},"{attachmentButton} click":function(a,c){var d=b.getPluginName(a);"attachments"==b.currentPanel&&b.deactivatePanel("attachments");(b.getAttachment(d)||b.addAttachment(d))&&b.activateAttachment(d)},"{attachmentClearButton} click":function(){b.clearAttachment();
b.textField().focus()},"{self} addAttachment":function(a,c,d){b.activateAttachment(d.plugin.name)},"{self} removeAttachment":function(a,c,d){b.element.removeClass("attaching-"+d.plugin.name)},"{self} destroyAttachment":function(a,c,d){1>b.attachments.length&&(b.body().removeClass("active"),a=b.getPanel("attachments"),c=b.attachmentPanelIcon(),d=b.attachmentPanelCaption(),a.button.removeClass("has-data"),c.attr("class",c.data("defaultIcon")),d.text(""))},"{self} clearAttachment":function(){"attachments"==
b.currentPanel&&b.deactivatePanel("attachments")},"{attachmentRemoveButton} click":function(a,c){var d=b.getPluginName(a);b.removeAttachment(d)},saving:!1,save:function(){if(!b.saving){b.saving=!0;var a=e.Deferred();a.data={};a.tasks=[];a.addData=function(c,d){var h=c.options.name;if("attachment"==c.options.type){if(h!==b.currentAttachment)return;a.data.attachment=b.currentAttachment}e.isPlainObject(d)?e.each(d,function(b,c){a.data[h+"_"+b]=c}):a.data[h]=d};a.addTask=function(b){var c=e.Deferred();
c.name=b;c.save=a;a.tasks.push(c);return c};a.process=function(){"pending"===a.state()&&e.when.apply(e,a.tasks).done(function(){e.trim(a.data.content)||a.data.attachment?a.resolve():a.reject(e.language("COM_EASYSOCIAL_STORY_CONTENT_EMPTY"),"warning")}).fail(a.reject);return a};b.trigger("save",[a]);b.element.addClass("saving");a.process().done(function(){var c=b.textbox().mentions("controller").toArray(),d=b.element.data("storyHashtags"),d=d?d.split(","):[],h=!1;0<d.length&&(h=1>e.map(c,function(a){if("hashtag"===
a.type&&-1<e.inArray(a.value,d))return a}).length);EasySocial.ajax("site/controllers/story/create",a.data).done(function(a,c){h&&(a=b.setMessage(e.language("COM_EASYSOCIAL_STORY_NOT_ON_STREAM_FILTER")));b.trigger("create",[a,c]);b.clear()}).fail(function(a){b.trigger("fail",arguments);a&&b.setMessage(a.message,a.type)}).always(function(){b.element.removeClass("saving");b.saving=!1})}).fail(function(a,c){a||(a=e.language("COM_EASYSOCIAL_STORY_SUBMIT_ERROR"),c="error");b.setMessage(a,c);b.element.removeClass("saving");
b.saving=!1})}},clear:function(){b.textField().val("");b.trigger("clear");b.clearMessage();b.clearAttachment();b.deactivatePanel(b.currentPanel);var a=b.textbox().mentions("controller");a.reset();setTimeout(function(){a.cloneLayout()},500);b.textField().focus()},"{self} save":function(a,c,d){a=b.textField().val();d=d.data;d.content=a;d.target=b.target().val();d.privacy=b.find("[data-privacy-hidden]").val();d.privacyCustom=b.find("[data-privacy-custom-hidden]").val();d.mentions=b.textbox().mentions("controller").toArray(!0)},
"{submitButton} click":function(a,c){a.attr("data-disabled")?b.expand():b.save()},"{resetButton} click":function(){b.clear();""===b.textField().val()&&b.collapse()},"{privacyButton} click":function(a){setTimeout(function(){var c=a.find("[data-es-privacy-container]").hasClass("active");b.footer().toggleClass("allow-overflow",c)},1)}}});d.resolve()})});EasySocial.module("story/friends",function(e){var d=this;EasySocial.require().library("textboxlist").language("COM_EASYSOCIAL_WITH_FRIENDS","COM_EASYSOCIAL_AND_ONE_OTHER",
"COM_EASYSOCIAL_AND_MANY_OTHERS").done(function(){EasySocial.Controller("Story.Friends",{defaultOptions:{"{friendList}":".es-story-friends-textbox",showSummary:!1,summarizeNamesAfter:2,concatNamesWith:", "}},function(b){return{init:function(){b.friendList().textboxlist({plugin:{autocomplete:{exclusive:!0,cache:!1,query:b.search,filterItem:b.createMenuItem}}})},search:function(a){var c=b.getTaggedUsers();return EasySocial.ajax("site/controllers/friends/suggest",{search:a,exclude:c})},getTaggedUsers:function(){var a=
[],b=e("[data-textboxlist-item]");0<b.length&&e.each(b,function(b,c){a.push(e(c).data("id"))});return a},createMenuItem:function(a,b){a.title=a.screenName;var d=e(new Image).addClass("textboxlist-menu-avatar").attr({src:a.avatar}).toHTML();a.html=d+" "+a.title;a.menuHtml=d+" "+a.title;return a},updatePanelCaption:function(){var a=b.options,c=b.friendList().controller("textboxlist").getAddedItems(),d=c.length,g=a.summarizeNamesAfter,k=Math.max(g-1,d-1),g=d-g;a.showFriendSummary&&(d=e.language("COM_EASYSOCIAL_WITH_FRIENDS",
e.map(c.slice(0,k),function(a){return a.screenName}).join(a.concatNamesWith)),1==g&&(d+=e.language("COM_EASYSOCIAL_AND_ONE_OTHER")),1<g&&(d+=e.language("COM_EASYSOCIAL_AND_MANY_OTHERS",g)));b.story.addPanelCaption("friends",d)},"{friendList} addItem":function(){b.updatePanelCaption()},"{friendList} removeItem":function(){b.updatePanelCaption()},mention:function(a,c,d){b.search(c).done(function(a){var b=[];e.each(a,function(a,c){b.push({id:c.id,name:c.screenName,avatar:c.avatar,type:"contact"})});
d(b)})},"{story} save":function(a,c,d){a=b.friendList().controller("textboxlist").getAddedItems().map(function(a){return a.id});d.addData(b,{tags:a})},"{story} clear":function(){b.friendList().controller("textboxlist").clearItems()}}});d.resolve()})});EasySocial.module("story/links",function(e){var d=this;EasySocial.require().view("apps/user/links/story/attachment.item").done(function(){EasySocial.Controller("Story.Links",{defaultOptions:{view:{linkItem:"apps/user/links/story/attachment.item"},urlParser:/(^|\s)((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/gi,
"{linkForm}":"[data-story-link-form]","{linkInput}":"[data-story-link-input]","{linkContent}":"[data-story-link-content]","{linkItem}":"[data-story-link-item]","{linkTitle}":"[data-story-link-title]","{linkDescription}":"[data-story-link-description]","{linkImages}":"[data-story-link-images]","{linkImage}":"[data-story-link-image]","{linkVideo}":"[data-story-link-video]","{titleTextfield}":"[data-story-link-title-textfield]","{descriptionTextfield}":"[data-story-link-description-textfield]","{attachButton}":"[data-story-link-attach-button]",
"{removeButton}":"[data-story-link-remove-button]","{removeThumbnail}":"[data-story-link-remove-image]"}},function(b){return{init:function(){},activateAttachment:function(){b.doNotFocus||setTimeout(function(){b.linkInput().focus();b.doNotFocus=!1},500)},links:{},currentLink:null,crawling:!1,extractUrls:function(a){a=a.match(b.options.urlParser);return e.isArray(a)?e.map(a,function(a,b){return e.trim(a)}):[]},fixUrl:function(a){a=e.uri(a);/http|https/.test(a.protocol())||a.setProtocol("http");return a.toString()},
getLink:function(a){e.isString(a)&&(a=b.extractUrls(a));if(!(0>a.length))return a=a[0],link=b.links[a]||b.createLink(a)},createLink:function(a){var c=b.links[a]=e.Deferred();c.url=a;b.crawling=!0;EasySocial.ajax("site/controllers/crawler/fetch",{urls:[a]}).done(function(d){(d=d[a])||c.reject();c.info=d;var e=d.opengraph||{},k=d.oembed||{};c.data={title:k.title||e.title||d.title,desc:k.description||e.desc||d.description,url:a,images:(k.thumbnail?[k.thumbnail]:d.images)||(e.image?[e.image]:d.images)||
[],video:e.video?e.video:d.videos};c.item=b.view.linkItem(c.data).data("link",c);c.item.addController("EasySocial.Controller.Story.Links.Item");c.resolve(c)}).fail(function(){c.reject()}).always(function(){b.crawling=!1});return c},addLink:function(a){b.linkContent().empty().append(a.item);b.linkForm().hide();b.currentLink=a},removeLink:function(){b.linkItem().detach();b.linkForm().show();b.currentLink=null},"{attachButton} click":function(){b.linkInput();var a=b.linkForm(),c=e.trim(b.linkInput().val());
""!==c&&(c=b.fixUrl(c),b.linkInput().val(c),a.addClass("busy"),b.getLink(c).done(function(a){b.addLink(a)}).always(function(){a.removeClass("busy")}))},"{removeButton} click":function(a){b.currentLink.disabled=!0;b.removeLink()},"{story.textField} input":e._.debounce(function(a,c){if(!b.currentLink&&!b.crawling){var d=a.val(),d=b.extractUrls(d);if(d=d[d.length-1]){var d=b.fixUrl(d),e=b.links[d];e&&e.disabled||(b.linkInput().val(d),b.doNotFocus=!0,b.attachmentButton().click(),b.attachButton().click())}}},
750),"{story} save":function(a,c,d){b.currentLink&&(a={title:b.titleTextfield().val(),description:b.descriptionTextfield().val(),url:b.currentLink.url,video:b.linkVideo().val()},b.removeThumbnail().is(":checked")||(a.image=b.linkImage(".active").attr("src")),d.addData(b,a))},"{story} clear":function(){b.linkInput().val("");b.removeLink()}}});EasySocial.Controller("Story.Links.Item",{defaultOptions:{"{previousImage}":"[data-story-link-image-prev]","{nextImage}":"[data-story-link-image-next]","{image}":"[data-story-link-image]",
"{imagesWrapper}":"[data-story-link-images]","{imageIndex}":"[data-story-link-image-index]","{removeThumbnail}":"[data-story-link-remove-image]","{title}":"[data-story-link-title]","{description}":"[data-story-link-description]","{titleTextfield}":"[data-story-link-title-textfield]","{descriptionTextfield}":"[data-story-link-description-textfield]"}},function(b){return{init:function(){},"{removeThumbnail} click":function(){var a=b.removeThumbnail().is(":checked");a?b.imagesWrapper().hide():b.imagesWrapper().show();
b.element.toggleClass("has-images",!a)},"{previousImage} click":function(){var a=b.image(".active").prev(),c=b.image(".active"),d=parseInt(b.imageIndex().html())-1;0<a.length&&(e(c).removeClass("active"),e(a).addClass("active"),b.imageIndex().html(d))},"{nextImage} click":function(){var a=b.image(".active").next(),c=b.image(".active"),d=parseInt(b.imageIndex().html())+1;0<a.length&&(e(c).removeClass("active"),e(a).addClass("active"),b.imageIndex().html(d))},"{title} click":function(){var a=b.element.hasClass("editing-title");
b.element.toggleClass("editing-title",!a);a||b.editTitle()},editTitleEvent:"click.es.story.editLinkTitle",editTitle:function(){b.element.addClass("editing-title");setTimeout(function(){b.titleTextfield().val(b.title().text()).focus()[0].select();e(document).on(b.editTitleEvent,function(a){a.target!==b.titleTextfield()[0]&&b.saveTitle("save")})},1)},saveTitle:function(a){a||(a=save);var c=b.titleTextfield().val();switch(a){case "save":""===c&&(c=b.title().data("default")),b.title().html(c)}b.element.removeClass("editing-title");
e(document).off(b.editTitleEvent)},"{titleTextfield} keyup":function(a,c){27==c.keyCode&&b.saveTitle("revert")},"{description} click":function(){var a=b.element.hasClass("editing-description");b.element.toggleClass("editing-description",!a);a||b.editDescription()},editDescriptionEvent:"click.es.story.editLinkDescription",editDescription:function(){b.element.addClass("editing-description");setTimeout(function(){var a=b.description().clone(),c=a.hasClass("no-description");a.wrapInner(b.descriptionTextfield());
c&&b.descriptionTextfield().val("");b.descriptionTextfield().expandingTextarea();b.descriptionTextfield().focus()[0].select();e(document).on(b.editDescriptionEvent,function(a){a.target!==b.descriptionTextfield()[0]&&b.saveDescription("save")})},1)},saveDescription:function(a){a||(a=save);var c=b.descriptionTextfield().val().replace(/\n/g,"<br//>");switch(a){case "save":a=""===c,b.description().toggleClass("no-description",a),a&&(c=b.descriptionTextfield().attr("placeholder")),b.description().html(c)}b.descriptionTextfield().expandingTextarea("destroy");
b.element.find(".textareaClone").remove();b.element.removeClass("editing-description");e(document).off(b.editDescriptionEvent)},"{descriptionTextfield} keyup":function(a,c){27==c.keyCode&&b.saveDescription("revert")}}});d.resolve()})});EasySocial.module("story/locations",function(e){var d=this;EasySocial.require().library("gmaps","scrollTo").view("apps/user/locations/story/suggestion").language("COM_EASYSOCIAL_LOCATION_PERMISSION_ERROR","COM_EASYSOCIAL_LOCATION_TIMEOUT_ERROR","COM_EASYSOCIAL_LOCATION_UNAVAILABLE_ERROR").done(function(){EasySocial.Controller("Story.Locations",
{defaultOptions:{view:{suggestion:"apps/user/locations/suggestion"},map:{lat:0,lng:0},"{form}":"[data-story-location-form]","{textField}":"[data-story-location-textField]","{detectButton}":"[data-story-location-detect-button]","{autocomplete}":"[data-story-location-autocomplete]","{suggestions}":"[data-story-location-suggestions]","{suggestion}":"[data-story-location-suggestion]","{viewport}":"[data-story-location-viewport]","{textbox}":"[data-story-location-textbox]","{removeButton}":"[data-story-location-remove-button]"}},
function(b){return{init:function(){navigator.geolocation&&b.detectButton().show();b.textField().removeAttr("disabled")},"{window} resize":e.debounce(function(){var a=b.currentLocation;if(a){var c=b.viewport();c.data("width")!==c.width()&&(c=a.geometry.location,a=c.lat(),c=c.lng(),b.navigate(a,c))}},250),navigate:function(a,c){var d=b.viewport(),g=d.width(),d=d.height(),k=e.GMaps.staticMapURL({size:[g,d],lat:a,lng:c,markers:[{lat:a,lng:c}]});b.viewport().css({backgroundImage:e.cssUrl(k)}).data({width:g,
height:d});b.form().addClass("has-location")},locations:{},lastQueryAddress:null,"{textField} keypress":function(a,c){switch(c.keyCode){case 38:var d=e(b.suggestion(".active").prev(b.suggestion.selector)[0]||b.suggestion(":last")[0]);b.suggestion().removeClass("active");d.addClass("active").trigger("activate");b.suggestions().scrollTo(d,{offset:-1*d.height()});c.preventDefault();break;case 40:d=e(b.suggestion(".active").next(b.suggestion.selector)[0]||b.suggestion(":first")[0]);b.suggestion().removeClass("active");
d.addClass("active").trigger("activate");b.suggestions().scrollTo(d,{offset:-1*d.height()});c.preventDefault();break;case 13:d=b.suggestion(".active").data("location");b.set(d);b.hideSuggestions();break;case 27:b.hideSuggestions()}},"{textField} keyup":function(a,c){switch(c.keyCode){case 38:case 40:case 37:case 39:case 13:case 27:break;default:var d=e.trim(a.val());""===d&&(b.form().removeClass("has-location"),b.hideSuggestions());var g=b.locations[d];g?(b.lastQueryAddress=d,b.suggest(g)):b.lookup(d)}},
lookup:e._.debounce(function(a){b.textbox().addClass("busy");e.GMaps.geocode({address:a,callback:function(c,d){b.textbox().removeClass("busy");"OK"==d&&(b.locations[a]=c,b.suggest(c),b.lastQueryAddress=a)}})},250),suggest:function(a){var c=b.suggestions();c.empty();0>a.length||(e.each(a,function(a,d){b.view.suggestion({location:d}).data("location",d).appendTo(c)}),b.showSuggestions())},showSuggestions:function(){b.focusSuggestion=!0;b.element.find(".es-story-footer").addClass("swap-zindex");setTimeout(function(){b.autocomplete().addClass("active")},
500)},hideSuggestions:function(){b.focusSuggestion=!1;b.autocomplete().removeClass("active");setTimeout(function(){b.focusSuggestion||b.element.find(".es-story-footer").removeClass("swap-zindex")},500)},"{suggestion} activate":function(a,c){var d=a.data("location");b.navigate(d.geometry.location.lat(),d.geometry.location.lng())},"{suggestion} mouseover":function(a){b.suggestion().removeClass("active");a.addClass("active").trigger("activate")},"{suggestion} click":function(a,c){var d=a.data("location");
b.set(d);b.hideSuggestions()},set:function(a){b.currentLocation=a;b.navigate(a.geometry.location.lat(),a.geometry.location.lng());var c=a.formatted_address;b.textField().val(c);b.lastQueryAddress=c;b.story.addPanelCaption("locations",a.formatted_address);b.form().addClass("has-location")},unset:function(){b.currentLocation=null;b.textField().val("");b.story.removePanelCaption("locations");b.viewport().css("backgroundImage","");b.form().removeClass("has-location")},activatePanel:function(){setTimeout(function(){b.textField().focus()},
500)},deactivatePanel:function(){var a=b.currentLocation;a&&b.set(a)},detectTimer:null,"{detectButton} click":function(){var a=b.story,c=b.textbox();c.addClass("busy");clearTimeout(b.detectTimer);b.detectTimer=setTimeout(function(){a.setMessage(e.language("COM_EASYSOCIAL_LOCATION_PERMISSION_ERROR"));c.removeClass("busy")},8E3);e.GMaps.geolocate({success:function(c){a.clearMessage();e.GMaps.geocode({lat:c.coords.latitude,lng:c.coords.longitude,callback:function(a,c){"OK"==c&&(b.suggest(a),b.textField().focus())}})},
error:function(b){var c="";switch(b.code){case 1:c=e.language("COM_EASYSOCIAL_LOCATION_PERMISSION_ERROR");break;case 2:c=e.language("COM_EASYSOCIAL_LOCATION_TIMEOUT_ERROR");break;default:c=e.language("COM_EASYSOCIAL_LOCATION_UNAVAILABLE_ERROR")}a.setMessage(c)},always:function(){clearTimeout(b.detectTimer);c.removeClass("busy")}})},"{removeButton} click":function(){b.unset();b.hideSuggestions()},"{story} save":function(a,c,d){(a=b.currentLocation)&&d.addData(b,{short_address:a.address_components[0].long_name,
formatted_address:a.formatted_address,lat:a.geometry.location.lat(),lng:a.geometry.location.lng()})},"{story} clear":function(){b.unset();b.hideSuggestions()}}});d.resolve()})});EasySocial.module("story/photos",function(e){var d=this;EasySocial.require().script("albums/uploader").done(function(){EasySocial.Controller("Story.Photos",{defaultOptions:{"{albumView}":"[data-album-view]","{albumContent}":"[data-album-content]","{uploadButton}":"[data-album-upload-button]","{photoItemGroup}":"[data-photo-item-group]",
"{photoItem}":"[data-photo-item]","{photoImage}":"[data-photo-image]","{photoRemoveButton}":"[data-photo-remove-button]","{uploadItem}":"[data-photo-upload-item]"}},function(b){return{init:function(){b.uploader=b.albumView().addController(EasySocial.Controller.Albums.Uploader,e.extend({"{uploadButton}":b.uploadButton.selector,"{uploadItemGroup}":b.photoItemGroup.selector,"{uploadDropsite}":b.albumContent.selector},{settings:b.options.uploader}));b.photoItemGroup().css("opacity",1);b.addPlugin("uploader",
b.uploader);b.setLayout()},hasItems:function(){var a=0<b.photoItem().length,c=0<b.uploadItem().length;return a||c},setLayout:function(){b.albumView().toggleClass("has-photos",b.hasItems())},activateAttachment:function(){},removePhoto:function(a){b.photoItem().filterBy("photoId",a).remove();b.setLayout()},clearPhoto:function(){b.photoItem().remove();b.setLayout()},"{uploader} FilesAdded":function(){b.setLayout();b.uploader.start()},"{uploader} FileUploaded":function(a,c,d,g,k){a=b.uploader.getItem(g);
var h=e(e.parseHTML(e.trim(k.html)));photoData=k.data;h.data("photo",photoData).addClass("new-item").insertAfter(a.element);b.uploader.removeItem(g.id);b.setLayout();setTimeout(function(){h.removeClass("new-item")},1);b.save()},"{uploader} FileError":function(a,c,d,e,k){b.story.setMessage(k.message,"error");if(a=b.uploadingPhoto)a.reject(),delete b.uploadingPhoto},"{uploader} Error":function(a,c,d,e){b.story.setMessage(e.message,"error");if(a=b.uploadingPhoto)a.reject(),delete b.uploadingPhoto},"{photoRemoveButton} click":function(a){a=
a.parent(b.photoItem.selector).data("photoId");b.removePhoto(a)},"{story} save":function(a,c,d){b.hasItems()&&(b.uploadingPhoto=d.addTask("uploadingPhoto"),b.save())},save:function(){var a=b.uploadingPhoto;if(a&&1>b.uploadItem().length){var c=[],d=a.save;b.photoItem().each(function(){c.push(e(this).data("photoId"))});d.addData(b,c);a.resolve();delete b.uploadingPhoto}},"{story} clear":function(){b.clearPhoto()}}});d.resolve()})});EasySocial.module("stream",function(){var e=this;EasySocial.require().library("dialog").script("comment").view("site/likes/item").language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_UNSUBSCRIBE",
"COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_SUBSCRIBE","COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_OK","COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_SUBMIT","COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_CANCEL","COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_UNSUBSCRIBE","COM_EASYSOCIAL_SUBSCRIPTION_ARE_YOU_SURE_UNSUBSCRIBE","COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_SUBSCRIBE","COM_EASYSOCIAL_STREAM_DIALOG_FEED","COM_EASYSOCIAL_STREAM_BUTTON_CLOSE").done(function(d){EasySocial.Controller("Stream.Item",{defaultOptions:{id:"","{streamItem}":".streamItem",
"{streamData}":".streamData","{streamResponds}":".stream-responds","{likeItem}":".likeItem","{likeItemList}":".likeItemList","{commentLink}":".commentLink","{commentFrame}":".commentFrame","{commentInput}":".commentInput","{followItem}":".followItem","{unfollowItem}":".unfollowItem","{hideItem}":".hideItem","{unhideItem}":".unhideItem"}},function(b){return{init:function(){b.commentFrame().implement("EasySocial.Controller.Comments",{uid:b.element.data("id"),pagination:new CommentPagination({total:b.commentFrame().data("total")}),
commentlist:new Comment.List})},"{likeItem} click":function(){EasySocial.ajax("site:/controllers/likes/toggle",{id:b.element.data("id"),type:"stream"},{success:function(a){var c="";0<a.likeCount&&(c=b.view.likeitem({likeCount:a.likeCount}),c.find(".likeText").html(a.message));b.likeItemList().html(c);b.likeItem().text(a.label)},fail:function(){}})},"{unfollowItem} click":function(){var a=b.element.data("sid");a&&d.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_UNSUBSCRIBE"),content:d.language("COM_EASYSOCIAL_SUBSCRIPTION_ARE_YOU_SURE_UNSUBSCRIBE"),
buttons:[{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_UNSUBSCRIBE"),click:function(){EasySocial.ajax("site:/controllers/subscriptions/remove",{id:a},{success:function(a){d.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_UNSUBSCRIBE"),content:a.message,buttons:[{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_OK"),click:function(){b.unfollowItem().removeClass("unfollowItem");d.dialog().close()}}]})},fail:function(){}})}},{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_CANCEL"),
click:function(){d.dialog().close()}}]})},"{followItem} click":function(){EasySocial.ajax("site:/controllers/subscriptions/form",{contentId:b.element.data("id"),contentType:"stream"},{success:function(a){""!=a.message?d.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_SUBSCRIBE"),content:a.message,buttons:[{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_CANCEL"),click:function(){d.dialog().close()}}]}):d.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_SUBSCRIBE"),content:a.htmlform,
buttons:[{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_SUBMIT"),click:function(){var a=d("#esfullname").val(),e=d("#email").val();EasySocial.ajax("site:/controllers/subscriptions/add",{contentId:b.element.data("id"),contentType:"stream",esfullname:a,email:e},{success:function(a){d.dialog({title:d.language("COM_EASYSOCIAL_SUBSCRIPTION_DIALOG_SUBSCRIBE"),content:a.message,buttons:[{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_OK"),click:function(){b.followItem().removeClass("followItem");
d.dialog().close()}}]})},fail:function(){}})}},{name:d.language("COM_EASYSOCIAL_SUBSCRIPTION_BUTTON_CANCEL"),click:function(){d.dialog().close()}}]})},fail:function(){}})},"{hideItem} click":function(){EasySocial.ajax("site:/controllers/stream/hide",{id:b.element.data("id")},{success:function(a){a="<div>"+a.message+"</div>";b.streamData().hide();b.element.append(a)},fail:function(a){d.dialog({title:d.language("COM_EASYSOCIAL_STREAM_DIALOG_FEED"),content:a.message,buttons:[{name:d.language("COM_EASYSOCIAL_STREAM_BUTTON_CLOSE"),
click:function(){d.dialog().close()}}]})}})},"{unhideItem} click":function(){EasySocial.ajax("site:/controllers/stream/unhide",{id:b.element.data("id")},{success:function(a){b.streamData().show();b.element.children().last().remove()},fail:function(a){d.dialog({title:d.language("COM_EASYSOCIAL_STREAM_DIALOG_FEED"),content:a.message,buttons:[{name:d.language("COM_EASYSOCIAL_STREAM_BUTTON_CLOSE"),click:function(){d.dialog().close()}}]})}})},"{commentLink} click":function(){b.commentInput().focus()}}});
e.resolve()})});EasySocial.module("tab",function(e){EasySocial.Controller("Tab",{defaultOptions:{view:{},"{tabs}":"","{tabsContent}":"","{defaultActive}":""}},function(d){return{init:function(){console.log("Tabs loaded");d.defaultActive().click()},"{tabs} click":function(b){if(e(b).hasClass("inactive"))return!1;d.tabs(".active").removeClass("active");e(b).addClass("active");d.tabsContent().hide();b=".tab-"+e(b).attr("id");d.tabsContent(b).show()}}});this.resolve()});EasySocial.module("toggle",function(e){EasySocial.Controller("Toggle",
{defaultOptions:{view:{},"{selector}":""}},function(d){return{init:function(){console.log("Toggle loaded")},"{selector} click":function(b){e(b).next().toggle();e(b).toggleClass("this-closed")}}});this.resolve()});EasySocial.module("uploader/item",function(e){EasySocial.require().view("site/uploader/preview").done(function(d){EasySocial.Controller("Uploader.Item",{defaults:{"{uploadItem}":".uploadItem","{uploadItemPreview}":".uploadItem.preview a.itemLink","{itemLink}":".itemLink","{itemDelete}":".itemDelete",
view:{preview:"site/uploader/preview"}}},function(b){return{init:function(){},"{itemDelete} click":function(a){var b=d(a).data("id");EasySocial.ajax("site:/controllers/uploader/delete",{id:b},function(){d(a).parents("li.uploadItem").remove()})},"{uploadItemPreview} click":function(a){var b=d(a).data("uri");a=d(a).data("title");d.dialog({title:a,content:d.Image.get(b)})}}})});this.resolve()});EasySocial.module("utilities/alias",function(e){EasySocial.Controller("Utilities.Alias",{defaultOptions:{"{target}":"",
"{source}":""}},function(d){return{init:function(){},convertToPermalink:function(b){return b.replace(/\s/g,"-").replace(/[^\w/-]/g,"").toLowerCase()},"{source} keyup":function(){d.target().val(d.convertToPermalink(d.source().val()))},"{target} keyup":function(){d.target().val(d.convertToPermalink(d.target().val()))}}});this.resolve()})});